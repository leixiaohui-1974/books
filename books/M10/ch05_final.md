<!-- 变更日志
v1 2026-02-16: 初稿（基于“继续”命令自动续写）
-->

# ch05 实验四：多场景回归与发布门禁验证

## 5.1 实验目的

完成本实验后，读者应能够：

1. 构建多场景回归覆盖矩阵并执行批量验证；
2. 记录回归失败统计字段并定位高频失效点；
3. 组织跨班组复盘会并形成整改闭环；
4. 基于门禁规则给出“发布/不发布”判定；
5. 为后续综合实训提供稳定版本基线。

> 承接 ch04：上一章完成在环联调，本章进一步验证策略在多场景下的稳定复现能力。

## 5.2 实验原理

回归实验的核心是“同版本、多场景、重复验证”。当策略经过联调后，仍需在不同工况下重复运行，确认其性能不因场景变化而失稳。

可定义回归通过率：

$$
RR = \frac{N_{pass}}{N_{all}}
$$

其中 $N_{pass}$ 为通过场景数，$N_{all}$ 为总场景数。

[物理直觉] 单场景表现良好不代表系统可靠，只有在“扰动组合”下仍稳定，才具备发布条件。

[工程解释] 若关键场景回归失败，即使总体通过率高，也不应进入发布。

## 5.3 多场景回归覆盖矩阵（补齐 ch04 跟踪项）

建议按“水文扰动×负荷扰动×设备状态”构建覆盖矩阵，至少包含：

- 正常工况、峰值工况、突变工况；
- 单点故障、链路抖动、策略切换；
- 日间/夜间不同班组执行窗口。

[表5-1: 多场景回归覆盖矩阵（补齐 ch04 跟踪项）]
{描述: 列包括场景ID、扰动类型、关键约束、预期结果、是否关键场景、通过判据、责任角色。}
{尺寸: 全页}
{颜色方案: 灰度}

## 5.4 回归失败统计字段（补齐 ch04 跟踪项）

每次回归失败需结构化记录：

- 失败类型（越界/超时/失配/中断）；
- 首次出现时间与复现次数；
- 影响链路与影响等级；
- 临时处置动作与最终根因；
- 是否阻断发布。

[表5-2: 回归失败统计字段表（补齐 ch04 跟踪项）]
{描述: 列包括字段名、含义、采集来源、阈值规则、发布影响级别。}
{尺寸: 全页}
{颜色方案: 灰度}

[工程解释] 失败统计字段是门禁决策输入，缺失字段将导致发布判断失真。

## 5.5 跨班组复盘会模板（补齐 ch04 跟踪项）

当回归出现关键失败，建议在24小时内召开跨班组复盘会，模板包含：

1. 事件回放与时间线；
2. 字段化失败统计与根因假设；
3. 整改措施分工与时限；
4. 再验证计划与门禁复核点；
5. 会议纪要与责任签署。

[图5-1: 跨班组复盘闭环流程图]
{描述: 展示“失败发现→复盘会→整改执行→再验证→门禁复核”流程。}
{尺寸: 半页}
{颜色方案: 蓝色系}

## 5.6 发布门禁判定规则

建议设置三档发布结论：

- **P0 不允许发布**：关键场景失败未关闭；
- **P1 有条件发布**：一般场景失败已制定临时约束；
- **P2 允许发布**：关键场景全通过且失败项闭环。

发布前须同时满足：

- 回归通过率 $RR$ 达阈值；
- 关键场景 100% 通过；
- 高影响失败项已关闭并签核。

## 5.7 实验步骤

1. 依据表5-1生成回归批次并分配执行班组；
2. 运行全量回归并记录通过/失败；
3. 对失败样本按表5-2补齐统计字段；
4. 对关键失败组织跨班组复盘会并形成整改单；
5. 按门禁规则输出发布判定。

## 5.8 数据记录表

| 回归批次 | 场景ID | 是否关键 | 执行结果 | 失败类型 | 复现次数 | 整改状态 | 门禁结论 | 备注 |
|---|---|---|---|---|---|---|---|---|
|  |  |  |  |  |  |  |  |  |

## 5.9 思考题

1. 为什么关键场景失败应“一票否决”发布？
2. 当RR达标但失败复现次数上升时，应如何处理？
3. 跨班组复盘如何避免“甩锅”而聚焦改进？

## 5.10 本章小结

本章完成了多场景回归验证框架，补齐覆盖矩阵、失败统计字段和跨班组复盘模板，形成“可覆盖、可统计、可决策”的发布门禁机制。下一章将进入综合运行实训。

## 拓展阅读

1. IEEE Std 29119 (Software Testing).  
2. IEC 61508 (Functional Safety).  
3. Lei et al. (2025c). 在环测试与运行验证体系。

> **术语一致性声明**：本章采用“在环测试（In-the-Loop Testing）”“最小风险状态（Minimal Risk State, MRS）”“安全包络（Safety Envelope）”“运行设计域（Operational Design Domain, ODD）”等规范术语。

### 质量检查清单（执行结果）

- [x] 含实验目的→原理→步骤→数据记录表→思考题；
- [x] 含多场景回归覆盖矩阵与失败统计字段；
- [x] 含跨班组复盘模板与发布门禁规则；
- [x] 含公式、物理直觉与工程解释；
- [x] 已补齐 ch04 评审提出的三项跟踪项。
