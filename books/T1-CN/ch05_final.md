<!-- 变更日志
v3 2026-02-16: 跨章一致性复检补充——强化与相邻章节接口及出版前核验提示
v2 2026-02-16: 根据四角色评审修订——补充图5-1架构图、增加最小上线门槛清单与角色职责矩阵、强化与WNAL映射
v1 2026-02-16: 初稿
-->

# 第五章 核心技术架构概览

---

> **引导案例：为什么“系统都在线”却仍然“协同失灵”**
>
> 某大型供水网络已经接入SCADA、GIS、视频监控和调度报表系统，表面上“数据全、系统全、平台全”。但在一次突发来水偏差与用水高峰叠加事件中，现场仍出现决策迟滞：监测平台知道“发生了什么”，调度平台知道“该做什么”，执行系统却不知道“先做什么、谁负责确认、失败后如何降级”。
>
> 这说明问题不在“有没有系统”，而在“系统之间是否形成可执行的操作系统级架构”。本章回答：HydroOS如何把设备、模型、智能与治理组织成统一运行体系。

---

## 架构目标：从功能集成到能力闭环

HydroOS设计目标是实现四个闭环：感知闭环、控制闭环、治理闭环、演进闭环。这四个闭环共同支撑WNAL L2-L4核心能力。

[图5-1: HydroOS三层架构图]
{描述: 自下而上三层：设备抽象层→物理AI引擎→认知AI引擎。左侧是SCADA数据流上行，右侧是控制指令下行。顶部为人机协同与治理审计模块；中部标注“策略门禁+四态机”；底部标注“边缘保护”。}
{尺寸: 半页}
{颜色方案: 蓝色系}
{对应ARCH编号: ARCH-03}

## HydroOS三层架构

### 5.2.1 设备抽象层（Device Abstraction Layer）

职责：屏蔽异构设备差异，把闸门、泵组、传感器、阀门、边缘站统一抽象为标准对象。关键能力包括统一设备语义、统一通信适配、统一时钟与数据质量标注。

### 5.2.2 物理AI引擎（Physical AI Engine）

职责：以机理模型为主、数据模型为辅，完成预测、控制与约束优化。核心模块包括水动力学/降阶模型、状态估计、MPC与安全包络约束器、异常检测与降级策略管理。

### 5.2.3 认知AI引擎（Cognitive AI Engine）

职责：把优化结果转化为可执行、可解释、可协同流程。核心模块包括知识图谱、大模型解释器、多智能体协同（MAS）与运行复盘器。

## SCADA+MAS融合机制

融合流程：SCADA上报状态→物理AI生成候选策略→MAS多角色协商→认知AI生成可执行指令→执行后回写日志。核心目标是标准化人机协同，不是替代人。

## 运行时核心机制

### 5.4.1 策略门禁

每次下发前通过三重门禁：可行性门禁、安全门禁、治理门禁。

### 5.4.2 四态机

采用“正常—受限—降级—接管”四态机，保证越界风险出现时可自动收敛到最小风险状态。

### 5.4.3 审计链

每次状态转换、策略下发、人工干预均记录“动作—原因—责任—结果”。

## 人机角色职责矩阵

| 场景 | 系统职责 | 人员职责 | 触发条件 |
|---|---|---|---|
| 正常运行 | 自动优化与执行 | 监督指标与审批策略 | ODD内、风险低 |
| 受限运行 | 收缩控制域并提示风险 | 确认降级策略 | 预测可信度下降 |
| 降级运行 | 启用保守策略与保护动作 | 批准关键阈值调整 | 逼近黄/红区 |
| 接管运行 | 维持监测与建议输出 | 接管关键操作并复盘 | 越界或重大故障 |

## 最小上线门槛清单

1. 关键对象语义模型是否完成并一致？
2. 关键状态可观性与关键目标可控性是否通过核验？
3. 是否通过MIL/SIL/HIL验证门禁？
4. 是否定义ODD边界、越界处理与MRC？
5. 四态机是否可演练、可审计、可回放？
6. 人机协同SOP与值班演练是否落地？
7. 模型与策略是否具备灰度发布与回滚机制？
8. 升级后是否建立周期复评机制？

## 与WNAL分级映射

- L2：要求具备设备抽象层+局部物理AI闭环；
- L3：要求三层架构联动+策略门禁+四态机；
- L4：要求认知AI、治理审计、灰度发布与持续复评全面运行。

## 常见架构误区与纠偏

- 重算法轻治理 → 增加门禁与审计链；
- 重中心轻边缘 → 强化边缘保护与断连自治；
- 重接入轻标准 → 先统一语义再扩展接入；
- 重上线轻复盘 → 建立复评与演进机制。

## 本章小结与第六章衔接

本章明确：HydroOS三层架构是能力骨架，SCADA+MAS是协同机制，门禁/四态机/治理是可信保障。第六章将进入工程案例，验证架构在真实场景中的效果与边界。


## 跨章一致性复检补充（v3）

- 与第2章一致：策略门禁与四态机直接落地“先安全后最优”的控制原则；
- 与第4章一致：L2/L3/L4映射关系作为架构验收与运维审计依据；
- 与第6章一致：工程案例应按“架构模块—运行机制—指标结果—接管记录”统一模板呈现。

**出版前核验提示**：图5-1（ARCH-03）与后续第7章系统实现图需共用命名与层级定义。
