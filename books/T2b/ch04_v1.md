<!-- 变更日志
v1 2026-02-16: 初稿
-->

# 第四章 物理信息神经网络（PINN）

---

## 学习目标

完成本章后，你应能够：

1. 解释 PINN 将偏微分方程约束注入神经网络训练的基本思想；
2. 构建面向水动力学场景的 PINN 损失函数与训练流程；
3. 区分正问题预测与反问题参数识别两类任务；
4. 识别 PINN 在工程应用中的数值稳定性与可解释性风险；
5. 设计 PINN 模型接入 ODD、Safety Envelope 与在环验证的门禁流程。

> **章首衔接（承接ch03）**  
> 上一章介绍了深度学习模型在时空建模中的应用。本章进一步把机理方程显式纳入训练目标，解决“数据驱动精度高但物理一致性不足”的问题。

## 4.1 PINN 的核心思想

[物理直觉] 仅依赖观测数据训练的模型，可能在未观测区域产生违反守恒律的预测。PINN 通过把物理方程残差并入损失函数，约束模型学习空间。

[工程解释] 在水系统中，PINN 可将 Saint-Venant 方程、边界条件与观测数据联合训练，使预测结果更符合机理规律。

## 4.2 PINN 训练目标构造

设网络输出为 \(\hat{u}(x,t;\theta)\)，总损失可写为：

\[
\mathcal{L}=\lambda_d\mathcal{L}_{data}+\lambda_p\mathcal{L}_{physics}+\lambda_b\mathcal{L}_{bc}+\lambda_i\mathcal{L}_{ic}
\]

其中：
- \(\mathcal{L}_{data}\)：观测数据误差；
- \(\mathcal{L}_{physics}\)：方程残差；
- \(\mathcal{L}_{bc}\)：边界条件误差；
- \(\mathcal{L}_{ic}\)：初值条件误差。

[工程意义] 权重 \(\lambda\) 的设置决定“数据拟合”与“机理一致性”的平衡，应结合任务目标做分阶段调参。

## 4.3 水动力学 PINN 建模流程

推荐流程：

1. 确定方程形式与边界/初值条件；
2. 构建观测点与方程采样点（collocation points）；
3. 联合优化数据项与物理项损失；
4. 在关键断面验证守恒性与预测误差；
5. 接入 SIL 场景评估控制影响。

[图4-1: 水动力学PINN建模流程]
{描述: 从方程定义、采样、训练、误差评估到在环验证的闭环流程图。}
{尺寸: 全页}
{颜色方案: 蓝色系}
{对应ARCH编号: ARCH-06}

## 4.4 正问题与反问题

### 4.4.1 正问题

给定参数与边界条件，预测水位/流量演化。

### 4.4.2 反问题

给定观测数据，反演粗糙系数 \(n\)、底坡 \(S_0\) 或泄放系数等关键参数。

[TODO: 需补充某典型渠段 PINN 反问题识别精度实测对比数据]

## 4.5 工程部署风险与对策

- **风险1：训练不稳定** → 采用课程学习与损失重加权；
- **风险2：边界条件噪声放大** → 增加鲁棒损失与边界平滑约束；
- **风险3：上线不可解释** → 输出方程残差热图与守恒性报告。

[表4-1: PINN部署门禁项]
| 门禁类别 | 判据示例 | 不满足处置 |
|---|---|---|
| 物理一致性 | 方程残差阈值 | 退回训练重标定 |
| 预测性能 | 关键断面误差阈值 | 禁止上线 |
| 工程安全 | ODD/Safety Envelope冲突率 | 启动保守回退 |
| 治理能力 | 版本与日志可追溯 | 暂缓发布 |

## 4.6 例题：基于 PINN 的渠段粗糙系数反演

【例4-1】某输水渠段在汛前检修后水位响应发生变化，需反演 Manning 粗糙系数 \(n\) 以更新模型参数。

**已知**：
- 提供连续72小时断面流量与水位观测；
- 已知渠段几何参数与边界过程；
- 要求参数更新后可用于调度预测。

**求解**：设计 PINN 反演与验证流程。

**解题过程**：

步骤1：建立含 \(n\) 的机理方程残差表达。  
步骤2：构建观测损失与物理损失联合训练目标。  
步骤3：对 \(n\) 做可行区间约束，避免非物理解。  
步骤4：在验证集比较反演前后关键断面误差。  
步骤5：在 SIL 场景验证参数更新对控制策略影响。

**结果讨论**：

反演目标是“工程可用且物理合理”，不是单纯追求数值误差最小。

### PINN章节上线检查清单

- [ ] 是否完成方程、边界、初值条件一致性校核；
- [ ] 是否完成数据项与物理项权重灵敏度分析；
- [ ] 是否输出守恒性与残差分布报告；
- [ ] 是否通过 SIL/HIL 场景在环影响评估；
- [ ] 是否建立参数更新回退与审计机制。

## 4.7 本章小结

本章给出了 PINN 在水系统中的工程化框架：通过“数据误差 + 物理残差”联合优化，实现更具机理一致性的学习模型。关键结论是：PINN 只有在满足物理一致性、运行安全和治理可追溯三重门禁时，才具备工程上线价值。下一章将进入强化学习与水系统控制。

## 习题

### 基础题

1. PINN 与普通神经网络的核心差异是什么？  
2. 为什么 PINN 需要同时优化数据项与物理项损失？  
3. 正问题与反问题在工程应用中的目标有何不同？

### 应用题

4. 设计一个用于渠段水位预测的 PINN 训练流程。  
5. 设计“PINN参数更新失败”的回退与复核机制。

### 思考题

6. 在观测数据质量较差时，PINN 应更依赖物理项还是数据项？如何权衡？

## 拓展阅读

1. Raissi et al. (2019). Physics-Informed Neural Networks.  
2. Karniadakis et al. (2021). Physics-informed machine learning.  
3. Litrico, X. & Fromion, V. *Modeling and Control of Hydrosystems*.  
4. Lei et al. (2025b). 自主智能水网架构。  
5. Lei et al. (2025c). 在环测试系统。
