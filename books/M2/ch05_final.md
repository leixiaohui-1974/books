<!-- 变更日志
v1 2026-02-16: 初稿
-->

# ch05 分布式MPC架构

## 5.1 学习目标

完成本章学习后，读者应能够：

1. 理解大规模水网采用分布式模型预测控制（Distributed MPC, DMPC）的必要性；
2. 区分集中式、分散式与分布式控制架构的主要差异；
3. 掌握基于协调变量与一致性约束的 DMPC 建模方法；
4. 设计适用于多渠段/多泵站场景的协同求解与通信机制；
5. 评估 DMPC 的工程收益、计算开销与失效应对策略。

> 本章承接 ch04 的非线性控制基础：当系统规模扩大、耦合增强时，单一集中求解难以满足实时性，需引入分布式架构。

## 5.2 为什么需要分布式MPC

在区域水网或跨流域调配场景中，控制对象规模大、设备分布广、通信链路异构，集中式 MPC 常面临三类瓶颈：

- 计算规模过大，单节点求解超时风险上升；
- 通信负担重，中心节点成为单点故障；
- 模型维护复杂，局部变更易牵动全局重构。

DMPC 通过“局部优化 + 协调一致”实现可扩展控制：各子系统独立求解本地问题，再通过协调变量实现全局协同。

[物理直觉] 类似大型工程施工：各工区各自推进，但必须共享边界计划，保证整体工期与质量一致。

## 5.3 架构对比：集中式、分散式、分布式

- **集中式MPC**：全局最优潜力高，但计算与通信压力大；
- **分散式控制**：本地快速，但跨区协调弱；
- **分布式MPC**：在可协调前提下兼顾可扩展性与性能。

[表5-1: 三类控制架构对比]
{描述: 对比计算复杂度、通信需求、扩展性、容错性、工程维护成本。}
{尺寸: 半页}
{颜色方案: 灰度}

## 5.4 DMPC问题表述与协调机制

设系统分为 $M$ 个子系统，第 $i$ 个子系统状态与输入为 $(\mathbf{x}_i,\mathbf{u}_i)$，局部目标为 $J_i$。整体问题可写为：

$$
\min \sum_{i=1}^{M} J_i(\mathbf{x}_i,\mathbf{u}_i)
$$

约束包含本地约束与耦合一致性约束：

$$
\mathbf{z}_i = \mathbf{z}_j,\quad (i,j)\in\mathcal{E}
$$

其中 $\mathbf{z}$ 表示边界流量、水位或共享资源变量，$\mathcal{E}$ 表示耦合拓扑。

常用协调策略：

1. 预测—交换—再优化迭代；
2. 基于乘子更新的一致性协调；
3. 分层调度（上层分配目标，下层局部跟踪）。

[工程解释] 协调策略选择需综合考虑“可收敛、可通信、可容错”三目标。

[图5-1: DMPC分层协同架构]
{描述: 展示上层协调器与下层局部控制器、边界变量交换、异常回退通道。}
{尺寸: 全页}
{颜色方案: 蓝色系}

## 5.5 通信与同步策略

DMPC 不是纯算法问题，还包含通信时延与丢包处理：

- 同步式迭代：一致性强，但等待开销大；
- 异步式迭代：实时性好，但收敛分析更复杂；
- 混合同步：关键边界同步，非关键边界异步。

工程建议：

- 对关键断面变量设置“新鲜度门限”；
- 通信异常时启用局部保守策略；
- 通过在环测试（In-the-Loop Testing）验证最坏时延场景。

## 5.6 可复现实例：两子网协同调度

【例5-1】某区域水网分为上游输水子网 A 与下游配水子网 B。两者通过边界流量 $Q_b$ 耦合，采样周期 5 min。

**已知**：

- A 子网目标：平滑输水、降低能耗；
- B 子网目标：稳定末端水压、减少超限；
- 边界一致性要求：$Q_b^A \approx Q_b^B$；
- 每周期可执行 2 次协调迭代。

**求解**：说明为何“有限迭代协调 + 保守边界回退”可提升在线可用性。

**解题过程**：

1. 两子网先并行求解本地 NMPC；
2. 交换边界预测并执行两轮协调更新；
3. 若边界偏差仍超阈值，则使用保守边界参考并触发下一周期再协调。

**结果讨论**：
有限迭代避免求解超时，保守边界回退避免耦合失配放大，是工程化 DMPC 的实用折中。

## 5.7 失效模式与韧性设计

典型失效模式：

- 协调不收敛导致边界振荡；
- 通信中断导致子网目标冲突；
- 单个子网模型漂移拖累全局性能。

韧性设计要点：

- 设置协调迭代上限与提前终止条件；
- 设计“局部自治 + 全局重协同”双模切换；
- 建立子网健康度评分，低健康子网自动降权。

[TODO: 需补充不同通信拓扑下的迭代收敛统计数据。]

## 5.8 本章小结

本章完成了分布式MPC在大规模水网中的方法框架：通过子网分解降低计算负担，通过一致性协调保障全局协同，通过通信与韧性机制提升工程可用性。DMPC 的核心价值不是“绝对最优”，而是“在可扩展与可运行约束下实现稳定协同”。下一章将进一步讨论不确定性下的鲁棒MPC策略。

## 习题

### 基础题

1. 分布式MPC与分散式控制的根本差异是什么？
2. 为什么 DMPC 必须显式处理边界一致性约束？
3. 同步式与异步式协调各自的主要优缺点是什么？

### 应用题

4. 针对三子网耦合场景，设计一套边界变量交换与协调迭代流程。  
5. 设计通信中断情况下的“局部自治—全局恢复”状态机，并给出切换阈值。

### 思考题

6. 若项目团队只能接受有限通信开销，你会优先牺牲最优性、鲁棒性还是响应速度？请给出理由。

### 基础题参考答案要点

1. DMPC存在显式协同机制与一致性目标，分散式通常缺少系统级协调。  
2. 因子网间共享边界变量，若不一致将导致全局物理不可行或性能劣化。  
3. 同步式一致性好但时延敏感；异步式实时性强但收敛与稳定性分析更复杂。

## 拓展阅读

1. Scattolini, R. (2009). Architectures for distributed and hierarchical MPC.  
2. Rawlings, J.B., Mayne, D.Q. & Diehl, M. (2017). *Model Predictive Control: Theory, Computation, and Design*.  
3. Negenborn, R.R. & Maestre, J.M. (2014). *Distributed Model Predictive Control Made Easy*.  
4. Camacho, E.F. & Bordons, C. (2007). *Model Predictive Control*.  
5. Lei et al. (2025b). 自主智能水网架构。

> **术语一致性声明**：本章统一采用“模型预测控制（Model Predictive Control, MPC）”“分层分布式控制（Hierarchical Distributed Control, HDC）”“运行设计域（Operational Design Domain, ODD）”“安全包络（Safety Envelope）”“在环测试（In-the-Loop Testing）”等规范术语；数学符号采用 $Q,h,\tau,T_p,T_c,\mathbf{x},\mathbf{u},\mathbf{y},J$。

### 质量检查清单（执行结果）

- [x] 章首学习目标、章末小结/习题/拓展阅读完整；
- [x] 基础题3 + 应用题2 + 思考题1，含基础题答案要点；
- [x] 公式前有物理直觉，公式后有工程解释；
- [x] 含可复现实例（例5-1）；
- [x] 图表不少于2项（图5-1、表5-1）；
- [x] 章首回顾ch04，章末预告ch06。
