# 增强版自动深度研究工作流设计
# 吸收books目录9大写作技能精华

## 核心改进点

### 1. 多类型文档评审机制（9大文体）

原设计只有单一输出，现在支持9种文体，每种有专门的评审角色：

| 文体 | 评审角色 | 达标标准 |
|------|---------|---------|
| SCI论文 | Reviewer A(创新)、B(方法)、C(应用) | 连续2轮全Minor/Accept |
| 中文核心 | 审稿人A(学科)、B(工程)、C(编辑) | 连续2轮全小修/录用 |
| 发明专利 | 审查员(40%)、代理人(30%)、技术专家(30%) | ≥7.5/10 |
| 书稿 | 教师、专家、工程师、国际读者 | ≥8.0/10且无🔴 |
| 技术报告 | 技术审查人(60%)、管理审查人(40%) | ≥7.0/10 |
| 国内标准 | 标准化专家(40%)、技术专家(35%)、实施方(25%) | ≥8.0且合规率100% |
| 国际标准 | ISO专家(40%)、国际水利专家(35%)、工业界(25%) | ≥8.0且合规率100% |
| 公众号 | 读者代表(40%)、编辑(30%)、领域专家(30%) | ≥7.5且无🔴+脚本通过 |
| PPT | 听众代表(35%)、设计审查(30%)、内容专家(35%) | ≥7.5且无🔴+风格合规 |

### 2. "写-审-改"闭环迭代机制

```
用户指令 → 读取规格 → [写作] → [多角色评审] → 达标?
                              ↑         ↓ 否
                              └── [修改] ←┘
                                    ↓ 是
                              保存终稿 → 更新进度
```

**迭代上限**：
- SCI/CN: 20轮
- PAT: 4轮
- BK: 6轮
- RPT: 3轮
- STD: 4轮
- WX: 5轮
- PPT: 4轮

### 3. 质量检查关卡（强制）

**关卡6.5 - 参考文献验证（所有文体）**：
- 运行 `scripts/check_references.py`
- web_search逐一验证真实性
- 🔴项清零方可进入评审

**关卡 - 文体专属检查**：
- WX: `scripts/check_article.py`（14项检查）
- STD: `scripts/check_standard.py`（条文合规）
- PPT: `scripts/check_ppt.py`（风格合规）
- SCI/CN/PAT/BK/RPT: `scripts/check_quality.py`

### 4. 25万字实现策略（书稿L4级）

**四级策略**：
- L1: <3万字 - 单轮生成
- L2: 3-10万字 - 分模块生成
- L3: 10-30万字 - 模块化流水线
- **L4: >30万字 - 增量迭代+版本标签+四角色评审** ← 25万字用此级

**L4实施规范**：
1. **模块拆分**：50个模块，每个模块5000字
2. **文件命名**：`p{部分号}_s{节号}_{英文描述}.md`
3. **组装脚本**：合并为`report_full_assembled.md`
4. **版本管理**：每轮修改后`git commit`，重大版本`git tag`
5. **统计验证**：总字数、参考文献数、图表数、思考题数

### 5. 进度追踪系统

**progress.json结构**：
```json
{
  "project": "水系统控制论专著",
  "total": 50,
  "completed": 0,
  "documents": {
    "BK-M1-ch01": {
      "type": "BK",
      "title": "绪论",
      "status": "not_started",
      "current_version": 0,
      "updated_at": "2026-02-22T07:00:00Z"
    }
  }
}
```

**状态流转**：
```
not_started → drafting → in_review_v{N} → revising_v{N} 
    → in_review_v{N+1} → ... → completed
                      → manual_review_needed（超出迭代上限）
```

### 6. 跨文档一致性检查

**CONS-01~10约束**：
- CHS八原理表述一致
- WSAL(L0-L5)定义一致
- 工程参数（南水北调、胶东调水等）一致
- 术语中英对照一致

**自动检查**：`scripts/check_consistency.py`

### 7. 公众号文章特殊规则（WX）

**手机阅读铁律**：
- 每段≤150字（200字硬限）
- 单句≤50字，复合句≤70字
- 每3-4段插入加粗点睛句
- 节间用`---`分隔
- 无三级标题
- 中英文间加空格
- 禁用词：赋能/抓手/闭环/颗粒度/对齐

### 8. 技术标准特殊规则（STD）

**国内标准(GB/T 1.1-2020)**：
- 条文用语：应/宜/可/不应/不宜
- 规范性引用文件逐一验证现行有效
- 术语定义采用"属概念+种差"

**国际标准(ISO/IEC Directives Part 2)**：
- 条文用语：shall/should/may
- 法文标题必须完整
- 术语引用ISO OBP

### 9. PPT特殊规则

**风格指南**：
- 配色：科技蓝(#002060)+中国红(#C00000)
- 字体：微软雅黑(中文)+Times New Roman(英文)
- 比例：16:9
- 每页核心信息10秒内可抓住
- 全部页面必须有Speaker Notes

## 新工作流架构

```
用户输入主题 + 选择文体
    ↓
[任务规划器] - 分解为50个子任务(L4级)
    ↓
[并行写作模块] - 10个子任务同时执行
    ↓
[质量检查关卡] - 参考文献验证 + 文体专属检查
    ↓
[多角色评审] - 3-4角色独立评审
    ↓
达标? → 否 → [修改模块] → 回到评审（最多N轮）
    ↓ 是
[内容整合器] - 合并50个模块
    ↓
[一致性检查] - CONS-01~10验证
    ↓
[输出生成器] - Word/PDF/Markdown
    ↓
更新progress.json → 完成
```

## 执行计划

### Phase 1: 环境准备（10分钟）
1. 创建项目目录结构
2. 创建progress.json
3. 创建50个模块规格文件

### Phase 2: 批量写作（60-90分钟）
1. 同时启动10个写作任务
2. 每个任务：搜索→写作→检查→评审→修改
3. 监控进度，完成后启动下一批

### Phase 3: 整合与检查（20分钟）
1. 组装50个模块
2. 运行一致性检查
3. 生成最终文档

### Phase 4: 输出（10分钟）
1. 转换为Word格式
2. 添加封面、目录
3. 保存并更新进度

**预计总时间：100-130分钟生成25万字书稿**

## 下一步行动

需要我立即开始实施这个增强版工作流吗？
- 先创建一个简化测试版（5个模块，2.5万字）
- 验证流程后扩展到完整50模块
