<!-- 变更日志
v1 2026-02-16: 初稿
-->

# ch11 胶东调水MPC实践

## 学习目标

完成本章后，读者应能够：

1. 结合胶东调水工程特点，明确MPC部署对象、控制目标与边界条件；
2. 将“明渠水动力模型—运行设计域（Operational Design Domain, ODD）—安全包络（Safety Envelope）”整合为可执行控制问题；
3. 设计覆盖“日常、检修、突发来水扰动”三类场景的分层分布式控制（Hierarchical Distributed Control, HDC）门禁；
4. 构建从仿真到在环测试（In-the-Loop Testing）再到上线运行的验证链路；
5. 输出可复用的工程上线清单、运行看板与复盘机制。

> 本章承接 ch10：在“实时可解”条件已满足基础上，进入真实长距离明渠调水工程，回答“如何把MPC稳定落地并持续运行”。

> **前章回顾**：上一章介绍了本领域的核心概念与方法。本章在此基础上进一步展开。


## 工程对象与控制问题定义

胶东调水属于长距离明渠输水系统，核心任务是保障供水安全、降低弃水损失并维持沿线渠池水位平稳。

[物理直觉] 对长渠系统而言，调度动作存在明显传输延时，今天的闸门动作会在一段时间后才反映到下游水位。

因此，本章采用“多渠段+关键闸站”预测控制框架。将关键状态向量写为：

$$
\mathbf{x}_k=[h_{1,k},h_{2,k},\ldots,h_{n,k}]^\top
$$

控制输入向量写为：

$$
\mathbf{u}_k=[Q_{g1,k},Q_{g2,k},\ldots,Q_{gm,k}]^\top
$$

其中 $h$ 为渠池水位，$Q$ 为闸门控制流量。

[工程解释] 工程实现中并不追求“全网全变量最优”，而是优先选择可观、可控、可维护的关键断面与关键闸站。

## 胶东调水MPC目标体系

建议采用三层目标：

1. **安全目标（一级）**：水位始终处于安全包络；
2. **供水目标（二级）**：末端供水偏差最小；
3. **经济目标（三级）**：动作平滑、能耗与操作成本受控。

可写为加权目标函数：

$$
J=\sum_{i=1}^{N_p}\left(\|\mathbf{y}_{k+i}-\mathbf{y}_{k+i}^{ref}\|_{W_y}^2+\|\Delta\mathbf{u}_{k+i-1}\|_{W_u}^2\right)
$$

并配以安全约束：

$$
h_{min}\le h_{j,k+i}\le h_{max},\quad j=1,\ldots,n
$$

[工程解释] 实际调度中先满足安全，再满足供水，再优化经济性；权重设置与审批流程应与这一优先级一致。

[图11-1: 胶东调水MPC目标分层与约束关系图]
{描述: 展示安全、供水、经济三层目标与约束、联锁、门禁之间关系。}
{尺寸: 全页}
{颜色方案: 蓝色系}

## ODD分区与门禁设计

结合胶东调水运行经验，推荐至少划分三个ODD子域：

- ODD-A（日常稳态供水）；
- ODD-B（计划检修与限流）；
- ODD-C（突发来水扰动与应急调度）。

每个子域配置独立参数集与策略门禁：

- 预测步长 $T_p$ 与控制时域 $T_c$；
- 允许动作幅度与动作频次；
- 告警阈值与降级触发条件；
- 人工接管条件与恢复条件。

[表11-1: 胶东调水ODD门禁配置模板]
{描述: 列包括ODD子域、适用工况、参数组、门禁阈值、自动动作、人工确认时限。}
{尺寸: 半页}
{颜色方案: 灰度}

## 分层分布式控制落地流程

建议按“中心层—渠段层—设备层”实施：

1. **中心层**：生成全线供水目标与约束边界；
2. **渠段层**：执行分布式MPC，协调相邻渠段流量；
3. **设备层**：将目标流量转换为闸门开度，执行联锁保护。

[物理直觉] 长距离输水系统像“接力赛”，上游动作必须与下游接收能力匹配，否则会形成水位波动放大。

协调约束可写为：

$$
Q_{out,i,k}\approx Q_{in,i+1,k+\tau_i}
$$

其中 $\tau_i$ 为渠段传输延时。

[工程解释] 该约束并不要求严格“瞬时相等”，而是通过预测时移实现上下游协调，减小波动与弃水风险。

## 可复现实例：检修场景下的门禁切换

【例11-1】某关键闸站计划检修6小时，闸门最大可调流量由 42 m³/s 临时下调至 30 m³/s。要求在不触发红色告警前提下维持末端供水偏差不超过 ±4%。

**已知**：

- 检修窗口：10:00–16:00；
- 日常参数组为A组，检修场景切换B组；
- B组下动作增量约束收紧30%；
- 连续两周期黄色告警需触发人工确认。

**求解**：给出门禁切换与恢复流程。

**解题过程**：

1. 09:40 进入检修预备态：将ODD由A切换到B，提前降低上游给定；
2. 10:00 检修开始：启用B组MPC参数并收紧 $\Delta \mathbf{u}$ 约束；
3. 若末端供水偏差接近 ±4%，优先调整上游缓冲渠池，而非直接放大下游闸门动作；
4. 16:00 检修结束后，满足“连续3周期无黄色告警”再恢复A组参数。

**结果讨论**：
该策略避免了“检修结束即瞬时回切”造成的二次冲击，实现了平稳恢复。

## 在环测试与上线验收

上线前建议执行“SIM→SIL→HIL→试运行”四阶段：

- **SIM**：验证模型与调度逻辑一致性；
- **SIL**：验证求解器、参数切换与告警逻辑；
- **HIL**：验证控制器与现场设备/通信链路时延耦合；
- **试运行**：设置双轨运行（人工调度+MPC建议）并进行差异复盘。

验收核心指标建议包括：

- 安全包络越界次数；
- 供水偏差P95；
- 求解超时率；
- 人工接管次数与恢复时长；
- 告警闭环完成率。

[表11-2: 胶东调水MPC上线验收清单]
{描述: 列包括验收项、判定标准、数据来源、责任部门、签批节点。}
{尺寸: 半页}
{颜色方案: 灰度}

[TODO: 需补充具体站点编号、签批流程版本号与工单系统字段映射。]

## 运行复盘与持续优化机制

工程上线不是终点。建议建立“周复盘+月评审”双节奏：

- 周复盘：聚焦异常事件与人工接管；
- 月评审：更新权重、门禁阈值与参数组；
- 季度评估：对比年度供水绩效与设备寿命指标。

推荐沉淀三类资产：

1. 事件案例库（按ODD场景归档）；
2. 参数变更审计库（变更理由、审批链路、回退记录）；
3. 可复用模板库（上线清单、SOP、复盘报告）。

## 本章小结

本章以胶东调水为对象，给出了MPC从“可算”到“可用”的工程化路径：先定义目标与约束，再通过ODD分区和门禁策略组织运行场景；通过分层分布式控制匹配长距离明渠时延特性；通过在环测试与上线验收确保安全与实时性；最后用复盘机制支撑持续优化。下一章将转向沙坪梯级场景，讨论多水电站耦合条件下的MPC实践与协同调度。

## 习题

### 基础题

**11-1.** 胶东调水MPC实践中，为什么必须设置“安全—供水—经济”三级目标优先级？
**11-2.** 说明ODD-A、ODD-B、ODD-C三类子域的典型工况差异。
**11-3.** 写出上下游协调约束的基本形式，并解释延时项的物理意义。

### 应用题

**11-4.** 某渠段传输延时由 12 min 增至 20 min，试给出预测步长、动作约束与告警阈值的调整建议。  
**11-5.** 设计一份“检修场景门禁切换SOP”，至少包含触发条件、自动动作、人工确认、恢复条件四部分。

### 思考题

**11-6.** 当“末端供水偏差控制”与“上游设备寿命保护”冲突时，你将如何设置权重、审批权限与责任边界？

### 基础题参考答案要点

**11-7.** 工程上线必须先守住安全底线，再保障供水任务，最后优化经济性。  
**11-8.** ODD-A对应常态供水，ODD-B对应计划检修限流，ODD-C对应突发扰动应急。  
**11-9.** $Q_{out,i,k}\approx Q_{in,i+1,k+\tau_i}$，延时项体现明渠输水传播时间。

## 拓展阅读

1. **Van Overloop, P.J. (2006). *Model Predictive Control on Open Water Systems*.**
2. **Litrico, X. & Fromion, V. (2009). *Modeling and Control of Hydrosystems*.**
3. **ASCE (2014). *MOP 131: Canal Automation for Irrigation Systems*.**
4. **Lei et al. (2025b). 自主智能水网架构与工程实践。**
5. **Lei et al. (2025c). 在环测试系统与验证方法。**
