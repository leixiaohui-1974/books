# ch10 胶东调水降阶建模实践

## 10.1 学习目标

完成本章学习后，读者应能够：

1. 理解胶东调水工程中降阶模型（Reduced-Order Model, ROM）的部署边界与运行设计域（Operational Design Domain, ODD）；
2. 掌握从全阶水动力模型到工程可用 ROM 的“建模—辨识—验证—上线”完整流程；
3. 能够基于传递函数、IDZ 与 Muskingum 类模型给出工程化选型决策；
4. 能够设计在环测试（In-the-Loop Testing）门禁条件，并形成可审计的上线报告；
5. 理解多季节、冰期与检修工况下 ROM 的重标定与回退策略。

> 本章衔接上一章“模型验证与比较框架”：上一章解决“如何公平比较模型”，本章解决“如何在真实工程中把 ROM 跑起来并稳定运行”。

## 10.2 工程场景与问题定义

胶东调水工程属于长距离明渠调水系统，运行目标不是单一断面最优，而是“供水保障、安全约束、能耗与运维成本”协同最优。工程现场通常已经具备 SCADA 数据采集能力，但全阶 Saint-Venant 模型难以在调度周期内反复求解，因此需要部署可实时计算的 ROM。

本章采用与全书一致的符号体系：流量 $Q$、水位 $h$、波速 $c$、传输延时 $\tau$、目标函数 $J$。控制目标表达为：

$$
\min J=\sum_{k=1}^{N_p}\left[w_h\|h_k-h_k^{ref}\|^2+w_q\|Q_k-Q_k^{ref}\|^2+w_u\|\Delta u_k\|^2\right]
$$

其中 $N_p$ 对应预测窗口长度。该目标函数与后续模型预测控制（Model Predictive Control, MPC）对接时保持一致，便于 ROM 直接进入调度优化链路。

[图10-1: 胶东调水 ROM 工程部署链路]
{描述: 从现场传感器、SCADA、数据清洗、ROM在线推演、MPC调度、执行机构与回传监测构成闭环。标注“异常触发回退”路径。}
{尺寸: 全页}
{颜色方案: 蓝色系}
{对应ARCH编号: ARCH-08}

## 10.3 工程级 ROM 构建流程

### 10.3.1 流程总览

建议流程分为六步：

1. **工况分层**：按季节、负荷、检修、冰期建立 ODD 子域；
2. **候选建模**：并行构建 Transfer Function、IDZ、Muskingum 与机理+数据残差模型；
3. **参数辨识**：采用最小二乘、频率域拟合与分段率定；
4. **离线评估**：使用 ch09 指标体系（精度、实时性、稳健性、运维性）；
5. **在环门禁**：MIL→SIL→HIL 逐级验收；
6. **上线运行与漂移监测**：连续监测误差与约束触发率，满足条件时触发重标定。

### 10.3.2 ODD 分层策略

ROM 失败往往不是模型形式错误，而是“模型使用超出适用域”。因此在工程上先定义 ODD：

- ODD-A（常温稳态供水）；
- ODD-B（峰值调水 + 边界扰动）；
- ODD-C（冰期或低温高糙率）；
- ODD-D（检修限流或传感器缺测）。

每个 ODD 子域单独维护参数集，避免“一套参数全年通用”导致的系统性偏差。

[表10-1: 胶东调水 ODD 子域与 ROM 配置建议]
{描述: 列包括ODD编号、典型流量区间、边界扰动特征、推荐ROM类型、更新周期、回退条件。}
{尺寸: 半页}
{颜色方案: 灰度}

## 10.4 候选模型与辨识配置

### 10.4.1 Transfer Function 模型

[物理直觉] 明渠扰动在传播中体现“时滞 + 衰减”，可用低阶传递函数近似。

$$
G(s)=\frac{K e^{-\tau s}}{T s+1}
$$

工程解释：$K$ 反映稳态增益，$T$ 反映惯性，$\tau$ 反映传播时延。该模型可解释性强、参数少，适合快速部署。

### 10.4.2 IDZ 模型

IDZ（Integrator Delay Zero）模型在保持简洁结构的同时提升了对水位积分特性的表达能力，特别适用于长渠缓变过程。

$$
G(s)=\frac{K(1+z s)}{s}e^{-\tau s}
$$

工程解释：零点项 $z$ 可用于修正过渡段形状，降低跟踪超调。

### 10.4.3 Muskingum 类模型

Muskingum 类模型直接面向洪波演算，便于与传统水文调度认知衔接，常作为“保守可用”的回退模型。其优势在于参数物理意义明确、培训成本低。

### 10.4.4 机理+数据残差模型

该类模型以机理 ROM 为主干，以数据驱动模块拟合残差，可提升复杂工况精度；但需重点管理可解释性与数据漂移风险。

## 10.5 可复现实例：关键渠段辨识与选型

【例10-1】某关键渠段（长度约 18 km）在 ODD-B 工况下进行 ROM 选型。采样周期 5 min，训练样本 45 天，测试样本 15 天。经统一评估得到：

- Transfer Function：RMSE($h$)=0.073 m，单步计算 6 ms；
- IDZ：RMSE($h$)=0.061 m，单步计算 8 ms；
- Muskingum：RMSE($h$)=0.082 m，单步计算 4 ms；
- 机理+数据残差：RMSE($h$)=0.054 m，单步计算 18 ms。

设项目在试运行阶段权重为 $w_{acc}=0.35,w_{rt}=0.20,w_{rob}=0.30,w_{ops}=0.15$，并要求单步计算 < 20 ms。

**求解**：给出推荐上线模型与备选回退模型。

**解题过程**：

1. 四模型均满足实时性硬约束（<20 ms）；
2. 按 ch09 综合评价规则计算后，IDZ 与机理+数据残差接近；
3. 结合可维护性与审计可追溯性，主用 IDZ，机理+数据残差作为增强通道，Muskingum 作为故障回退。

**结果讨论**：

该配置体现“可解释优先、精度增强并行”的工程原则。实践中不建议直接用黑箱模型替代主控制链路，而应采用“双轨运行 + 一键回退”的发布机制。

[图10-2: 例10-1 四模型精度-时耗帕累托图]
{描述: 横轴单步计算时长，纵轴水位RMSE；标注三类上线区域：优选、可用、仅回退。}
{尺寸: 半页}
{颜色方案: 蓝色系}

## 10.6 在环测试与上线门禁

ROM 上线前需通过 MIL、SIL、HIL 三级门禁：

- **MIL**：验证模型结构正确、参数稳定、约束处理有效；
- **SIL**：在调度软件栈中验证接口一致性、时序完整性与异常处理；
- **HIL**：连接真实控制器与通信链路，验证延时、抖动、失包下的鲁棒性。

建议门禁阈值示例：

- 水位 RMSE：常态 < 0.08 m，扰动工况 < 0.12 m；
- 约束触发后恢复时间：< 3 个控制周期；
- 计算超时率：< 0.5%；
- 异常回退成功率：> 99%。

[TODO: 需补充胶东调水现场验收报告中的最终阈值版本号与签批信息。]

## 10.7 运行成效与失效复盘

基于已部署 ROM 的运行记录，可从三类指标评估收益：

1. **运行质量**：目标断面水位波动降低、供水稳定性提升；
2. **调度效率**：人工干预频次下降、策略计算时长稳定；
3. **安全与运维**：异常可定位性增强、回退路径明确。

同时应保留失效复盘机制。常见问题包括：

- 季节切换后参数老化；
- 传感器偏置导致模型长期漂移；
- 检修拓扑变化后旧模型继续运行。

对应处置策略：

- 建立“固定周期 + 事件触发”双重重标定；
- 在 SCADA 侧部署偏置诊断并自动告警；
- 将拓扑变更纳入上线前置检查单。

## 10.8 实施要点与踩坑清单

### 10.8.1 实施要点

- 主链路优先采用可解释 ROM（如 IDZ/Transfer Function）；
- 增强链路可引入数据驱动残差，但必须可切除；
- 模型参数、版本、ODD 与门禁结果必须可审计；
- 与 HydroOS 调度引擎接口需版本锁定，避免“模型可用、接口失配”。

### 10.8.2 常见踩坑

- **坑1：** 仅按年度平均指标评估，忽略极端工况；
- **坑2：** 上线后未持续监测，导致漂移积累；
- **坑3：** 回退策略只写文档、不做演练；
- **坑4：** 将“高精度”误判为“高可用”。

## 10.9 本章小结

本章给出了胶东调水降阶建模的工程化全流程：以 ODD 分层确定适用域，以多候选 ROM 并行辨识形成技术储备，以 MIL/SIL/HIL 门禁控制上线风险，以持续监测和回退机制保障长期可运行。核心结论是：ROM 的价值不只在“拟合更准”，更在“可部署、可维护、可审计、可回退”。至此，M1 全书完成了从理论基础、方法体系到工程落地的闭环，为后续《水网预测控制》（M2）中的模型预测控制（MPC）工程部署奠定统一模型底座。

## 习题

### 基础题

1. 为什么胶东调水 ROM 需要按 ODD 子域管理参数，而不建议全年单参数运行？  
2. 在 Transfer Function 与 IDZ 的工程选型中，应重点比较哪些维度？  
3. 为什么在工程上线中必须保留 Muskingum 类回退通道？

### 应用题

4. 给定某渠段四类 ROM 的 RMSE、计算时长与故障率数据，按“硬约束优先 + 加权评分”给出上线与回退方案。  
5. 设计一份 HIL 验收用例清单，至少包含通信延时抖动、传感器偏置与执行器限位三类异常场景。

### 思考题

6. 若现场团队偏好“更高精度黑箱模型”，而运维团队偏好“可解释低阶模型”，你如何设计双轨发布策略以平衡短期绩效与长期可靠性？

### 基础题参考答案要点

1. 因季节、负荷、检修与边界扰动会改变动力学特征；分域建模可降低系统性偏差并提升可维护性。  
2. 比较精度、实时性、稳健性、可维护性与可审计性，而非仅看单一误差。  
3. Muskingum 类模型结构稳健、实现简单，适合作为故障或异常工况下的保底回退链路。

## 拓展阅读

1. Van Overloop, P.J. (2006). *Model Predictive Control on Open Water Systems*.  
2. Litrico, X. & Fromion, V. (2009). *Modeling and Control of Hydrosystems*.  
3. ASCE (2014). *MOP 131: Canal Automation for Irrigation Systems*.  
4. Lei et al. (2025a). 理论背景与研究范式.  
5. Lei et al. (2025c). 在环测试系统.

> **术语一致性声明**：本章统一采用“降阶模型（Reduced-Order Model, ROM）”“运行设计域（Operational Design Domain, ODD）”“安全包络（Safety Envelope）”“在环测试（In-the-Loop Testing）”“分层分布式控制（Hierarchical Distributed Control, HDC）”“模型预测控制（Model Predictive Control, MPC）”“水网操作系统（Water Network Operating System, HydroOS）”等规范术语；数学符号使用 $Q, h, c, \tau, J$ 等统一记号。

### 质量检查清单（执行结果）

- [x] 章首含学习目标（5条）；  
- [x] 章末含本章小结（500字以内）；  
- [x] 章末含习题（基础题3 + 应用题2 + 思考题1）；  
- [x] 章末含拓展阅读（5篇）；  
- [x] 章首回顾前章关键结论，章末给出跨书衔接（M2）；  
- [x] 新概念控制在10个以内并给出首次定义；  
- [x] 包含可复现实例（例10-1）及结果讨论；  
- [x] 图表不少于2项（图10-1、图10-2、表10-1）。
