<!-- 变更日志
v1 2026-02-16: 初稿
-->

# ch02 MPC基本理论

## 2.1 学习目标

完成本章学习后，读者应能够：

1. 理解模型预测控制（Model Predictive Control, MPC）的滚动优化与反馈校正机制；
2. 掌握预测模型、目标函数与约束集合的标准建模方法；
3. 区分递归可行性、闭环稳定性与鲁棒性的核心含义；
4. 理解线性二次型 MPC 与终端约束/终端代价的关系；
5. 为后续线性与非线性水网MPC实现建立统一理论基础。

> 本章承接 ch01 的问题定义：ch01回答“为什么用MPC”，本章回答“如何保证MPC在理论上可行、稳定并可工程实现”。

## 2.2 MPC的基本结构

MPC 在每个采样时刻执行“预测—优化—执行—更新”四步：

1. 读取当前状态估计 $\mathbf{x}_k$；
2. 基于模型预测未来 $N_p$ 步行为；
3. 求解带约束优化问题得到控制序列 $\mathbf{u}_{k:k+N_c-1}$；
4. 仅施加首个控制量 $\mathbf{u}_k$，下时刻滚动重算。

[物理直觉] 这相当于驾驶员“每几秒重规划一次路线”，而不是一次规划到终点后不再修正。

[图2-1: MPC滚动优化机制示意]
{描述: 展示预测窗口、控制窗口、滚动时移和仅执行首控量的流程。}
{尺寸: 全页}
{颜色方案: 蓝色系}

## 2.3 标准优化问题

以离散线性模型为例：

$$
\mathbf{x}_{k+1}=\mathbf{A}\mathbf{x}_k+\mathbf{B}\mathbf{u}_k,\quad
\mathbf{y}_k=\mathbf{C}\mathbf{x}_k
$$

定义代价函数：

$$
J=\sum_{i=1}^{N_p}\|\mathbf{y}_{k+i}-\mathbf{y}_{k+i}^{ref}\|_{Q_y}^2+\sum_{i=0}^{N_c-1}\|\Delta\mathbf{u}_{k+i}\|_{R_u}^2+\|\mathbf{x}_{k+N_p}\|_{P}^2
$$

约束集合：

$$
\mathbf{x}_{k+i}\in\mathcal{X},\quad \mathbf{u}_{k+i}\in\mathcal{U},\quad \Delta\mathbf{u}_{k+i}\in\Delta\mathcal{U}
$$

[工程解释] 在水网中，$\mathcal{X}$ 对应水位/库容安全区间，$\mathcal{U}$ 对应闸门与泵站执行边界，$\Delta\mathcal{U}$ 对应设备动作率与运维约束。

## 2.4 递归可行性与稳定性

### 2.4.1 递归可行性

若在时刻 $k$ 可行，且控制律与终端集合设计得当，则在 $k+1$ 仍可行。该性质可避免“本步有解、下步无解”的在线失效。

常用保障手段：

- 终端约束 $\mathbf{x}_{k+N_p}\in\mathcal{X}_f$；
- 终端控制律 $\kappa_f(\mathbf{x})$ 在 $\mathcal{X}_f$ 内保持不变性；
- 软约束与罚函数防止突发扰动导致无解。

### 2.4.2 闭环稳定性

在二次型代价与适当终端权重 $P$ 条件下，可构造 Lyapunov 下降关系，保证闭环状态收敛或有界稳定。

[物理直觉] 稳定性并不意味着“每一步都更好”，而是长期趋势受控并最终进入可接受邻域。

## 2.5 鲁棒MPC基本思想

实际水网存在模型失配、测量噪声和外扰。鲁棒MPC的典型路径包括：

1. **管状MPC（Tube MPC）**：名义轨迹 + 误差管约束；
2. **最坏情形优化**：对扰动集合求保守可行解；
3. **情景MPC**：采样扰动场景进行概率约束优化。

[表2-1: 三类鲁棒MPC方法比较]
{描述: 对比建模假设、计算复杂度、保守性、工程适配性。}
{尺寸: 半页}
{颜色方案: 灰度}

## 2.6 可复现实例：线性MPC可行性设置

【例2-1】某单渠段线性模型在采样周期 5 min 下运行。设 $N_p=10, N_c=4$，状态约束为 $h\in[2.6,3.2]$ m，控制增量约束 $\Delta u\in[-2\%,2\%]$。

**已知**：
- 初始状态靠近上限：$h_0=3.15$ m；
- 来水扰动在小范围内波动；
- 若优化无解则触发回退 PI 控制。

**求解**：说明如何通过终端集合与软约束减少“无解触发”概率。

**解题过程**：

1. 设置终端目标区间 $\mathcal{X}_f=[2.8,3.0]$ m；
2. 对状态约束引入非负松弛变量并施加大权重惩罚；
3. 保留回退 PI 作为兜底，避免控制中断。

**结果讨论**：
终端集合提供“可达收敛区”，软约束提供“可解缓冲层”，二者配合可显著提升在线可用性。

## 2.7 本章小结

本章建立了水网MPC的理论骨架：通过标准优化问题统一描述预测模型、目标函数与约束集合；通过终端集合、终端代价与软约束机制保障递归可行性与闭环稳定性；通过 Tube/最坏情形/情景方法应对不确定性。下一章将进入线性MPC在明渠系统中的建模与实现细节。

## 习题

### 基础题

1. 解释递归可行性与闭环稳定性的区别与联系。
2. 为什么MPC只执行首个控制量而不一次性执行整段序列？
3. 终端约束与软约束在工程上分别解决什么问题？

### 应用题

4. 给定线性渠段模型和约束区间，构建一组可用于求解器输入的MPC标准矩阵。  
5. 设计一套“无解触发—降级回退—恢复上线”的状态机逻辑，并说明门禁条件。

### 思考题

6. 在“保守性高但安全余量大”和“性能高但风险更敏感”之间，你将如何制定项目阶段性参数策略？

### 基础题参考答案要点

1. 递归可行性关注“每步都有解”，稳定性关注“闭环长期受控/收敛”；两者共同决定可上线性。  
2. 为利用新观测持续纠偏、抑制模型失配误差累积。  
3. 终端约束保障长期收敛结构，软约束保障突发工况下问题仍可解。

## 拓展阅读

1. Rawlings, J.B., Mayne, D.Q. & Diehl, M. (2017). *Model Predictive Control: Theory, Computation, and Design*.  
2. Mayne, D.Q. et al. (2000). Constrained MPC: Stability and optimality.  
3. Kouvaritakis, B. & Cannon, M. (2016). *Model Predictive Control*.  
4. Van Overloop, P.J. (2006). *Model Predictive Control on Open Water Systems*.  
5. Lei et al. (2025b). 自主智能水网架构。

> **术语一致性声明**：本章统一采用“模型预测控制（Model Predictive Control, MPC）”“运行设计域（Operational Design Domain, ODD）”“安全包络（Safety Envelope）”“在环测试（In-the-Loop Testing）”等规范术语；数学符号采用 $Q, h, \tau, T_p, T_c, \mathbf{x}, \mathbf{u}, \mathbf{y}, \mathbf{A,B,C,D}, J$。

### 质量检查清单（执行结果）

- [x] 章首学习目标、章末小结/习题/拓展阅读完整；
- [x] 基础题3 + 应用题2 + 思考题1，含基础题答案要点；
- [x] 公式前有物理直觉，公式后有工程解释；
- [x] 含可复现实例（例2-1）；
- [x] 图表不少于2项（图2-1、表2-1）；
- [x] 章首回顾ch01，章末预告ch03。
