<!-- 变更日志
v1 2026-02-16: 初稿（基于“继续”命令自动续写）
-->

# ch04 运行决策与多目标优化

## 学习目标

完成本章后，读者应能够：

1. 说明运行决策问题的目标、约束与可行域；
2. 建立安全—效率—治理三目标的统一优化表达；
3. 理解决策权重敏感性并解释其工程含义；
4. 使用策略发布前门禁检查单完成上线前核验；
5. 为 ch05 的协同调度与分层执行建立接口。

> 承接 ch03：上一章给出过程模型与不确定性表达，本章回答“在不确定环境中如何做可执行决策”。

> **前章回顾**：上一章介绍了本领域的核心概念与方法。本章在此基础上进一步展开。


## 运行决策问题的标准表达

在离散时刻 $k$，运行团队需要根据状态估计 $\hat{\mathbf{x}}_k$ 与预测信息，选择控制动作序列 $\mathbf{u}_{k:k+T_c-1}$。

可写成统一优化问题：

$$
\min_{\mathbf{u}}\; J = w_s J_s + w_e J_e + w_g J_g
$$

subject to

$$
\mathbf{x}_{i+1}=f(\mathbf{x}_i,\mathbf{u}_i,\mathbf{d}_i),\quad
\mathbf{x}_i\in\mathcal{X},\;\mathbf{u}_i\in\mathcal{U},\;\mathbf{y}_i\in\mathcal{Y}_{safe}
$$

其中 $J_s,J_e,J_g$ 分别对应安全、效率、治理代价，$w_s,w_e,w_g$ 为权重系数。

[物理直觉] 决策不是“单指标最优”，而是“底线不破+收益可接受+流程可审计”的折中。

[图4-1: 运行决策闭环图]
{描述: 展示“状态估计→候选策略→约束校验→门禁发布→执行反馈→复盘更新”闭环。}
{尺寸: 全页}
{颜色方案: 蓝色系}

## 可行域与约束冲突解释（补齐 ch03 跟踪项）

### 4.3.1 可行域定义

可行域是满足全部约束的控制动作集合：

$$
\mathcal{F}=\left\{\mathbf{u}\;\middle|\; \mathbf{u}\in\mathcal{U},\;\mathbf{x}(\mathbf{u})\in\mathcal{X},\;\mathbf{y}(\mathbf{u})\in\mathcal{Y}_{safe}\right\}
$$

若 $\mathcal{F}=\emptyset$，表示约束冲突已导致“无可执行策略”，必须触发降级与人工会商。

### 4.3.2 典型冲突场景

- 安全约束与效率目标冲突：极端来水下既要控水位又要保供；
- 设备约束与调峰需求冲突：机组检修期难以满足高频调峰；
- 治理约束与应急速度冲突：紧急处置与审批留痕之间的时效矛盾。

[工程解释] 约束冲突不是算法失败，而是系统进入“权衡决策”状态，需显式记录取舍依据。

[图4-2: 约束冲突下的可行域示意图]
{描述: 以二维示意展示安全约束、设备约束与业务目标交叠区域，标注可行域收缩与空集情形。}
{尺寸: 半页}
{颜色方案: 灰度}

## 多目标权重敏感性分析（补齐 ch03 跟踪项）

定义权重向量 $\mathbf{w}=[w_s,w_e,w_g]^\top$，且 $w_s+w_e+w_g=1$。

对某一权重分量的敏感性可近似表示为：

$$
S_{w_j}=\frac{\Delta J^* / J^*}{\Delta w_j / w_j}
$$

其中 $J^*$ 为最优代价值。$|S_{w_j}|$ 越大，表示最优策略对该权重越敏感。

[物理直觉] 若策略对安全权重轻微变化就大幅跳变，说明系统处于“安全边界附近”，应优先增加缓冲能力而非继续压缩成本。

建议课堂与工程中做三组对比：

1. 安全优先：$w_s=0.6,w_e=0.3,w_g=0.1$；
2. 均衡策略：$w_s=0.4,w_e=0.4,w_g=0.2$；
3. 效率优先：$w_s=0.3,w_e=0.6,w_g=0.1$。

[表4-1: 不同权重下策略结果对比模板]
{描述: 列包括权重组合、越界风险、达成率、动作总变差、工单负荷、综合评价。}
{尺寸: 全页}
{颜色方案: 灰度}

## 策略发布前门禁检查单（补齐 ch03 跟踪项）

为保证策略“可执行、可追溯、可回退”，建议发布前执行 8 项检查：

1. 安全包络预测是否留有裕度？
2. 关键设备可用状态是否最新？
3. 预测误差是否处于绿色/黄色可控区间？
4. 候选策略是否通过约束一致性检查？
5. 回退策略与最小风险状态（MRS）是否已绑定？
6. 指令审批链与责任人是否明确？
7. 日志字段与审计留痕是否完整？
8. 发布窗口与现场沟通是否确认？

[表4-2: 策略发布前门禁检查单]
{描述: 列包括检查项、通过标准、证据来源、责任角色、不通过处置。}
{尺寸: 全页}
{颜色方案: 灰度}

[工程解释] 门禁检查单是“低成本高收益”工具，可显著减少上线后返工与责任不清。

## 决策执行与回退机制

建议采用“两段式执行”：

- **预发布阶段**：小步试运行，监测关键指标漂移；
- **正式发布阶段**：按设定节奏放开动作幅度，持续评估约束占用率。

若触发以下任一条件，应立即回退：

- 预测误差连续超红色阈值；
- 安全包络裕度低于最小阈值；
- 关键设备状态突变且无法快速验证。

回退后应在 30 分钟内形成简版复盘，24 小时内形成完整复盘。

## 可复现实例：供水与调峰冲突下的权重重设

【例4-1】某日傍晚，区域供水需求上升且电网调峰指令增加，同时一台机组进入降额运行。

已知：

- 初始权重：$[w_s,w_e,w_g]=[0.4,0.5,0.1]$；
- 试运行 20 分钟后，安全裕度接近黄色边界；
- 工单系统提示两项关键审批未闭环。

**任务**：给出策略调整与发布决策。

**解题过程**：
1. 先执行门禁检查单，发现治理项未通过，暂停正式发布；
2. 将权重调整为 $[0.55,0.30,0.15]$，重新求解候选策略；
3. 验证约束可行域未空且安全裕度恢复；
4. 采用预发布阶段运行 10 分钟，确认误差与告警可控后再正式发布；
5. 记录“权重重设—结果改善”证据链用于班后复盘。

**结果讨论**：
该案例体现“先门禁、后发布；先安全、再效率；全过程可追溯”的运行原则。

## 本章小结

本章给出运行决策与多目标优化的标准表达，补充了约束冲突下可行域解释、权重敏感性分析与策略发布前门禁检查单，形成从“求解策略”到“安全发布”的完整流程。下一章将进入多层级协同调度与执行机制。

## 习题

### 基础题

**4-1.** 为什么运行决策问题必须同时写出目标函数与约束集合？
**4-2.** 解释“可行域为空”在工程上意味着什么。
**4-3.** 权重敏感性指标 $S_{w_j}$ 的作用是什么？

### 应用题

**4-4.** 为一个泵站+水库联合场景设计权重组合，并说明在枯水与丰水工况下如何切换。  
**4-5.** 依据表4-2模板，编制一份不少于10项的本单位策略发布门禁清单。

### 思考题

**4-6.** 若管理层要求“效率优先”，但运行团队判定安全裕度不足，应如何在治理层面达成一致？

### 基础题参考答案要点

**4-7.** 只有目标没有约束会导致不可执行，只有约束没有目标无法比较优劣。  
**4-8.** 表示现有条件下无任何策略可同时满足底线要求，必须降级或重设目标。  
**4-9.** 用于判断最优策略对权重变化是否稳定，辅助制定稳健权重方案。

## 拓展阅读

1. **Boyd, S. & Vandenberghe, L. (2004). *Convex Optimization*.**
2. **Rawlings, J.B. et al. (2020). *Model Predictive Control: Theory, Computation, and Design*.**
3. **Lei et al. (2025b). 自主智能水网架构与运行决策。**
4. **ISO 31000 (Risk Management Guidelines).**
5. **Van Overloop, P.J. (2006). *Model Predictive Control on Open Water Systems*.**
