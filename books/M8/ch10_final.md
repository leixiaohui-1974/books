<!-- 变更日志
v1 2026-02-16: 初稿（基于“继续”命令自动续写）
-->

# ch10 认知智能+ODD+HDC控制设计

## 10.1 学习目标

完成本章后，读者应能够：

1. 构建“认知智能+ODD+HDC”三位一体控制架构；
2. 将 ch09 的一体化模型映射为可发布的多层控制器设计；
3. 定义 ODD 运行域分级与跨域切换门禁条件；
4. 设计认知 AI 告警解释变量与人机切换闭环；
5. 输出可直接用于 ch11 梯级一键调的跨站协同接口模板。

> 承接 ch09：上一章解决“可计算模型”，本章解决“可发布、可解释、可回退”的工程控制设计。

## 10.2 总体架构：模型在内核，认知在外环

沙坪场景建议采用“三层两环”结构：

- **控制执行层（L1）**：机组/闸门跟踪控制与联锁保护；
- **优化调度层（L2）**：基于 ch09 模型滚动求解发电-泄洪协同计划；
- **认知协同层（L3）**：对风险、工况与策略可行性做语义解释与门禁建议。

两条关键闭环：

1. **物理闭环**：状态估计 → L2优化 → L1执行 → 反馈修正；
2. **治理闭环**：告警解释 → 人机确认 → 发布门禁 → 审计复盘。

[图10-1: 认知智能+ODD+HDC三层两环架构]
{描述: L1/L2/L3纵向分层，左侧为物理闭环，右侧为治理闭环；标注门禁检查点与回退路径。}
{尺寸: 全页}
{颜色方案: 蓝色系}
{对应ARCH编号: ARCH-03}

## 10.3 ODD 定义与分域运行策略

### 10.3.1 ODD 核心维度

沙坪控制 ODD 建议至少包含以下维度：

- 水文维度：来水等级、预报可信度、上涨速率；
- 设备维度：机组可用率、闸门健康度、通信质量；
- 电网维度：负荷指令波动幅度、调峰窗口长度；
- 治理维度：值班配置、人工确认时延、审计链完整度。

[工程解释] ODD 不是“天气条件”单一标签，而是决定控制策略可发布性的多条件联合集合。

### 10.3.2 ODD 分区建议

- **ODD-G（绿色）**：模型预测误差与设备健康均在稳态区，可全功能自动运行；
- **ODD-Y（黄色）**：存在中等不确定性，需启用增强监控与受限自动；
- **ODD-R（红色）**：超出自动运行能力，强制进入最小风险状态并提高人工接管级别。

[表10-1: ODD分区—控制权限—门禁动作对照]
{描述: 列包括ODD分区、触发条件、允许控制功能、必须门禁、人工确认要求、回退等级。}
{尺寸: 半页}
{颜色方案: 灰度}
{对应ARCH编号: ARCH-02}

## 10.4 门禁状态机设计（补齐 ch09/ch08 跟踪项）

### 10.4.1 门禁状态

定义发布门禁状态 `release_gate`：

- `OPEN`：允许策略自动发布；
- `LIMITED`：仅允许降级策略或人工确认后发布；
- `CLOSED`：禁止新策略下发，仅允许安全回退动作。

### 10.4.2 状态转移规则

[物理直觉] 当预测误差增大、设备可用性下降、或治理链条中断时，系统应先收紧权限再谈优化收益。

可定义门禁评分：

$$
G_k=\alpha_1 C_{model,k}+\alpha_2 C_{asset,k}+\alpha_3 C_{ops,k}+\alpha_4 C_{audit,k}
$$

其中 $C_{model},C_{asset},C_{ops},C_{audit}\in[0,1]$，且 $\sum\alpha_i=1$。

门禁决策：

$$
\text{if } G_k\ge\theta_{open}:\,release\_gate=OPEN
$$

$$
\text{if } \theta_{limited}\le G_k<\theta_{open}:\,release\_gate=LIMITED
$$

$$
\text{if } G_k<\theta_{limited}:\,release\_gate=CLOSED
$$

[工程解释] 该机制将“模型质量、设备健康、运维状态、审计完备性”统一到一个可追踪阈值框架。

[图10-2: ODD与门禁状态机联动图]
{描述: 展示ODD-G/Y/R与OPEN/LIMITED/CLOSED之间的触发与回退关系，包含MRS路径。}
{尺寸: 全页}
{颜色方案: 蓝色系}

## 10.5 认知 AI 告警解释变量模板（补齐评审建议）

为提升可解释性，认知 AI 输出不应只有“告警级别”，还需给出解释变量包：

- `risk_driver_topk`：主导风险因子（如来水突增、机组可用性下降）；
- `constraint_violation_forecast`：预测窗口内潜在违约类型；
- `confidence_score`：建议可信度；
- `recommended_action_set`：推荐动作集合（降载、预泄、切换门禁）；
- `human_review_required`：是否必须人工复核；
- `evidence_trace_id`：证据链索引。

[表10-2: 认知AI告警解释字段模板]
{描述: 列包括字段名、类型、示例、来源模型、刷新周期、审计要求。}
{尺寸: 全页}
{颜色方案: 灰度}

[工程解释] “可解释”不是附加文案，而是每次决策都能落到可追溯字段，支持值班人员快速判断是否接管。

## 10.6 人机切换与回退策略

### 10.6.1 人机切换触发

触发人工接管的典型条件：

- 连续 $n$ 个窗口 `confidence_score` 低于阈值；
- 关键硬约束进入高风险邻域；
- 门禁状态降为 `CLOSED`；
- 通信/测控链异常导致观测不可用。

### 10.6.2 回退层级

- **R1**：自动降级（保守权重、限幅控制）；
- **R2**：半自动（人工确认后执行建议动作）；
- **R3**：人工主控（系统仅提供风险提示与记录）。

[表10-3: 人机切换门禁模板]
{描述: 列包括触发事件、门禁状态、允许动作、确认责任人、最大响应时限、审计字段。}
{尺寸: 半页}
{颜色方案: 灰度}

## 10.7 HDC 控制器配置与接口

为对接 ch11 梯级一键调，建议预留跨站协同接口：

- `cascade_sync_token`：跨站计划一致性标识；
- `coordination_latency_budget_ms`：跨站协调时延预算；
- `upstream_intent_vector` / `downstream_capacity_vector`；
- `gate_override_permission`：应急越权标志；
- `cross_station_fallback_policy_id`。

[工程解释] 跨站一键调失败往往不是算法问题，而是接口语义不一致或时延预算未定义。

## 10.8 可复现实例：ODD-Y 到 ODD-R 的切换处置

【例10-1】晚高峰叠加突发降雨，来水不确定性上升且一台机组振动告警。已知：

- `C_model` 下降至 0.55；
- `C_asset` 下降至 0.50；
- `C_ops` 保持 0.80；
- `C_audit` 保持 0.95；
- 当前阈值：$\theta_{open}=0.75,\,\theta_{limited}=0.60$。

**任务**：判断门禁状态并给出处置链路。

**解题过程**：
1. 计算 $G_k$（按既定权重）并判断是否跌破 `LIMITED` 下限；
2. 若 `G_k<0.60`，将 `release_gate` 切换为 `CLOSED`，触发 MRS；
3. 认知 AI 输出 `risk_driver_topk` 与 `recommended_action_set`；
4. 值班长执行 R2/R3 切换并记录 `operator_action_log`；
5. 工况恢复后按状态机逐级退出。

**结果讨论**：
该案例体现“先门禁、后优化、可解释、可回退”的工程原则。

## 10.9 本章小结

本章完成了沙坪“认知智能+ODD+HDC”控制设计，补齐了 ODD 切换条件、门禁状态机、认知 AI 解释变量模板和人机切换流程，为 ch11 梯级一键调提供统一控制与治理接口。

## 习题

### 基础题

1. ODD-G、ODD-Y、ODD-R 的核心差异是什么？
2. 说明 `release_gate` 三种状态的权限边界。
3. 为什么认知 AI 必须输出解释变量而非仅输出告警等级？

### 应用题

4. 设计一个包含 6 个指标的门禁评分模型并给出阈值划分。  
5. 基于一次通信异常，写出“自动降级→人工接管→恢复发布”的流程图。

### 思考题

6. 当认知 AI 建议与值班工程师判断冲突时，如何在效率与责任之间平衡？

### 基础题参考答案要点

1. 差异在于工况可控性与自动控制权限：G可全自动，Y受限自动，R需最小风险运行与人工增强。  
2. `OPEN`可自动发布，`LIMITED`需限制或确认，`CLOSED`禁止新策略仅保安全动作。  
3. 因工程决策需要证据链，解释变量支持追责、复盘与模型迭代。

## 拓展阅读

1. Lei et al. (2025b). 自主智能水网架构。  
2. Lei et al. (2025c). 在环测试系统与发布门禁。  
3. IEC 61508 (Functional Safety).  
4. ISO 31000 (Risk Management Guidelines).  
5. Kundur, P. (1994). *Power System Stability and Control*.

> **术语一致性声明**：本章统一采用“运行设计域（Operational Design Domain, ODD）”“分层分布式控制（Hierarchical Distributed Control, HDC）”“认知AI引擎（Cognitive AI Engine）”“安全包络（Safety Envelope）”“模型预测控制（Model Predictive Control, MPC）”“在环测试（In-the-Loop Testing）”等规范术语；数学符号采用 $Q,h,\tau,T_p,T_c,\mathbf{x},\mathbf{u},\mathbf{y},J$。

### 质量检查清单（执行结果）

- [x] 章首学习目标、章末小结/习题/拓展阅读完整；
- [x] 基础题3 + 应用题2 + 思考题1，含基础题答案要点；
- [x] 公式前有物理直觉，公式后有工程解释；
- [x] 含可复现实例（例10-1）；
- [x] 图表不少于2项（图10-1、图10-2、表10-1、表10-2、表10-3）；
- [x] 章首回顾ch09，章末预告ch11；
- [x] 已补齐ch08/ch09提出的ODD切换、门禁状态、认知AI解释变量模板跟踪项。
