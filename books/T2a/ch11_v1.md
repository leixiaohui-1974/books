<!-- 变更日志
v1 2026-02-16: 初稿
-->

# 第十一章 水系统状态估计与数据融合

---

## 学习目标

完成本章后，你应能够：

1. 解释状态估计在“不可全测”水系统中的必要性；
2. 区分 Kalman Filter、EKF、UKF 与粒子滤波适用场景；
3. 设计多源数据融合结构与异常数据处理流程；
4. 将估计结果与安全包络、MPC、联锁系统形成闭环；
5. 建立“可用、可信、可追溯”的在线估计工程规范。

> **章首衔接（承接ch10）**  
> 上一章定义了安全边界与联锁规则。本章回答“边界判定依据从何而来”：通过状态估计与数据融合，为控制与安全监测提供可信状态。

## 11.1 为什么必须做状态估计

[物理直觉] 现场可直接测得的是水位、流量、闸位等离散观测量，而真正用于控制的往往是“系统状态向量”，例如分段水体储量、扰动项、执行器偏差等。仅靠原始测点难以直接获得完整状态。

[公式]
\[
\mathbf{x}_{k+1}=f(\mathbf{x}_k,\mathbf{u}_k,\mathbf{w}_k),\qquad
\mathbf{y}_k=h(\mathbf{x}_k,\mathbf{v}_k)
\]

[工程解释] 估计器的任务是在模型与观测之间求平衡，输出最可信的 \(\hat{\mathbf{x}}_k\)，并给出不确定度用于风险判断。

## 11.2 线性高斯场景：Kalman Filter

对于线性系统：
\[
\mathbf{x}_{k+1}=A\mathbf{x}_k+B\mathbf{u}_k+\mathbf{w}_k,
\quad
\mathbf{y}_k=C\mathbf{x}_k+\mathbf{v}_k
\]

Kalman Filter 包含“预测-更新”两步：

1. 预测：\(\hat{\mathbf{x}}_{k|k-1}=A\hat{\mathbf{x}}_{k-1|k-1}+B\mathbf{u}_{k-1}\)
2. 更新：\(\hat{\mathbf{x}}_{k|k}=\hat{\mathbf{x}}_{k|k-1}+K_k(\mathbf{y}_k-C\hat{\mathbf{x}}_{k|k-1})\)

[工程提示] 过程噪声协方差 \(Q\) 与测量噪声协方差 \(R\) 决定“信模型还是信传感器”，需通过历史数据与工况分段标定。

## 11.3 非线性场景：EKF、UKF 与粒子滤波

### 11.3.1 EKF（扩展Kalman滤波）

通过一阶线性化处理非线性系统，计算量低，工程部署成熟；但在强非线性与大扰动场景中易出现线性化误差积累。

### 11.3.2 UKF（无迹Kalman滤波）

用 sigma 点传播均值与协方差，通常比EKF在中等非线性问题更稳健，不需要显式雅可比矩阵。

### 11.3.3 粒子滤波（PF）

以样本粒子近似后验分布，适合非高斯、强非线性问题，但计算代价更高，需要重采样防止粒子退化。

[表11-1: 三类非线性滤波器对比]
| 方法 | 优点 | 局限 | 典型场景 |
|---|---|---|---|
| EKF | 易实现、实时性好 | 线性化误差 | 中小型泵闸控制 |
| UKF | 精度与稳健性较好 | 参数调试稍复杂 | 非线性渠道-闸群 |
| PF | 可处理复杂分布 | 计算开销大 | 极端工况诊断 |

## 11.4 多源数据融合架构

水系统常见数据源包括：SCADA实时测点、边缘设备高频信号、气象预报、人工巡检记录。推荐两级融合：

1. **边缘层快融合**：做时间对齐、异常剔除、短时插补；
2. **中心层慢融合**：与模型同化，输出控制级状态估计。

[图11-1: 水系统状态估计与数据融合双层架构]
{描述: 左侧多源数据输入（SCADA、边缘设备、气象、巡检），中间为边缘快融合与中心慢融合，右侧输出给MPC、安全包络监测与联锁审计。}
{尺寸: 全页}
{颜色方案: 蓝色系}
{对应ARCH编号: ARCH-04（融合架构思想借鉴）}

## 11.5 异常检测与故障隔离（FDI）

残差定义：
\[
\mathbf{r}_k=\mathbf{y}_k-\hat{\mathbf{y}}_k
\]

当 \(\|\mathbf{r}_k\|\) 持续超阈值时，需触发故障流程：

1. 传感器健康度评估；
2. 冗余测点交叉验证；
3. 切换降级估计模式；
4. 记录事件并上送运维平台。

[工程说明] 异常检测不是“删掉坏点”这么简单，必须同时保障控制连续性与审计可追溯。

## 11.6 例题：渠道关键断面缺测时的状态重建

【例11-1】某关键断面水位传感器短时失联 15 分钟，要求维持MPC闭环运行并保证安全约束不越界。

**解题过程**：

步骤1：启用缺测标志并冻结该测点直接观测通道。  
步骤2：使用 EKF/UKF 基于上游流量、闸位与邻近水位进行状态重建。  
步骤3：提升约束保守系数，限制控制增量 \(\Delta u\)。  
步骤4：若残差持续恶化，触发黄区处置并准备MRS切换。  
步骤5：测点恢复后执行平滑回切并完成事件审计。

**结果讨论**：

短时缺测不应直接导致停控，但必须“估计可信度下降→控制保守化→必要时降级”，形成可验证处置链。

### 状态估计上线检查清单

- [ ] 是否完成测点时间同步与统一时钟校核；
- [ ] 是否建立Q/R分工况标定与版本管理；
- [ ] 是否具备缺测、漂移、卡死三类故障注入测试；
- [ ] 是否定义估计可信度阈值与降级触发规则；
- [ ] 是否打通估计日志、联锁日志与运维审计字段。

## 11.7 本章小结

本章建立了“模型+观测+统计”的状态估计主线，给出从Kalman到非线性滤波、从融合架构到FDI处置的工程闭环。核心结论是：没有可信状态，就没有可信控制与安全判定。下一章将进入系统辨识与参数在线更新，进一步提升模型与估计的一致性。

## 习题

### 基础题

1. 为什么水系统控制不能只依赖原始测点值？  
2. EKF 与 UKF 的核心差异是什么？  
3. 解释残差 \(r_k\) 在异常检测中的作用。

### 应用题

4. 为一个“3测点+1缺测冗余点”泵站设计简化融合流程。  
5. 设计一次“传感器漂移”故障注入实验，并给出处置触发条件。

### 思考题

6. 当估计精度与实时性冲突时，如何在工程上做取舍？

## 拓展阅读

1. Kalman, R.E. (1960). A New Approach to Linear Filtering and Prediction Problems.  
2. Simon, D. *Optimal State Estimation*.  
3. Rawlings, J.B. et al. *Model Predictive Control*.  
4. 钱学森. 《工程控制论》.  
5. Lei et al. (2025c). 水网在环验证与运行监测框架。
