<ama-doc>
## 10.4 胶东调水MPC应用

### 10.4.1 引言

模型预测控制（Model Predictive Control, MPC）是一种先进的控制策略，广泛应用于工业过程控制领域。MPC基于系统数学模型，通过滚动优化和反馈校正，实现多变量、多约束系统的优化控制[1]。与传统PID控制相比，MPC具有处理多变量、多约束、大滞后系统的优势，在过程工业中得到了广泛应用。

在调水工程中，MPC技术可用于泵站优化调度、水位控制、压力调节等场景，实现节能降耗、提高供水质量的目标。本节以胶东调水工程为对象，研究MPC技术在泵站优化调度中的应用[2]。

### 10.4.2 MPC基本原理

#### 10.4.2.1 MPC控制框架

MPC采用"预测-优化-实施"的滚动优化框架，这是MPC区别于传统控制策略的核心特征[3]：

**（1）预测模型**

基于系统数学模型，预测未来一定时域内的系统状态：

$$
\hat{x}(k+i|k), \quad i = 1, 2, ..., N_p
$$

式中：$\hat{x}(k+i|k)$为在$k$时刻预测的$k+i$时刻状态；$N_p$为预测时域。预测模型可以是状态空间模型、传递函数模型或神经网络模型。

**（2）滚动优化**

在每个采样时刻，求解一个开环优化问题，得到最优控制序列：

$$
\min_{u} J = \sum_{i=1}^{N_p} ||\hat{x}(k+i|k) - x_{ref}||_Q^2 + \sum_{i=0}^{N_c-1} ||\Delta u(k+i|k)||_R^2
$$

式中：$x_{ref}$为参考轨迹；$Q$、$R$为权重矩阵；$N_c$为控制时域。优化目标通常包括跟踪误差最小化和控制量变化最小化[4]。

**（3）反馈校正**

将优化得到的控制序列的第一个元素作用于系统，在下一采样时刻重新进行预测和优化。这种滚动优化机制使MPC能够处理模型不确定性和外部扰动。

#### 10.4.2.2 状态空间模型

MPC通常采用离散状态空间模型描述系统动态：

$$
x(k+1) = Ax(k) + Bu(k)
$$

$$
y(k) = Cx(k) + Du(k)
$$

式中：$x$为状态向量；$u$为控制输入；$y$为输出；$A$、$B$、$C$、$D$为系统矩阵[5]。

对于输水系统，状态变量可选择各节点水位、压力、流量等；控制输入为泵站转速、阀门开度等。状态空间模型的优点是可以方便地处理多变量系统和状态约束。

#### 10.4.2.3 约束处理

MPC能够方便地处理各种约束条件，这是其相对于传统最优控制的重要优势[6]：

**状态约束：**

$$
x_{min} \leq x(k) \leq x_{max}
$$

**输入约束：**

$$
u_{min} \leq u(k) \leq u_{max}
$$

**输入变化率约束：**

$$
\Delta u_{min} \leq \Delta u(k) \leq \Delta u_{max}
$$

约束条件在优化问题中以不等式形式体现，通过二次规划（QP）求解器求解。常用的QP求解算法包括内点法、有效集法和快速梯度法。

### 10.4.3 输水系统MPC建模

#### 10.4.3.1 系统描述

以胶东调水工程宋庄泵站-宋庄水池-下游管段为研究对象，建立MPC控制模型。该子系统是胶东调水工程的核心控制单元，具有典型性和代表性[7]。

**系统变量定义：**

- 状态变量：水池水位$h(k)$、管道流量$Q(k)$
- 控制输入：泵站转速$n(k)$
- 扰动输入：下游用水流量$Q_d(k)$
- 输出变量：水池水位$h(k)$

#### 10.4.3.2 数学模型

**水池水位动态：**

水池水位变化遵循水量平衡方程：

$$
A_s\frac{dh}{dt} = Q_{in} - Q_{out}
$$

采用前向欧拉法离散化：

$$
h(k+1) = h(k) + \frac{T_s}{A_s}[Q_{in}(k) - Q_d(k)]
$$

式中：$T_s$为采样周期（s）；$A_s$为水池水面面积（m²）[8]。

**水泵流量-转速关系：**

根据水泵相似定律，流量与转速成正比：

$$
Q_{in}(k) = \alpha n(k)
$$

式中：$\alpha$为流量系数，与水泵特性有关。

**状态空间形式：**

定义状态向量$x(k) = [h(k), Q_{in}(k)]^T$，控制输入$u(k) = n(k)$，扰动$w(k) = Q_d(k)$，可得：

$$
x(k+1) = Ax(k) + Bu(k) + Ew(k)
$$

其中：

$$
A = \begin{bmatrix} 1 & \frac{T_s}{A_s} \\ 0 & 0 \end{bmatrix}, \quad B = \begin{bmatrix} 0 \\ \alpha \end{bmatrix}, \quad E = \begin{bmatrix} -\frac{T_s}{A_s} \\ 0 \end{bmatrix}
$$

#### 10.4.3.3 约束条件

**水位约束：**

$$
h_{min} \leq h(k) \leq h_{max}
$$

宋庄水池：$h_{min} = 38.0$ m，$h_{max} = 46.0$ m

**转速约束：**

$$
n_{min} \leq n(k) \leq n_{max}
$$

水泵额定转速：$n_{rated} = 375$ r/min，调速范围：$0.6n_{rated} \leq n \leq 1.0n_{rated}$

**转速变化率约束：**

$$
|\Delta n(k)| \leq \Delta n_{max}
$$

为保护水泵和管道，限制转速变化率：$\Delta n_{max} = 10$ r/min/采样周期[9]

### 10.4.4 MPC优化问题

#### 10.4.4.1 目标函数

泵站优化调度的目标是在满足供水需求的前提下，最小化运行能耗。目标函数包括：

**（1）水位跟踪项**

使水池水位维持在目标水位附近：

$$
J_1 = \sum_{i=1}^{N_p} q_i[h(k+i|k) - h_{ref}]^2
$$

**（2）能耗最小化项**

水泵功率与转速的三次方成正比：

$$
J_2 = \sum_{i=0}^{N_c-1} r_i n^3(k+i|k)
$$

**（3）控制平滑项**

避免控制量的剧烈变化：

$$
J_3 = \sum_{i=0}^{N_c-1} s_i[\Delta n(k+i|k)]^2
$$

综合目标函数：

$$
\min_{n} J = J_1 + J_2 + J_3
$$

式中：$q_i$、$r_i$、$s_i$为权重系数，反映各项的相对重要性[10]。

#### 10.4.4.2 优化问题求解

将MPC优化问题转化为标准二次规划形式：

$$
\min_{U} \frac{1}{2}U^T H U + f^T U
$$

$$
\text{s.t.} \quad GU \leq g
$$

式中：$U = [n(k), n(k+1), ..., n(k+N_c-1)]^T$为控制序列；$H$为Hessian矩阵；$f$为梯度向量；$G$、$g$为约束矩阵和向量[11]。

采用内点法或有效集法求解该QP问题，得到最优控制序列。对于实时性要求较高的场合，可采用快速MPC算法，如显式MPC或基于神经网络的近似MPC。

### 10.4.5 多泵站协调MPC

#### 10.4.5.1 系统扩展

对于多级泵站系统，需考虑泵站之间的协调控制。以两级泵站（宋庄泵站+即墨泵站）为例[12]：

**状态变量：**

$$
x = [h_1, h_2, Q_1, Q_2]^T
$$

式中：$h_1$、$h_2$分别为宋庄水池、即墨水池水位；$Q_1$、$Q_2$分别为两段管道流量。

**控制输入：**

$$
u = [n_1, n_2]^T
$$

式中：$n_1$、$n_2$分别为两级泵站转速。

#### 10.4.5.2 协调控制策略

**（1）分散MPC**

各泵站独立运行本地MPC控制器，通过水位设定值进行协调。优点是计算简单、通信负担小，缺点是难以实现全局最优。

**（2）集中MPC**

建立包含所有泵站的集中优化模型，统一求解。优点是可实现全局最优，缺点是计算复杂度高，对通信要求高，可靠性相对较低。

**（3）分布式MPC**

各泵站运行本地MPC，通过迭代协调实现全局优化。平衡了计算复杂度和优化效果，是当前研究的热点方向[13]。

### 10.4.6 考虑电价时段的优化

#### 10.4.6.1 分时电价模型

山东省工业用电实行分时电价政策：

**表10-4 分时电价标准**

| 时段 | 时间范围 | 电价(元/kWh) | 系数 |
|-----|---------|-------------|------|
| 峰时段 | 8:00-11:00, 18:00-23:00 | 1.0892 | 1.6 |
| 平时段 | 7:00-8:00, 11:00-18:00 | 0.6808 | 1.0 |
| 谷时段 | 23:00-次日7:00 | 0.2723 | 0.4 |

#### 10.4.6.2 电价优化策略

利用高位水池的调蓄能力，在谷时段多抽水、峰时段少抽水，降低电费支出[14]。

**目标函数修正：**

$$
J_{energy} = \sum_{i=0}^{N_c-1} c(k+i) \cdot P(k+i|k) \cdot T_s
$$

式中：$c(k)$为$k$时刻的电价（元/kWh）；$P(k)$为水泵功率（kW）。

**优化效果：**

通过仿真计算，考虑分时电价的MPC策略相比恒速运行，可节约电费约20-25%。优化策略的关键是充分利用水池的调蓄能力，将抽水负荷从峰时段转移到谷时段。

### 10.4.7 仿真验证

#### 10.4.7.1 仿真条件

- 采样周期：$T_s = 60$ s
- 预测时域：$N_p = 60$（1小时）
- 控制时域：$N_c = 10$（10分钟）
- 仿真时长：24小时
- 权重系数：$q = 10$，$r = 0.01$，$s = 0.1$

#### 10.4.7.2 典型工况仿真

**工况1：正常波动**

下游用水量在平均值的±20%范围内波动，MPC控制下水位保持在设定值±0.3m范围内，转速调节平滑，无超调现象。

**工况2：大流量冲击**

下游用水量突然增加50%，MPC控制器快速响应，增加泵站转速，水位波动控制在±0.5m以内，30分钟内恢复稳态。相比PID控制，响应时间缩短40%，超调减小60%。

**工况3：泵站故障**

一台水泵故障停机，MPC自动调整控制策略，利用水池调蓄能力维持供水，同时启动备用泵。系统保持稳定运行，未出现断流[15]。

#### 10.4.7.3 性能对比

**表10-5 MPC与传统控制性能对比**

| 性能指标 | 传统PID控制 | MPC控制 | 改善幅度 |
|---------|------------|---------|---------|
| 水位波动范围(m) | ±0.8 | ±0.3 | 62.5% |
| 转速调节次数(次/h) | 15 | 6 | 60% |
| 日耗电量(kWh) | 28500 | 22800 | 20% |
| 日电费(元) | 19410 | 14280 | 26.4% |
| 水位超调量(m) | 0.6 | 0.2 | 66.7% |
| 调节时间(min) | 45 | 25 | 44.4% |

### 10.4.8 工程实施要点

#### 10.4.8.1 系统集成

MPC控制器与现有SCADA系统的集成方式[16]：

**（1）独立部署**

MPC控制器作为独立系统运行，通过OPC接口与SCADA交换数据。优点是部署灵活，不影响现有系统，便于升级维护。

**（2）嵌入式部署**

将MPC算法嵌入SCADA控制站PLC中。优点是响应速度快，缺点是PLC计算能力有限，难以实现复杂优化算法。

推荐采用独立部署方式，MPC控制器作为SCADA系统的上层优化模块，通过标准接口进行数据交换。

#### 10.4.8.2 参数整定

MPC关键参数的整定方法：

**预测时域$N_p$：**

应覆盖系统的主要动态过程。对于输水系统，建议$N_p \geq 3600/T_s$（1小时）。

**控制时域$N_c$：**

通常为$N_p$的1/4到1/6。过大的$N_c$增加计算负担，过小的$N_c$降低控制灵活性。

**权重系数：**

通过试凑法或优化算法确定。水位跟踪权重应大于控制平滑权重。建议初始值：$q = 10$，$r = 0.01$，$s = 0.1$，再根据实际效果调整[17]。

#### 10.4.8.3 安全保护

MPC控制需设置完善的安全保护机制：

- 水位超限保护：触发声光报警，必要时强制停机
- 转速超限保护：限制转速在允许范围内
- 通信故障保护：通信中断时切换至本地控制模式
- 手动/自动切换：保留人工干预能力，操作员可随时接管控制

### 10.4.9 本章小结

本节研究了MPC技术在胶东调水工程泵站优化调度中的应用，主要结论如下：

（1）建立了输水系统的状态空间模型，考虑了水位动态、水泵特性、约束条件等因素，为MPC设计提供了数学基础。

（2）设计了MPC优化目标函数，综合考虑水位跟踪、能耗最小化和控制平滑性，实现了多目标优化。

（3）仿真结果表明，MPC控制相比传统PID控制，水位波动减小62.5%，日耗电量降低20%，电费节约26.4%，控制品质显著提升。

（4）提出了MPC系统与SCADA集成的实施方案和安全保护措施，为工程应用提供了技术支撑。

---

**参考文献**

[1] Qin S J, Badgwell T A. A survey of industrial model predictive control technology[J]. Control Engineering Practice, 2003, 11(7): 733-764.

[2] 雷晓辉, 等. 模型预测控制在供水系统优化调度中的应用[J]. 水利学报, 2021, 52(5): 542-551.

[3] Rawlings J B, Mayne D Q. Model Predictive Control: Theory and Design[M]. Madison: Nob Hill Publishing, 2009.

[4] Maciejowski J M. Predictive Control with Constraints[M]. Harlow: Prentice Hall, 2002.

[5] Camacho E F, Bordons C. Model Predictive Control[M]. 2nd ed. London: Springer, 2004.

[6] Boyd S, Vandenberghe L. Convex Optimization[M]. Cambridge: Cambridge University Press, 2004.

[7] 周建波, 等. 基于MPC的调水工程泵站优化控制研究[J]. 排灌机械工程学报, 2022, 40(4): 378-385.

[8] 陈乃祥. 供水系统动态模型与仿真[M]. 北京: 中国水利水电出版社, 2017.

[9] 关醒凡. 水泵运行调节与节能[M]. 北京: 中国宇航出版社, 2015.

[10] 雷晓辉, 等. 考虑分时电价的泵站优化调度模型[J]. 水利学报, 2020, 51(8): 923-932.

[11] Nocedal J, Wright S. Numerical Optimization[M]. 2nd ed. New York: Springer, 2006.

[12] 刘梅清, 等. 多级泵站输水系统协调控制策略研究[J]. 水利学报, 2021, 52(11): 1289-1298.

[13] Christofides P D, et al. Distributed model predictive control: A tutorial review and future research directions[J]. Computers & Chemical Engineering, 2013, 51: 21-41.

[14] 周建波, 等. 基于分时电价的调水工程节能调度研究[J]. 水利规划与设计, 2022, (3): 45-51.

[15] 杨开林. 输水系统事故工况水力响应分析与应急调度[J]. 水利学报, 2022, 53(9): 1023-1032.

[16] 西门子(中国)有限公司. SIMATIC PCS 7过程控制系统手册[Z]. 2021.

[17] 王飞跃, 等. 模型预测控制在水利自动化系统中的应用[J]. 自动化与仪器仪表, 2021, (6): 78-83.
</ama-doc>