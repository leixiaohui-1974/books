# 水系统运行科学与工程统一理论框架

**作者**：Manus AI（基于雷晓辉教授团队研究资料）

**日期**：2026年2月18日

---

## 摘要

水系统运行科学与工程涵盖渠道自动化控制、有压管网运行、水库调度优化、排水防洪系统控制、灌区配水管理、跨流域调水工程运行以及城市供水系统运行等多个子领域。长期以来，这些子领域各自发展出异质化的建模范式、控制策略和优化算法，缺乏一个能够从理论上统一不同子学科方法论的数学框架。本报告正是为了解决这一根本性问题而撰写。

本报告提出一个以**图上的端口-哈密顿系统（Port-Hamiltonian Systems on Graphs, PHS-G）**为核心数学语言的统一理论框架。该框架将任意复杂的水系统网络抽象为一个有向图，其中边代表输水通道（渠道、管道、河道），节点代表连接点或集中式组件（水库、泵站、阀门）。每个组件被建模为一个端口-哈密顿子系统，其动态行为由三个要素完全刻画：描述能量存储的**哈密顿量**（能量函数）、描述能量耗散的**阻性结构**（摩擦本构关系）、以及描述与外界能量交换的**端口变量**（水头与流量的功率共轭对）。不同水力组件的物理差异——从明渠的自由表面流到有压管道的满管流——被系统地归结为哈密顿量和阻性结构中**本构关系**的不同，而非方程形式的不同。

在此基础上，本框架通过**Stokes-Dirac结构**（由图的关联矩阵定义）实现组件的互联，确保互联过程严格保持功率守恒。通过**奇异摄动理论**和**结构保持模型降阶**方法，框架在不同时空尺度之间建立了严格的数学联系，为从实时控制到中长期规划的分层递阶决策提供了理论一致性。本报告给出了该框架的严格数学表述，论证了其在组合性、稳定性分析、结构保持仿真和多域耦合等方面的理论优势，并阐明了其相对于现有各子学科独立方法的根本性改进。

**关键词**：水系统运行科学；统一理论框架；端口-哈密顿系统；图论；Stokes-Dirac结构；多尺度建模；基于无源性的控制；组合性建模

---

## 目录

1. [引言：统一理论的必要性](#1-引言统一理论的必要性)
2. [现有子学科方法论的异质性分析](#2-现有子学科方法论的异质性分析)
3. [统一理论的数学基础：端口-哈密顿系统](#3-统一理论的数学基础端口-哈密顿系统)
4. [水系统的统一PHS建模框架](#4-水系统的统一phs建模框架)
5. [多尺度统一：从PDE到代数方程的一致性降阶](#5-多尺度统一从pde到代数方程的一致性降阶)
6. [统一控制理论：基于能量的分层递阶控制](#6-统一控制理论基于能量的分层递阶控制)
7. [理论优势与比较分析](#7-理论优势与比较分析)
8. [结论与展望](#8-结论与展望)

---

## 1. 引言：统一理论的必要性

### 1.1 问题的提出

水系统作为国家关键基础设施，其运行管理正经历从经验驱动向模型驱动、从被动响应向主动预测的深刻变革。雷晓辉教授团队在"水系统运行科学与工程"学科体系建设方案中提出了"自主运行水网"的宏大愿景 [1]，其核心是实现水系统从感知、认知到决策、执行的全链条智能化。然而，这一愿景的实现面临着一个根本性的理论障碍——**学科的内在分裂性**。

水系统运行涉及的子领域众多，包括但不限于渠道（明渠）自动化控制、管网（有压管道）控制、水库调度优化、排水/防洪系统控制、灌区配水管理、跨流域调水工程运行以及城市供水系统运行。尽管这些子领域所研究的物理过程都遵循流体力学的基本守恒定律（质量守恒、动量守恒、能量守恒），但在数十年的独立发展中，它们各自演化出了截然不同的建模方法、控制策略和优化算法 [1] [2]。这种"分而治之"的学科格局，在各子领域内部取得了显著成就，但也造成了严重的"理论碎片化"问题，使得水系统难以作为一个整体进行联合建模、优化与控制。

### 1.2 统一理论的核心诉求

在深入分析雷晓辉教授团队的全部研究资料后，我们识别出以下核心诉求：

第一，需要一种**统一的数学语言**，能够用同一套方程描述从明渠自由表面流到有压管道满管流、从分布参数的渠道动态到集总参数的水库水量平衡等不同类型的水力过程。第二，需要一种**统一的方法论**，能够在同一个理论框架内处理从毫秒级水锤瞬变到年际水资源规划等不同时空尺度的控制与决策问题。第三，需要一种**具有组合性的建模范式**，使得复杂水系统可以由标准化的子系统模块"即插即用"地组装而成，且整体系统的关键性质（如稳定性）可以从子系统的性质中推导得出。第四，需要**严格的数学表述**，而非仅仅是概念性的描述或定性的类比。

### 1.3 本报告的贡献

本报告的核心贡献在于，从物理第一性原理和现代几何力学出发，提出了一个满足上述全部诉求的统一理论框架。该框架以**图上的端口-哈密顿系统（PHS on Graphs）**为核心数学工具 [3] [4]，其关键创新点包括：

（1）**统一的能量语言**：以水力功率（水头 × 流量）为统一的功率共轭变量，以系统总能量（哈密顿量）为核心描述量，将所有水力组件纳入同一个能量框架。

（2）**本构关系差异化**：揭示了不同水力组件（明渠、管道、水库等）的物理差异本质上是其能量存储和耗散的**本构关系**不同，而非动力学方程形式不同。特别地，通过引入Preissmann窄缝法的思想 [5]，实现了明渠流与有压流在同一PDE框架下的统一。

（3）**严格的组合性**：通过Stokes-Dirac结构和图论，保证了子系统互联后整体系统仍为端口-哈密顿系统，从而实现了真正的模块化建模。

（4）**一致的多尺度体系**：通过结构保持离散化、POD-Galerkin降阶和奇异摄动分解，在不同时空尺度的模型之间建立了严格的数学联系。

## 2. 现有子学科方法论的异质性分析

为了清晰地阐明统一理论的必要性，本节系统梳理各子领域在建模、控制和优化方面的方法论差异。

### 2.1 建模范式的异质性

不同子领域所采用的数学模型在方程类型、空间维度和时间尺度上存在显著差异，如下表所示：

| 子领域 | 典型模型 | 方程类型 | 空间维度 | 特征时间尺度 | 关键状态变量 |
|:---|:---|:---|:---|:---|:---|
| 明渠控制 | 圣维南方程 | 双曲型PDE | 1D分布 | 分钟~小时 | 水深 $h(x,t)$, 流量 $Q(x,t)$ |
| 有压管网 | 水锤方程/稳态方程 | 双曲型PDE/代数方程 | 1D分布/集总 | 毫秒~秒（瞬态）/ 稳态 | 压力 $p(x,t)$, 流量 $Q(x,t)$ |
| 水库调度 | 水量平衡方程 | ODE/差分方程 | 集总（0D） | 日~月 | 库容 $V(t)$ 或水位 $Z(t)$ |
| 排水系统 | 圣维南方程+满管流 | 混合PDE | 1D分布 | 分钟~小时 | 水深/压力, 流量 |
| 灌区配水 | 简化水量平衡 | 代数方程/ODE | 集总/半分布 | 小时~日 | 各节点水量 |
| 跨流域调水 | 异构耦合模型 | 混合DAE | 混合 | 分钟~月 | 水位, 流量, 库容 |

这种异质性意味着，当需要对一个包含渠道、管道和水库的复合水系统进行联合建模时，工程师不得不面对不同类型方程的耦合问题，这不仅增加了建模的复杂性，也使得整体系统的理论分析（如稳定性证明）变得极为困难。

### 2.2 控制策略的差异性

在控制方法上，各子领域也形成了相对独立的技术体系。明渠控制领域以法国SIC/IRSTEA学派和美国ITRC学派为代表，发展了基于IDZ（积分-延迟-零点）传递函数模型的频域控制方法和基于圣维南方程线性化的MPC方法 [6] [7]。有压管网控制则更多依赖于稳态优化和泵组调度算法。水库调度领域则以动态规划（DP）、随机动态规划（SDP）及其各种改进算法为主流 [8]。这些方法各有其适用范围和理论基础，但缺乏一个能够将它们统一起来的上位理论。

### 2.3 共性的识别：能量视角

尽管存在上述差异，所有水系统子领域都共享一些深层的物理共性。从能量的角度看，所有水力过程都可以被理解为**水力能量（势能和动能）在网络中的传输、存储和耗散**。水头代表单位重量水体的能量，流量代表水体的传输速率，二者的乘积即为水力功率。摩擦损失代表能量的不可逆耗散，水库蓄水代表势能的存储，泵站运行代表外部能量的注入。这一共性为构建统一理论提供了物理基础。

## 3. 统一理论的数学基础：端口-哈密顿系统

### 3.1 有限维端口-哈密顿系统

端口-哈密顿系统（Port-Hamiltonian System, PHS）理论是现代几何力学与控制理论的重要分支，由van der Schaft和Maschke等人系统发展 [3] [9] [10]。一个有限维的PHS定义如下：

> **定义 3.1（有限维端口-哈密顿系统）**：一个状态空间为 $\mathcal{X} \subseteq \mathbb{R}^n$、输入空间为 $\mathbb{R}^m$ 的端口-哈密顿系统由以下方程描述：
>
> $$\dot{x} = [J(x) - R(x)] \frac{\partial H}{\partial x}(x) + g(x) u$$
>
> $$y = g(x)^\top \frac{\partial H}{\partial x}(x)$$
>
> 其中：
> - $x \in \mathcal{X}$ 为状态向量；
> - $H: \mathcal{X} \to \mathbb{R}$ 为**哈密顿量**（系统总能量），$H(x) \geq 0$；
> - $J(x) = -J(x)^\top \in \mathbb{R}^{n \times n}$ 为**互联结构矩阵**（反对称），描述系统内部的保守能量交换；
> - $R(x) = R(x)^\top \geq 0 \in \mathbb{R}^{n \times n}$ 为**耗散结构矩阵**（半正定对称），描述系统的能量耗散；
> - $g(x) \in \mathbb{R}^{n \times m}$ 为输入矩阵；
> - $(u, y) \in \mathbb{R}^m \times \mathbb{R}^m$ 为**端口变量**（功率共轭对），满足 $u^\top y$ 为系统与外界交换的功率。

这个定义的物理含义极为清晰：系统状态的变化率 $\dot{x}$ 由三部分驱动——内部保守能量交换 $J \nabla H$、能量耗散 $-R \nabla H$ 和外部能量注入 $g u$。

### 3.2 核心性质：无源性与能量平衡

PHS最重要的性质是其**无源性（Passivity）**，这直接来源于能量守恒/耗散定律。

> **定理 3.1（PHS的能量平衡）**：对于上述PHS，沿系统轨迹有：
>
> $$\frac{dH}{dt} = \left(\frac{\partial H}{\partial x}\right)^\top \dot{x} = -\left(\frac{\partial H}{\partial x}\right)^\top R(x) \frac{\partial H}{\partial x} + u^\top y \leq u^\top y$$
>
> 即系统能量的变化率等于外部供给功率减去内部耗散功率。由于 $R \geq 0$，耗散项非负，因此系统能量的增长不会超过外部供给的功率。这正是**无源性**的定义。

**证明**：将状态方程代入 $dH/dt$ 的表达式：

$$\frac{dH}{dt} = \nabla H^\top [J - R] \nabla H + \nabla H^\top g u = \underbrace{\nabla H^\top J \nabla H}_{=0 \text{ (反对称)}} - \underbrace{\nabla H^\top R \nabla H}_{\geq 0 \text{ (半正定)}} + u^\top y$$

由于 $J$ 反对称，$\nabla H^\top J \nabla H = 0$；由于 $R$ 半正定，$\nabla H^\top R \nabla H \geq 0$。因此 $dH/dt \leq u^\top y$。$\square$

这一性质的深刻意义在于：它为系统的稳定性分析提供了一个天然的**李雅普诺夫函数候选**——哈密顿量 $H$ 本身。

### 3.3 组合封闭性：Dirac结构与互联

PHS理论最强大的特性之一是其**组合封闭性**：两个（或多个）PHS通过功率守恒的互联（Dirac结构）连接后，所得到的复合系统仍然是一个PHS [3] [11]。

> **定理 3.2（PHS的组合封闭性）**：设 $\Sigma_1$ 和 $\Sigma_2$ 为两个PHS，分别具有哈密顿量 $H_1, H_2$、互联矩阵 $J_1, J_2$、耗散矩阵 $R_1, R_2$。若它们通过功率守恒的互联 $u_1 = -y_2, u_2 = y_1$（即标准反馈互联）连接，则复合系统是一个PHS，其哈密顿量为 $H = H_1 + H_2$。

这意味着，无论水系统网络多么复杂，只要每个组件都被建模为PHS，且互联是功率守恒的，那么整个网络就自动成为一个PHS，其总能量就是所有组件能量之和，其稳定性可以通过分析总能量的变化来判断。

### 3.4 分布参数端口-哈密顿系统

对于渠道和管道等分布参数系统，PHS理论已被推广到无穷维的情况 [12] [13]。一个1D的分布参数PHS可以写为：

> **定义 3.2（1D分布参数PHS）**：在空间域 $[a, b]$ 上，系统动态由以下PDE描述：
>
> $$\frac{\partial x}{\partial t}(z, t) = [\mathcal{J} - \mathcal{R}] \frac{\delta H}{\delta x}(z, t)$$
>
> 其中 $\mathcal{J}$ 为反对称微分算子，$\mathcal{R}$ 为半正定对称算子，$\delta H / \delta x$ 为哈密顿量泛函的变分导数。系统通过边界端口 $(u_\partial, y_\partial)$ 与外界交换能量，满足：
>
> $$\frac{dH}{dt} = -\int_a^b \left(\frac{\delta H}{\delta x}\right)^\top \mathcal{R} \frac{\delta H}{\delta x} dz + [u_\partial^\top y_\partial]_a^b$$

边界端口变量 $(u_\partial, y_\partial)$ 正是分布参数系统与其他系统互联的接口，这为渠道段之间、渠道与水库之间的互联提供了严格的数学基础。

## 4. 水系统的统一PHS建模框架

### 4.1 水网络的图抽象

我们将一个物理水系统网络抽象为一个有向图 $\mathcal{G} = (\mathcal{V}, \mathcal{E})$，其中 $\mathcal{V} = \{v_1, \ldots, v_N\}$ 为节点集，$\mathcal{E} = \{e_1, \ldots, e_M\}$ 为边集。图的拓扑由**关联矩阵** $B \in \mathbb{R}^{N \times M}$ 描述，其中：

$$B_{ij} = \begin{cases} +1 & \text{若边 } e_j \text{ 从节点 } v_i \text{ 出发} \\ -1 & \text{若边 } e_j \text{ 到达节点 } v_i \\ 0 & \text{其他} \end{cases}$$

在水系统中：

- **边 $e \in \mathcal{E}$** 代表输水通道（渠道段、管道段、河道段等），是分布参数子系统。
- **节点 $v \in \mathcal{V}$** 代表连接点或集中式组件（交汇点、水库、泵站、阀门等），是集总参数子系统或代数约束。

### 4.2 统一的功率变量

我们定义统一的**功率共轭变量对**（Effort-Flow pair），其乘积为水力功率：

| 变量类型 | 符号 | 物理含义 | 单位 |
|:---|:---|:---|:---|
| **势变量（Effort）** | $e = h$ | 总水头 $h = z + p/(\rho g) + v^2/(2g)$ | m |
| **流变量（Flow）** | $f = Q$ | 体积流量 | m³/s |
| **功率** | $P = e \cdot f = \rho g h Q$ | 水力功率 | W |

这一定义在所有水力子领域中都是适用的：在明渠中，$h$ 包含高程和水深；在有压管道中，$h$ 还包含压力水头；在水库中，$h$ 就是水位。

### 4.3 边模型：输水通道的统一PHS-PDE

#### 4.3.1 圣维南方程的端口-哈密顿形式

对于一段长度为 $L$ 的输水通道（边 $e$），其动态由一维圣维南方程描述。我们选择**过水断面面积 $A(z,t)$** 和**单位长度动量 $p(z,t) = \rho A v$**（或等价地，流量 $Q = Av$）作为状态变量。

通道中存储的总能量（哈密顿量泛函）为：

$$H_e[A, Q] = \int_0^L \left[ \underbrace{\frac{Q^2}{2\rho A}}_{\text{动能密度}} + \underbrace{\rho g \int_0^{h(A)} (h(A) - \eta) T(\eta) \, d\eta}_{\text{势能密度}} \right] dz$$

其中 $h(A)$ 是由断面几何关系确定的水深-面积本构关系，$T(\eta)$ 是水深 $\eta$ 处的水面宽度。

哈密顿量的变分导数（共能量变量）为：

$$\frac{\delta H}{\delta A} = -\frac{Q^2}{2\rho A^2} + \rho g h(A) = \rho g h - \frac{v^2}{2} \quad \text{（与水头相关）}$$

$$\frac{\delta H}{\delta Q} = \frac{Q}{\rho A} = v \quad \text{（流速）}$$

圣维南方程可以写成如下的PHS-PDE形式 [13] [14]：

$$\frac{\partial}{\partial t} \begin{pmatrix} A \\ Q \end{pmatrix} = \underbrace{\begin{pmatrix} 0 & -\partial_z \\ -\partial_z & 0 \end{pmatrix}}_{\mathcal{J} \text{ (反对称)}} \begin{pmatrix} \delta H / \delta A \\ \delta H / \delta Q \end{pmatrix} - \underbrace{\begin{pmatrix} 0 & 0 \\ 0 & r(A,Q) \end{pmatrix}}_{\mathcal{R} \text{ (耗散)}} \begin{pmatrix} \delta H / \delta A \\ \delta H / \delta Q \end{pmatrix}$$

其中 $r(A,Q) = \rho g A S_f / Q$ 是由摩擦坡度 $S_f$（Manning公式或Darcy-Weisbach公式）确定的耗散系数。

这个公式的物理意义极为清晰：$\mathcal{J}$ 中的 $-\partial_z$ 算子代表沿空间方向的能量传输（波动传播），$\mathcal{R}$ 代表摩擦引起的能量耗散。

#### 4.3.2 明渠流与有压流的统一：本构关系的差异化

**这是本框架最关键的统一洞察之一**。明渠流和有压流的区别，在PHS框架中，完全被归结为**本构关系 $h(A)$** 的不同，而非动力学方程形式的不同。

对于**明渠**（如梯形渠道），本构关系 $h(A)$ 由渠道的几何断面形状决定。例如，对于底宽为 $b$、边坡系数为 $m$ 的梯形渠道：

$$A = (b + mh)h, \quad T = b + 2mh$$

对于**有压管道**，我们借鉴**Preissmann窄缝法** [5] 的思想。将管道视为一个在顶部具有极窄虚拟窄缝（宽度 $T_s$）的封闭断面。当水面低于管顶时，$h(A)$ 由管道的实际几何形状（如圆形）决定；当水面超过管顶进入窄缝时：

$$A = A_{\text{full}} + T_s (h - h_{\text{crown}}), \quad T = T_s$$

此时，由于 $T_s$ 极小，微小的面积变化 $\Delta A$ 会导致巨大的水头变化 $\Delta h = \Delta A / T_s$，从而产生极高的波速 $c = \sqrt{gA/T_s}$，这正好模拟了有压管道中的水锤波速。通过适当选择 $T_s$，可以使模型波速与实际水锤波速精确匹配。

这意味着，**上述PHS-PDE方程（4.3.1节）无需做任何修改，即可同时描述明渠流和有压流**。两种流态的切换，仅仅是本构关系 $h(A)$ 在管顶处的一个连续但急剧变化。

下表总结了不同通道类型的本构关系：

| 通道类型 | 断面形状 | 本构关系 $A(h)$ | 水面宽度 $T(h)$ | 波速 $c = \sqrt{gA/T}$ |
|:---|:---|:---|:---|:---|
| 矩形明渠 | 矩形 | $A = bh$ | $T = b$ | $c = \sqrt{gh}$ |
| 梯形明渠 | 梯形 | $A = (b+mh)h$ | $T = b+2mh$ | $c = \sqrt{gA/T}$ |
| 圆形管道（非满流） | 圆形 | $A(\theta)$ | $T = D\sin\theta$ | $c = \sqrt{gA/T}$ |
| 圆形管道（满流+窄缝） | 圆形+窄缝 | $A = A_f + T_s(h-h_c)$ | $T = T_s \ll 1$ | $c \approx \sqrt{gA_f/T_s}$ |

### 4.4 节点模型：集中式组件的统一PHS

#### 4.4.1 水库/水池

水库是一个集总参数的储能元件，其状态变量为蓄水体积 $V$，哈密顿量为势能：

$$H_v(V) = \rho g \int_0^V h(\tilde{V}) \, d\tilde{V}$$

其中 $h(V)$ 是水库的**库容曲线**（水位-库容关系），这是水库的本构关系。水库的动态方程为：

$$\dot{V} = \sum_{i \in \text{in}} Q_i - \sum_{j \in \text{out}} Q_j$$

共能量变量（输出）为 $\partial H_v / \partial V = \rho g h(V)$，即水库水位对应的势能。

#### 4.4.2 闸门/阀门

闸门和阀门是**耗散性元件**，它们不存储能量，但通过局部水头损失耗散能量。其本构关系为流量-水头差的代数关系：

$$Q = C_d A_g \sqrt{2g \Delta h}$$

其中 $C_d$ 为流量系数，$A_g$ 为闸门开度对应的过水面积，$\Delta h = h_{\text{up}} - h_{\text{down}}$ 为上下游水头差。在PHS框架中，闸门被建模为一个**阻性端口**，其耗散功率为 $P_d = \rho g Q \Delta h \geq 0$。

#### 4.4.3 泵站

泵站是**能量源**，它向水系统注入外部能量。其本构关系为泵的特性曲线 $\Delta h = f(Q, \omega)$，其中 $\omega$ 为转速。在PHS框架中，泵被建模为一个**外部端口**，其注入功率为 $P_{\text{pump}} = \rho g Q \Delta h$。

### 4.5 网络组装：Stokes-Dirac结构

所有组件通过图的拓扑结构进行互联。根据van der Schaft和Maschke的理论 [3]，图 $\mathcal{G}$ 的关联矩阵 $B$ 定义了一个**Dirac结构**，它施加了以下守恒律：

**节点处的质量守恒（广义KCL）**：对于每个节点 $v_i$，所有连接边的流量满足：

$$\sum_{j=1}^{M} B_{ij} Q_j = Q_{\text{ext},i}$$

其中 $Q_{\text{ext},i}$ 是节点 $v_i$ 的外部流入/流出（如取水、排水）。

**边上的水头关系（广义KVL）**：每条边两端的水头由其连接的节点水头确定：

$$h_{e_j,\text{in}} = h_{v_{\text{start}(j)}}, \quad h_{e_j,\text{out}} = h_{v_{\text{end}(j)}}$$

这些关系确保了互联过程的**功率守恒**：

$$\sum_{\text{所有端口}} h \cdot Q = 0 \quad \text{（互联结构不产生或消耗能量）}$$

> **定理 4.1（水网络的PHS结构）**：将所有边和节点的PHS模型通过上述Dirac结构互联后，所得到的复合系统是一个端口-哈密顿系统，其总哈密顿量为：
>
> $$H_{\text{total}} = \sum_{e \in \mathcal{E}} H_e + \sum_{v \in \mathcal{V}} H_v$$
>
> 且满足能量平衡：
>
> $$\frac{dH_{\text{total}}}{dt} = -\underbrace{\sum_{e \in \mathcal{E}} \int_0^{L_e} \left(\frac{\delta H_e}{\delta x_e}\right)^\top \mathcal{R}_e \frac{\delta H_e}{\delta x_e} dz}_{\text{总摩擦耗散} \geq 0} - \underbrace{\sum_{v \in \mathcal{V}_{\text{gate}}} \rho g Q_v \Delta h_v}_{\text{闸门局部损失} \geq 0} + \underbrace{\sum_{v \in \mathcal{V}_{\text{pump}}} P_{\text{pump},v}}_{\text{泵站能量注入}} + \underbrace{\sum_{v \in \mathcal{V}_{\text{ext}}} \rho g h_v Q_{\text{ext},v}}_{\text{外部交换功率}}$$

这个定理的意义在于：无论水系统网络多么复杂，其总能量的变化都可以被精确地追踪和分析。

## 5. 多尺度统一：从PDE到代数方程的一致性降阶

### 5.1 尺度分离的物理基础

水系统运行涉及的时间尺度跨越多个数量级：

| 物理过程 | 特征时间尺度 | 对应决策层 |
|:---|:---|:---|
| 水锤/压力波传播 | 毫秒~秒 | 安全保护 |
| 闸门/泵站调节响应 | 秒~分钟 | 实时控制 |
| 渠道水位波动 | 分钟~小时 | 短期调度 |
| 水库蓄放水 | 小时~日 | 日调度 |
| 季节性水量分配 | 日~月 | 中期调度 |
| 水资源规划 | 月~年 | 长期规划 |

本框架通过三种结构保持的降阶方法，在这些尺度之间建立严格的数学联系。

### 5.2 空间离散化：从PDE到有限维PHS

对于边模型的PHS-PDE，通过**结构保持的空间离散化**方法 [14] [15]，可以得到有限维的PHS-ODE。具体而言，将空间域 $[0, L]$ 划分为 $N_e$ 个单元，在每个单元上对流变量和势变量分别采用不同的近似空间（如交错网格或混合有限元），使得离散化后的系统仍然满足PHS结构：

$$\dot{x}_d = [J_d - R_d] \nabla H_d(x_d) + g_d u_d$$

$$y_d = g_d^\top \nabla H_d(x_d)$$

其中 $x_d \in \mathbb{R}^{2N_e}$ 是离散状态向量，$H_d$ 是离散哈密顿量。关键性质是：

（1）$J_d = -J_d^\top$（反对称性保持）；
（2）$R_d = R_d^\top \geq 0$（耗散性保持）；
（3）$dH_d/dt \leq u_d^\top y_d$（无源性保持）。

这意味着离散模型在数值层面严格遵守能量守恒/耗散定律，避免了传统数值方法可能引入的虚假能量源或耗散。

### 5.3 模型阶次约减：从高阶ODE到低阶ODE

对于控制器设计，离散化后的高阶ODE模型可能仍然过于复杂。通过**POD-Galerkin投影** [16]，可以进一步降阶：

1. 从高保真仿真中提取状态快照矩阵 $X = [x(t_1), \ldots, x(t_K)]$。
2. 对 $X$ 进行奇异值分解（SVD），提取前 $r \ll 2N_e$ 个主要模态 $\Phi_r$。
3. 将状态近似为 $x_d \approx \Phi_r \xi$，其中 $\xi \in \mathbb{R}^r$ 为降阶状态。
4. 通过Galerkin投影得到降阶模型：$\dot{\xi} = [\tilde{J} - \tilde{R}] \nabla \tilde{H}(\xi) + \tilde{g} u$。

若投影基 $\Phi_r$ 满足特定的辛条件，降阶模型仍保持PHS结构 [17]。

文献中广泛使用的**IDZ（积分-延迟-零点）模型** [6] 可以被理解为对线性化圣维南方程在频域中进行的一种特殊降阶近似，它保留了系统的主要输入-输出特性（积分行为、传输延迟和高频零点）。

### 5.4 时间尺度分离：奇异摄动分解

当系统包含快慢两种动态时（如水锤波传播 vs. 水库蓄水），可以通过**奇异摄动理论** [18] 进行形式化的时间尺度分离。将系统写为：

$$\dot{x}_s = f_s(x_s, x_f, u)$$

$$\varepsilon \dot{x}_f = f_f(x_s, x_f, u)$$

其中 $x_s$ 为慢变量（如水库水位），$x_f$ 为快变量（如管道中的压力波），$\varepsilon \ll 1$ 为小参数（快慢时间尺度之比）。

当 $\varepsilon \to 0$ 时，快子系统的微分方程退化为代数方程 $0 = f_f(x_s, x_f, u)$，即快变量瞬间达到准稳态。这为在慢时间尺度（如日调度）上使用简化的稳态水力模型提供了严格的数学依据。

> **命题 5.1（多尺度模型的一致性）**：在本框架中，不同时间尺度上使用的模型——从高保真PDE到降阶ODE再到稳态代数方程——不是独立构建的，而是通过结构保持的数学变换（离散化、投影、奇异摄动极限）从同一个PHS-PDE出发逐步导出的。因此，它们共享相同的物理变量定义、能量函数形式和端口接口，保证了跨尺度决策的理论一致性。

## 6. 统一控制理论：基于能量的分层递阶控制

### 6.1 基于无源性的控制（Passivity-Based Control, PBC）

PHS框架为控制器设计提供了一种自然而强大的方法论——**基于无源性的控制** [9] [19]。其核心思想是：将控制器本身也设计为一个PHS，然后通过功率守恒的互联将其与被控对象（水系统）连接。由于PHS的组合封闭性（定理3.2），闭环系统仍为PHS，其稳定性可以通过分析闭环哈密顿量来保证。

具体而言，**互联与阻尼注入-无源性控制（IDA-PBC）**方法的目标是通过控制输入 $u$ 将闭环系统整形为一个具有期望哈密顿量 $H_d(x)$ 和期望耗散 $R_d(x)$ 的PHS：

$$\dot{x} = [J_d(x) - R_d(x)] \nabla H_d(x)$$

其中 $H_d(x)$ 在期望的运行点 $x^*$ 处取得最小值。这样，$H_d(x)$ 就是闭环系统的李雅普诺夫函数，保证了 $x^*$ 的渐近稳定性。

### 6.2 分层递阶控制架构

基于多尺度模型体系（第5节），可以构建一个理论一致的分层递阶控制架构：

| 控制层 | 时间尺度 | 使用模型 | 控制方法 | 决策内容 |
|:---|:---|:---|:---|:---|
| **规划层** | 月~年 | 稳态代数PHS | 多目标优化 | 水资源配置方案 |
| **调度层** | 小时~日 | 降阶ODE-PHS | MPC/动态规划 | 流量/水位目标轨迹 |
| **控制层** | 秒~分钟 | 离散化PDE-PHS | IDA-PBC/分散控制 | 闸门/泵站实时指令 |
| **保护层** | 毫秒~秒 | 高保真PDE-PHS | 约束管理/安全锁定 | 紧急保护动作 |

在这个架构中，上层的决策（如调度层输出的目标轨迹）作为下层控制器的参考输入。由于所有层使用的模型都共享相同的物理变量和能量框架，层间信息传递是自然而一致的。

### 6.3 分布式控制与网络化

对于大规模水系统网络，集中式控制往往不可行。PHS框架天然支持**分布式控制**设计。由于整体系统的无源性可以从各子系统的无源性推导得出（定理3.2），因此可以为每个子系统（如每个渠道段或每个水库）独立设计一个局部PBC控制器，只要每个局部控制器保证其子系统的无源性，整体系统的稳定性就可以得到保证 [20]。这种"分散保证全局"的特性，是PHS框架在大规模网络化控制中的核心优势。

## 7. 理论优势与比较分析

### 7.1 与现有方法的比较

下表将本统一框架与现有各子学科的主流方法进行了系统比较：

| 比较维度 | 现有方法（各子学科独立） | 本统一PHS框架 |
|:---|:---|:---|
| **建模语言** | 异质（PDE/ODE/代数，各有不同形式） | 统一（PHS-PDE/ODE/代数，同一形式） |
| **组件互联** | 临时性耦合，缺乏形式化保证 | Stokes-Dirac结构，功率守恒，组合封闭 |
| **稳定性分析** | 各子系统独立分析，整体稳定性难以保证 | 基于总哈密顿量的李雅普诺夫分析，组合性保证 |
| **多尺度一致性** | 不同尺度模型独立构建，缺乏数学联系 | 通过结构保持降阶逐步导出，严格一致 |
| **控制器设计** | 各子领域独立方法（PID/MPC/DP等） | 统一的PBC/IDA-PBC方法论 |
| **数值仿真** | 可能引入虚假能量源/耗散 | 结构保持离散化，长期稳定 |
| **可扩展性** | 新组件需要重新推导耦合关系 | 即插即用，只需定义本构关系 |
| **多域耦合** | 需要额外的接口设计 | 天然支持（水-电-热统一能量语言） |

### 7.2 核心理论优势

**优势一：严格的组合性（Compositionality）**。这是本框架最根本的优势。在传统方法中，将一个渠道模型与一个水库模型耦合，需要手动处理边界条件的匹配，且耦合后系统的稳定性需要重新分析。在PHS框架中，只要每个组件都被正确地建模为PHS（定义好其哈密顿量、耗散和端口），互联就自动通过Dirac结构完成，且整体系统的PHS结构和无源性自动保持。这使得大型复杂水系统的建模从"手工艺"变为"工业化"。

**优势二：内禀的稳定性保证**。PHS的哈密顿量天然是李雅普诺夫函数候选。这意味着稳定性分析不再需要"猜测"李雅普诺夫函数——这在传统非线性控制中往往是最困难的步骤。对于水系统而言，系统的总水力能量就是一个天然的李雅普诺夫函数，其物理意义清晰，且可以被直接用于控制器设计。

**优势三：物理可解释性**。基于PHS的控制器设计（如IDA-PBC）具有清晰的物理解释：控制器的作用是"整形"系统的能量函数，使其在期望运行点处取得最小值，并注入额外的"虚拟阻尼"以加速收敛。这与传统的纯数学优化方法（如MPC中的二次规划）相比，更容易被水利工程师理解和信任。

**优势四：结构保持的数值方法**。在将PHS模型离散化用于计算机仿真时，可以采用特殊的数值格式（如交错网格有限差分、混合有限元）来保持离散模型的PHS结构。这意味着仿真结果在离散层面严格遵守能量守恒/耗散定律，避免了长期仿真中常见的数值漂移问题，这对于数字孪生和在线优化至关重要。

## 8. 结论与展望

### 8.1 结论

本报告提出了一个基于"图上的端口-哈密顿系统"的统一理论框架，旨在从根本上解决水系统运行科学内部长期存在的学科分裂问题。该框架的核心贡献可以概括为以下四点：

第一，**统一了建模语言**。通过以水力功率（水头 × 流量）为统一的功率共轭变量，以系统总能量为核心描述量，所有水力组件——从分布参数的明渠和管道，到集总参数的水库和闸门——都可以在同一个PHS数学结构中被描述。不同组件的物理差异被系统地归结为本构关系的不同。

第二，**统一了组件互联**。通过Stokes-Dirac结构和图论，子系统的互联被形式化为一个功率守恒的数学操作，且互联后的复合系统自动保持PHS结构。这实现了真正的模块化、可组合建模。

第三，**统一了多尺度模型**。通过结构保持的空间离散化、POD-Galerkin降阶和奇异摄动分解，不同时空尺度上使用的模型被证明是从同一个PHS-PDE出发逐步导出的，共享相同的物理基础和能量框架。

第四，**统一了控制方法论**。基于无源性的控制（PBC/IDA-PBC）为不同子领域的控制器设计提供了一个统一的理论工具，且天然支持分布式实现和组合性稳定性分析。

### 8.2 展望

基于本统一框架，未来的研究可以在以下方向深入展开：

第一，**统一的可控性与可观性理论**。在PHS框架下，系统地研究水系统网络的结构可控性和可观性，为传感器和执行器的优化布置提供理论指导。

第二，**统一的状态估计与数据同化**。利用PHS结构设计结构保持的观测器和滤波器，实现对水系统状态的实时估计。

第三，**统一的故障诊断与韧性评估**。利用能量平衡关系，通过监测能量残差来检测和定位系统故障。

第四，**数据驱动的PHS辨识**。利用机器学习方法，从运行数据中直接辨识水系统组件的PHS模型（特别是本构关系），实现"数据-物理"融合建模。

第五，**与HydroOS等平台的集成**。将本理论框架作为下一代水系统操作系统（如HydroOS）的理论内核，指导其架构设计和算法开发。

我们相信，这一统一理论框架的建立和完善，将有力地推动"水系统运行科学与工程"从一个由经验和工具驱动的工程实践领域，发展成为一门具有坚实理论基础的现代工程科学。

---

## 参考文献

[1]: 雷晓辉等. 水系统运行科学与工程学科体系建设方案 (CHS_report_draft.md). 2025.

[2]: Chaudhry, M. H. *Open-channel flow*. Springer, 2008. https://link.springer.com/book/10.1007/978-0-387-68648-6

[3]: van der Schaft, A. J., & Maschke, B. M. Port-Hamiltonian systems on graphs. *SIAM Journal on Control and Optimization*, 51(2), 906-937, 2013. https://epubs.siam.org/doi/10.1137/110840091

[4]: Duindam, V., Macchelli, A., Stramigioli, S., & Bruyninckx, H. (Eds.). *Modeling and control of complex physical systems: the port-Hamiltonian approach*. Springer, 2009. https://link.springer.com/book/10.1007/978-3-642-03196-0

[5]: Cunge, J. A., Holly, F. M., & Verwey, A. *Practical aspects of computational river hydraulics*. Pitman, 1980.

[6]: Litrico, X., & Fromion, V. Analytical approximation of open-channel flow for controller design. *Applied Mathematical Modelling*, 28(7), 677-695, 2004. https://www.sciencedirect.com/science/article/pii/S0307904X0300221X

[7]: Malaterre, P. O., Rogers, D. C., & Schuurmans, J. Classification of canal control algorithms. *Journal of Irrigation and Drainage Engineering*, 124(1), 3-10, 1998.

[8]: Labadie, J. W. Optimal operation of multireservoir systems: State-of-the-art review. *Journal of Water Resources Planning and Management*, 130(2), 93-111, 2004.

[9]: van der Schaft, A. J. *L2-gain and passivity techniques in nonlinear control* (3rd ed.). Springer, 2017. https://link.springer.com/book/10.1007/978-3-319-49992-5

[10]: van der Schaft, A. J., & Jeltsema, D. Port-Hamiltonian systems theory: An introductory overview. *Foundations and Trends in Systems and Control*, 1(2-3), 173-378, 2014. https://people.math.ethz.ch/~hiptmair/Seminars/PHS_24/VSJ14.pdf

[11]: Cervera, J., van der Schaft, A. J., & Baños, A. Interconnection of port-Hamiltonian systems and composition of Dirac structures. *Automatica*, 43(2), 212-225, 2007. https://www.sciencedirect.com/science/article/pii/S0005109806003682

[12]: van der Schaft, A. J., & Maschke, B. M. Hamiltonian formulation of distributed-parameter systems with boundary energy flow. *Journal of Geometry and Physics*, 42(1-2), 166-194, 2002. https://people.math.ethz.ch/~hiptmair/Seminars/PHS_24/SMA02.pdf

[13]: Hamroun, B., Dimofte, A., Lefèvre, L., & Mendes, E. Control by interconnection and energy-shaping methods of port Hamiltonian models. Application to the shallow water equations. *European Journal of Control*, 16(5), 545-563, 2010. https://hal.science/hal-01625065v1/document

[14]: Pasumarthy, R., Ambati, V. R., & van der Schaft, A. J. Port-Hamiltonian discretization for open channel flows. *Systems & Control Letters*, 61(9), 914-922, 2012. https://www.sciencedirect.com/science/article/pii/S0167691112001004

[15]: Brugnoli, A., & Ranocha, H. Dual-field structure-preserving discretization of port-Hamiltonian systems. *Journal of Computational Physics*, 467, 111447, 2022. https://www.sciencedirect.com/science/article/pii/S0021999122006635

[16]: Strazzullo, M., Ballarin, F., & Rozza, G. POD-Galerkin model order reduction for parametrized nonlinear time-dependent optimal flow control: an application to shallow water equations. *Journal of Numerical Mathematics*, 30(2), 135-155, 2022. https://arxiv.org/abs/2003.09695

[17]: Karasözen, B., Yıldız, S., & Uzunca, M. Structure preserving model order reduction of shallow water equations. *Mathematical Methods in the Applied Sciences*, 44(1), 476-492, 2021.

[18]: Kokotović, P. V., Khalil, H. K., & O'Reilly, J. *Singular perturbation methods in control: analysis and design*. SIAM, 1999.

[19]: Ortega, R., van der Schaft, A. J., Maschke, B. M., & Escobar, G. Interconnection and damping assignment passivity-based control of port-controlled Hamiltonian systems. *Automatica*, 38(4), 585-596, 2002.

[20]: Perryman, R., et al. Port-Hamiltonian based control of water distribution networks. *Systems & Control Letters*, 170, 105402, 2022. https://www.sciencedirect.com/science/article/abs/pii/S0167691122001797
