<!-- 变更日志
v1 2026-02-16: 初稿
-->

# ch12 沙坪梯级MPC实践

## 学习目标

完成本章后，读者应能够：

1. 明确沙坪梯级“发电—泄洪—生态”多目标耦合下的MPC控制问题定义；
2. 构建“梯级协同模型+运行设计域（Operational Design Domain, ODD）+安全包络（Safety Envelope）”一体化约束体系；
3. 设计蒲布—深溪沟—镇头—沙坪梯级联合调度中的分层分布式控制（Hierarchical Distributed Control, HDC）门禁机制；
4. 给出极端来水、负荷波动与设备检修并发场景下的降级与接管策略；
5. 形成可复用的上线验收、课程实验评分rubric与复盘模板。

> 本章承接 ch11：从“长距离明渠调水”转向“梯级水电枢纽联合调度”，强调多站耦合、快速扰动与安全联锁并存的工程复杂性。

> **前章回顾**：上一章介绍了本领域的核心概念与方法。本章在此基础上进一步展开。


## 场景边界与建模对象

沙坪场景的关键差异在于：调度目标不止供水，还包括发电收益、泄洪安全与生态下泄约束，且多站间强耦合。

[物理直觉] 梯级系统像串联水库链条，上游出力与泄量变化会沿河道传递并放大下游调度压力。

定义梯级状态向量：

$$
\mathbf{x}_k=[h_{pb,k},h_{sxg,k},h_{zt,k},h_{sp,k}]^\top
$$

定义控制向量：

$$
\mathbf{u}_k=[Q_{tur,k},Q_{spill,k},Q_{gate,k}]^\top
$$

其中 $h$ 为关键库站水位，$Q_{tur}$ 为机组过流，$Q_{spill}$ 为泄洪流量，$Q_{gate}$ 为闸门调节流量。

[工程解释] 建模应优先保证“可观测+可执行+可验收”，避免一次性引入过多难以现场标定的隐变量。

## 多目标优化与优先级治理

沙坪梯级推荐采用“安全优先、生态刚性、发电优化”三级治理：

1. **一级目标**：防洪与结构安全约束不可突破；
2. **二级目标**：生态下泄与下游通航需求满足率；
3. **三级目标**：发电收益与机组效率优化。

目标函数可写为：

$$
J=\sum_{i=1}^{N_p}\left(
\alpha_s\|\mathbf{h}_{k+i}-\mathbf{h}^{safe}\|^2+
\alpha_e\|Q^{eco}_{k+i}-Q^{eco,ref}_{k+i}\|^2+
\alpha_p\|P_{k+i}-P_{k+i}^{ref}\|^2
\right)
$$

并约束：

$$
Q_{min}^{eco}\le Q_{release,k+i}\le Q_{max}^{flood}
$$

[工程解释] 权重并非“固定常数”，应按汛期/枯期、调峰时段、检修状态动态切换，并纳入审批链路。

[图12-1: 沙坪梯级多目标MPC与联锁关系图]
{描述: 展示安全、生态、发电三目标与联锁保护、ODD门禁、人工接管的关系。}
{尺寸: 全页}
{颜色方案: 蓝色系}

## ODD分域与一键调门禁

针对梯级一键调，建议划分四类ODD：

- ODD-1：常态负荷跟踪；
- ODD-2：汛期泄洪协同；
- ODD-3：检修降容运行；
- ODD-4：突发事件最小风险状态（Minimum Risk State, MRS）。

各ODD应明确：

- 允许机组启停频次；
- 最大爬坡率与闸门动作上限；
- 求解时限与超时回退策略；
- 自动/人工接管边界。

[表12-1: 沙坪梯级ODD门禁与参数映射表]
{描述: 列包括ODD类别、适用工况、关键约束、参数组、触发阈值、回退动作、签批角色。}
{尺寸: 半页}
{颜色方案: 灰度}

## 多站协同约束与分层分布式控制

在蒲布—深溪沟—镇头—沙坪一键调场景中，需同时保证站间流量协调与本地安全联锁。可采用“中心协调层+站级MPC层+设备执行层”三层结构。

站间协调可写为：

$$
Q_{release,r,k}\approx Q_{in,r+1,k+\tau_r},\quad r\in\{pb,sxg,zt\}
$$

功率分配约束可写为：

$$
\sum_{r}P_{r,k}=P_{dispatch,k}\pm\Delta P_{allow}
$$

[物理直觉] 若只追踪总功率而忽略站间时延，会造成下游来水突涨与局部越限风险。

[工程解释] 中心层负责“全局可行”，站级层负责“本地可控”，设备层负责“动作可执行且可追溯”。

## 可复现实例：洪峰来水与调峰任务并发

【例12-1】某日 18:00–22:00 负荷高峰要求梯级总出力维持在 620±20 MW；19:10 起上游洪峰来水增加，预测 90 min 后下游水位逼近黄色区上边界。

**已知**：

- ODD-1 切换到 ODD-2 的触发条件：预测 2 个周期内任一站水位进入黄色区；
- ODD-2 下生态下泄下限提高至 260 m³/s；
- 连续两次求解超时触发参数组 C，并限制机组启停。

**求解**：给出一键调下的门禁切换、功率重分配与安全回退策略。

**解题过程**：

1. 19:10 触发 ODD-2：上调安全权重 $\alpha_s$，收紧各站水位约束；
2. 将总出力偏差优先分配到安全裕度更高的上游站，降低下游站爬坡压力；
3. 若求解连续超时，切换参数组 C，采用“稳态保底+有限跟踪”策略；
4. 当连续3周期退出黄色区且求解时延恢复，才允许逐步回切 ODD-1。

**结果讨论**：
该策略兼顾了电网调峰需求与梯级安全边界，避免了“功率单目标驱动”导致的局部风险放大。

## 上线验收与课程实验评分rubric

### 12.7.1 工程上线验收清单

建议验收维度至少覆盖：

- 安全维度：红/黄区触发率、联锁成功率；
- 实时维度：P95求解时延、超时率、回退成功率；
- 协同维度：站间协调偏差、总出力偏差；
- 运行维度：人工接管次数、恢复时长、事件复盘闭环率。

[表12-2: 沙坪梯级MPC上线验收清单]
{描述: 列包括验收项、目标值、数据来源、判定周期、责任部门、签批人。}
{尺寸: 半页}
{颜色方案: 灰度}

### 12.7.2 教学实验评分rubric模板

面向《水网智能控制实验》课程，可按100分制设置：

- 建模正确性（25分）；
- 约束与门禁设计（25分）；
- 仿真与在环测试结果（25分）；
- 复盘报告与改进建议（25分）。

建议每个分项给出 A/B/C/D 四档标准，确保跨班级评分一致。

[TODO: 需补充学校教学平台中的实验编号、评分表单字段与自动采分接口映射。]

## 全书回顾与后续协同

至此，《水网预测控制》完成了从理论基础到工程实践的闭环：

- ch01–ch04：建立MPC基础与水工对象建模；
- ch05–ch08：扩展到分布式、鲁棒、经济与自适应场景；
- ch09–ch10：补齐安全约束与实时计算门禁；
- ch11–ch12：落地胶东调水与沙坪梯级两类代表性工程。

建议后续与《水网控制在环验证》（M6）与《水利工程自主运行实践》（M8）联合维护案例参数口径与验收模板版本。

## 本章小结

本章围绕沙坪梯级联合调度，给出了多目标MPC工程化方案：以安全、生态、发电三级目标组织优化优先级；以ODD分域和门禁机制管理场景切换；以分层分布式控制实现多站协同；以上线验收与课程rubric支撑工程与教学双场景复用。该章与 ch11 共同构成 M2 的“工程落地双案例”收官部分。

## 习题

### 基础题

**12-1.** 为什么沙坪梯级MPC必须显式区分“安全、生态、发电”三级目标？
**12-2.** ODD-2 与 ODD-4 的触发条件和控制策略有何差异？
**12-3.** 写出站间流量协调约束并解释延时项的工程意义。

### 应用题

**12-4.** 若电网调峰目标临时上调10%，但下游站水位已逼近黄色区，请设计权重调整与回退策略。  
**12-5.** 设计一份“梯级一键调异常事件SOP”，至少包含触发门限、自动动作、人工审批、恢复判据四部分。

### 思考题

**12-6.** 在“发电收益最大化”与“生态下泄刚性约束”冲突时，你如何界定算法权限、调度权限与问责边界？

### 基础题参考答案要点

**12-7.** 因三类目标在风险等级和监管属性上不同，必须分级治理避免目标冲突失控。  
**12-8.** ODD-2面向汛期协同泄洪，ODD-4面向突发事件最小风险状态并强调保底控制。  
**12-9.** $Q_{release,r,k}\approx Q_{in,r+1,k+\tau_r}$，延时项反映站间来水传播时间。

## 拓展阅读

1. **Rawlings, J.B., Mayne, D.Q. & Diehl, M. (2017). *Model Predictive Control: Theory, Computation, and Design*.**
2. **Van Overloop, P.J. (2006). *Model Predictive Control on Open Water Systems*.**
3. **Litrico, X. & Fromion, V. (2009). *Modeling and Control of Hydrosystems*.**
4. **Lei et al. (2025b). 自主智能水网架构。**
5. **Lei et al. (2025c). 在环测试系统。**
