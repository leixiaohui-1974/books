<!-- 变更日志
v1 2026-02-16: 初稿
-->

# ch06 鲁棒MPC与不确定性处理

## 学习目标

完成本章学习后，读者应能够：

1. 识别水网预测控制中的主要不确定性来源并完成分类；
2. 理解管状MPC（Tube MPC）、最坏情形优化与情景MPC的核心思想；
3. 掌握约束收紧（constraint tightening）与不确定集映射的工程方法；
4. 设计“鲁棒性—保守性—实时性”三者平衡的参数策略；
5. 构建不确定工况下的上线门禁与降级回退机制。

> 本章承接 ch05：在分布式架构基础上，进一步讨论模型失配、扰动与通信不确定性对控制性能与安全性的影响。

> **前章回顾**：上一章介绍了本领域的核心概念与方法。本章在此基础上进一步展开。


## 不确定性来源与建模框架

水网控制中的不确定性通常来自：

- **模型不确定性**：参数漂移、结构简化误差；
- **扰动不确定性**：来水波动、需求波动、突发事件；
- **测量不确定性**：传感器噪声、偏置与缺测；
- **执行不确定性**：阀门迟滞、泵站响应偏差；
- **通信不确定性**：时延、抖动、丢包。

统一表示为：

$$
\mathbf{x}_{k+1}=f(\mathbf{x}_k,\mathbf{u}_k)+\mathbf{w}_k,
\quad \mathbf{y}_k=g(\mathbf{x}_k)+\mathbf{v}_k
$$

其中 $\mathbf{w}_k,\mathbf{v}_k$ 分别表示过程扰动与测量噪声。

[物理直觉] 控制器不是在“理想实验台”运行，而是在持续扰动与信息不完整环境中运行，鲁棒策略是上线前提。

## 管状MPC与约束收紧

Tube MPC 将实际轨迹分解为“名义轨迹 + 误差管”：

$$
\mathbf{x}_k = \mathbf{x}_k^{nom} + \mathbf{e}_k
$$

通过设计局部反馈使误差 $\mathbf{e}_k$ 保持在有界集合 $\mathcal{E}$ 内，再对名义系统施加收紧约束：

$$
\mathbf{x}^{nom}_k \in \mathcal{X}\ominus\mathcal{E},\quad
\mathbf{u}^{nom}_k \in \mathcal{U}\ominus K\mathcal{E}
$$

[工程解释] 约束收紧本质上是预留安全裕度，防止扰动把系统“推”到约束边界外。

[图6-1: Tube MPC误差管与约束收紧示意]
{描述: 展示真实轨迹围绕名义轨迹的误差管，以及收紧前后可行域差异。}
{尺寸: 全页}
{颜色方案: 蓝色系}

## 最坏情形与情景鲁棒策略

### 6.4.1 最坏情形MPC

在给定扰动集合内优化最坏性能指标，安全性强但保守性较高，适合高风险工况（如防洪关键期）。

### 6.4.2 情景MPC

通过扰动样本集近似概率约束，保守性较低、性能更好，但对样本质量与计算资源更敏感。

### 6.4.3 工程选型建议

- 安全优先场景：优先最坏情形或 Tube MPC；
- 效率优先场景：优先情景MPC并配门禁；
- 混合场景：分时段切换策略（汛期偏保守、平水期偏经济）。

[表6-1: 三类鲁棒策略对比与选型建议]
{描述: 对比安全性、保守性、计算负担、数据依赖、适用场景。}
{尺寸: 半页}
{颜色方案: 灰度}

## 不确定集标定与协调收敛影响

为回应前章评审建议，本节给出不确定集标定基本流程：

1. 从历史运行数据估计扰动边界与统计分布；
2. 按工况（季节/负荷/检修）分层建立不确定集；
3. 在 MIL/SIL 中评估不同收紧系数下的可行率与违约率；
4. 输出“安全阈值—性能损失”折中曲线。

在分布式MPC中，不确定性会放大边界一致性误差，表现为协调迭代次数增加与收敛速度下降。工程上可通过：

- 边界变量加权滤波；
- 协调增益自适应；
- 超限时临时提升保守系数。

## 可复现实例：扰动下鲁棒水位控制

【例6-1】某明渠—管网耦合系统采用 Tube MPC，采样周期 5 min。设扰动边界通过近三个月数据估计得到，目标是控制断面水位并限制动作率。

**已知**：

- 状态约束 $h\in[2.8,3.3]$ m；
- 未收紧时约束触发率偏高；
- 选择三档收紧系数：低/中/高。

**求解**：比较三档收紧下“违约率—能耗—控制平滑性”变化趋势。

**解题过程**：

1. 低收紧：性能高但违约风险偏高；
2. 中收紧：违约率显著下降且性能损失可接受；
3. 高收紧：最安全但控制过保守、能耗上升。

**结果讨论**：
推荐将中收紧作为默认策略，并在高风险工况切换至高收紧，形成“分工况鲁棒参数组”。

## 上线门禁与降级策略

鲁棒MPC上线前建议门禁：

- 扰动覆盖度满足设定比例；
- 约束违约率低于阈值；
- 求解超时率低于阈值；
- 降级回退成功率高于阈值。

推荐降级链路：鲁棒MPC → 保守线性MPC → 规则控制。每次降级均记录触发原因、持续时长与恢复条件。

[TODO: 需补充具体项目中的扰动覆盖率统计口径与版本号。]

## 本章小结

本章给出了不确定性处理的系统方法：通过 Tube MPC 和约束收紧管理扰动影响，通过最坏情形与情景策略实现风险—性能平衡，通过不确定集标定与门禁机制提升工程可用性。鲁棒性并不等于“越保守越好”，关键在于分工况、可审计、可切换。下一章将进入经济型MPC，讨论在安全前提下的运行成本优化。

## 习题

### 基础题

**6-1.** 为什么约束收紧是鲁棒MPC中常用且有效的手段？
**6-2.** Tube MPC 与情景MPC在工程侧重点上有何差异？
**6-3.** 鲁棒性与保守性为何不能简单画等号？

### 应用题

**6-4.** 设计一个含不确定集的鲁棒MPC约束体系，并说明收紧系数整定步骤。  
**6-5.** 针对“超时+违约双异常”场景，设计分级降级与恢复逻辑。

### 思考题

**6-6.** 若管理层要求“零违约”，你将如何解释其对能耗、供水效率与控制动作的影响？

### 基础题参考答案要点

**6-7.** 因其可将扰动影响前置到可行域设计中，降低在线违约风险。  
**6-8.** Tube MPC重在有界误差保证，情景MPC重在概率意义下性能-风险折中。  
**6-9.** 过度保守会显著损失效率与经济性，需分工况平衡。

## 拓展阅读

1. **Mayne, D.Q. et al. (2005). Robust MPC of constrained linear systems with bounded disturbances.**
2. **Kouvaritakis, B. & Cannon, M. (2016). *Model Predictive Control*.**
3. **Rawlings, J.B., Mayne, D.Q. & Diehl, M. (2017). *Model Predictive Control: Theory, Computation, and Design*.**
4. **Scattolini, R. (2009). Architectures for distributed and hierarchical MPC.**
5. **Lei et al. (2025c). 在环测试系统。**
