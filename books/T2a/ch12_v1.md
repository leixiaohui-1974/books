<!-- 变更日志
v1 2026-02-16: 初稿
-->

# 第十二章 分层分布式控制架构

---

## 学习目标

完成本章后，你应能够：

1. 理解分层分布式控制（Hierarchical Distributed Control, HDC）在大规模水系统中的必要性；
2. 区分 L0/L1/L2 三层控制职责与时空尺度；
3. 设计跨层协调机制与信息流接口；
4. 将 HDC 与 MPC、安全包络、状态估计模块进行集成；
5. 给出工程部署中的降级与故障隔离策略。

> **章首衔接（承接ch11）**  
> 上一章解决了“状态如何可信”。本章进一步回答“控制如何组织”：当系统跨渠段、跨泵站、跨流域时，必须采用分层分布式控制架构保证可扩展与可治理。

## 12.1 为什么需要HDC

[物理直觉] 单一集中式控制器在小系统可行，但在大规模水网中会遇到通信时延、算力瓶颈、组织边界与责任边界等约束。HDC通过“上层协调+下层自治”降低复杂度。

[工程解释] HDC不是“拆分算法”，而是把目标、约束、时间尺度和控制权限进行结构化分配，避免全局控制失稳与局部各自为政。

## 12.2 L0/L1/L2 三层功能划分

[表12-1: 三层控制职责]
| 层级 | 时间尺度 | 核心职责 | 典型算法 |
|---|---|---|---|
| L0 设备层 | 秒级 | 执行机构闭环与联锁 | PID/逻辑联锁 |
| L1 过程层 | 分钟级 | 单站/单渠段优化与约束控制 | 线性MPC/鲁棒控制 |
| L2 调度层 | 小时级 | 区域协调与资源分配 | 分布式优化/协调MPC |

[工程要点] 层级划分应遵循“快环就地、慢环上收、边界清晰、接口稳定”原则。

## 12.3 跨层协调与信息流设计

推荐采用“目标下发—状态上报—约束回传”三向闭环：

1. L2 向 L1 下发滚动目标、供需边界与安全策略；
2. L1 向 L2 回传可行域、执行代价与风险指标；
3. L0 按 L1 指令执行，并上报执行偏差与设备健康度。

[图12-1: HDC跨层信息流与控制闭环]
{描述: 展示L2/L1/L0三层之间的目标流、状态流、约束流，标注与SCADA+MAS Fusion Architecture接口。}
{尺寸: 全页}
{颜色方案: 蓝色系}
{对应ARCH编号: ARCH-04}

## 12.4 分布式协调算法框架

设第 \(i\) 个子系统局部状态为 \(\mathbf{x}_i\)，控制量为 \(\mathbf{u}_i\)，则协调优化可写为：
\[
\min_{\{\mathbf{u}_i\}} \sum_{i=1}^{N} J_i(\mathbf{x}_i,\mathbf{u}_i)
\]
\[
\text{s.t. } \mathbf{x}_i\in\mathcal{X}_{safe,i},\ \mathbf{u}_i\in\mathcal{U}_{safe,i},\ \text{以及耦合约束 } g(\mathbf{x}_1,\ldots,\mathbf{x}_N)\le0
\]

[工程解释] 子系统先在本地求解，再通过协调变量（边界流量、共享库容、功率上限）迭代一致，兼顾实时性与全局性能。

## 12.5 工程部署中的降级与容错

HDC上线必须定义故障分级：

- 通信中断：L1保持局部保守策略，L2进入预测保持模式；
- 局部模型失配：触发在线重标定并收缩约束；
- 设备故障：L0联锁优先，必要时切换最小风险状态（MRS）。

[图12-2: HDC故障降级路径]
{描述: 从“正常分层协同”到“通信受限”“局部自治”“MRS接管”的状态迁移图。}
{尺寸: 半页}
{颜色方案: 蓝色系}
{对应ARCH编号: ARCH-07（安全分区思想借鉴）}

## 12.6 例题：两渠段一泵站的分层协调控制

【例12-1】某调水单元由上游渠段A、下游渠段B与中间泵站组成，要求在来水波动下满足末端供水稳定与能耗约束。

**解题过程**：

步骤1：L2 给出小时级供水目标与能耗上限。  
步骤2：L1-A/L1-B 分别求解本地MPC，并交换边界流量预测。  
步骤3：L0 执行泵速与闸位指令，实时反馈执行偏差。  
步骤4：若通信延迟超阈值，L1切换本地保守模式并上报风险。  
步骤5：L2 下一滚动周期修正目标并恢复协同。

**结果讨论**：

分层结构将“全局目标冲突”转化为“可管理的局部协调问题”，提升了可扩展性与运行韧性。

### HDC上线检查清单

- [ ] 是否完成三层职责、权限与接口字典定义；
- [ ] 是否验证目标流/状态流/约束流时序一致性；
- [ ] 是否通过通信中断与延迟故障注入测试；
- [ ] 是否具备跨层降级与回切策略；
- [ ] 是否建立跨层审计日志与追责链条。

## 12.7 本章小结

本章给出了分层分布式控制的系统化框架：以L0/L1/L2职责解耦为骨架，以跨层信息流与协调优化为核心，以降级与容错机制保障工程可用。下一章将进入数字孪生与仿真平台，支撑HDC的离线设计、在线验证与持续校正。

## 习题

### 基础题

1. 为什么大规模水网不宜采用单一集中式控制？  
2. L0/L1/L2 三层在时间尺度和职责上有何差异？  
3. 跨层信息流中的“约束回传”有什么作用？

### 应用题

4. 为“2泵站+3渠段”系统设计一个简化的L2-L1协调流程。  
5. 设计一次通信中断场景下的HDC降级测试方案。

### 思考题

6. 当局部最优与全局最优冲突时，HDC应如何设定优先级机制？

## 拓展阅读

1. Scattolini, R. Architectures for distributed and hierarchical Model Predictive Control.  
2. Rawlings, J.B. et al. *Model Predictive Control*.  
3. Litrico, X. & Fromion, V. *Modeling and Control of Hydrosystems*.  
4. 钱学森. 《工程控制论》.  
5. Lei et al. (2025b). 自主智能水网架构。
