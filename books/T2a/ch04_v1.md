<!-- 变更日志
v1 2026-02-16: 初稿
-->

# 第四章 水系统降阶建模

---

## 学习目标

完成本章后，你应能够：

1. 解释降阶模型（Reduced-Order Model, ROM）在水系统控制中的必要性与边界；
2. 建立 Muskingum-Cunge 与 IDZ（Integrator Delay Zero）模型的基本形式；
3. 使用频率域辨识思路估计主要动态参数并完成有效性校核；
4. 比较机理降阶与数据驱动降阶在可解释性、泛化性与上线风险上的差异；
5. 将 ROM 与后续模型预测控制（Model Predictive Control, MPC）和安全包络（Safety Envelope）约束无缝对接。

> **章首衔接（承接ch03）**  
> 上一章给出了“稳态可行+瞬态安全”的管网建模框架，并强调动作序列与约束联锁。本章进一步回答：在保持关键动态与安全约束不丢失的前提下，如何把复杂对象压缩成可在线计算的控制模型。

## 4.1 为什么需要降阶建模

水系统原始模型往往维度高、参数多、计算代价大。若直接把高保真模型用于在线滚动优化，常出现“算得准但算不动”的工程困境。降阶建模的目标不是追求形式简化，而是在可解释、可验证、可计算三者之间取得平衡。

[表4-1: 全阶模型与降阶模型的工程对比]
| 维度 | 全阶模型 | 降阶模型（ROM） | 工程意义 |
|---|---|---|---|
| 计算负担 | 高 | 中/低 | 决定是否可在线部署 |
| 参数可辨识性 | 低（参数多） | 较高（参数少） | 决定是否可持续校正 |
| 物理解释性 | 强 | 中-强（取决于方法） | 决定是否可审计 |
| ODD可迁移性 | 受限 | 较好（可重标定） | 决定跨场景推广成本 |

## 4.2 Muskingum-Cunge 降阶模型

### 4.2.1 物理直觉

[物理直觉] 明渠或河道的汇流响应可看作“平移+衰减”的组合：上游流量扰动以一定传输延时向下游传播，同时受弥散与蓄泄作用平滑。

### 4.2.2 基本离散表达

[公式]
\[
Q_{k+1}^{out}=C_0 Q_{k+1}^{in}+C_1 Q_k^{in}+C_2 Q_k^{out}
\]

其中系数满足：
\[
C_0+C_1+C_2=1
\]

[工程解释] 上式将分布参数对象压缩为少量可辨识参数。若 \(C_2\) 过大，表示系统“记忆性”强；若 \(C_0\) 较高，表示来流对出流即时影响更强。

### 4.2.3 适用边界

Muskingum-Cunge 适用于以平移扩散为主导的渠道段；在强回水、闸控频繁或冰期突变工况下，需要引入分段参数或切换模型。

## 4.3 IDZ 模型：Integrator Delay Zero

### 4.3.1 模型结构

IDZ 模型是水系统控制中常用的低维结构：
\[
G(s)=K\frac{1+T_z s}{s}e^{-\tau s}
\]

[工程解释] 该模型包含四个核心要素：增益 \(K\)、零点时间常数 \(T_z\)、积分环节与传输延时 \(\tau\)。它能够以极低维度表达“慢积分+纯延时”的主导动态。

### 4.3.2 参数物理意义

- \(K\)：输入变化对稳态输出趋势的放大能力；
- \(T_z\)：短时超前/滞后补偿特征；
- \(\tau\)：控制动作到可测响应的延时；
- 积分项：体现累计效应与慢动态漂移。

[表4-2: IDZ参数异常与调试建议]
| 现象 | 可能参数问题 | 调试建议 |
|---|---|---|
| 预测响应整体滞后 | \(\tau\) 偏大 | 复核时间戳与采样对齐 |
| 稳态偏差长期存在 | \(K\) 失配 | 分工况重标定增益 |
| 短时响应方向错误 | \(T_z\) 估计异常 | 限制零点范围并重辨识 |

## 4.4 频率域辨识：从数据到可控模型

### 4.4.1 辨识流程

频率域辨识可用于在扰动与噪声背景下提取主导动态，建议流程：

1. 设计小幅可激励输入，避免触发 Safety Envelope 边界；
2. 计算频响并拟合目标传递函数 \(G(s)\)；
3. 在时域回放校核关键指标（峰值误差、相位滞后、恢复时间）；
4. 将参数写入“模型版本+ODD标签”以支持审计。

[图4-1: 频率域辨识与时域回放双校核流程]
{描述: 左侧为试验激励与数据采集，中部为频响拟合与参数估计，右侧为时域回放与误差门限检查，底部标注模型版本管理。}
{尺寸: 全页}
{颜色方案: 蓝色系}
{对应ARCH编号: 无（本章自定义教学图）}

### 4.4.2 误差指标与上线门槛

建议至少给出三类门槛：

- 幅值误差门槛：约束跟踪精度；
- 相位误差门槛：约束时滞补偿可靠性；
- 约束违例门槛：约束预测越界率。

若任一门槛不满足，应保持“离线可用”而非“在线可用”状态。

## 4.5 数据驱动降阶：机会与边界

数据驱动 ROM（如子空间辨识、稀疏回归、轻量神经网络）在多工况覆盖充分时可显著提升拟合能力，但必须遵守两条原则：

1. **边界可解释**：模型输出必须可映射到 \(\mathcal{X}_{safe}\subseteq\mathcal{X}_{ODD}\) 约束检查；
2. **退化可切换**：当数据质量下降或分布漂移时，可退回机理ROM。

[图4-2: 机理ROM与数据ROM的双轨切换架构]
{描述: 上轨为Muskingum/IDZ机理ROM，下轨为数据驱动ROM，中间为一致性监视器，右侧为MPC控制器与安全联锁。}
{尺寸: 全页}
{颜色方案: 蓝色系}
{对应ARCH编号: ARCH-05（双引擎思想借鉴）}

## 4.6 例题：IDZ模型参数辨识与上线判定

【例4-1】某调水渠段拟采用 IDZ 模型服务滚动调度。试验得到阶跃输入与下游水位响应数据，初辨识参数为 \(K=0.82\), \(T_z=180\,s\), \(\tau=900\,s\)。请给出上线判定步骤。

**已知**：

- 预测场景覆盖日常供水工况；
- Safety Envelope 约束要求“预测越界率 < 1%”；
- 允许先离线上线（建议模式）再转在线闭环。

**求解**：模型是否可直接用于在线MPC。

**解题过程**：

步骤1：以辨识参数构建 \(G(s)\)，完成频域拟合误差计算。  
步骤2：在代表性工况做时域回放，检查峰值误差和相位偏差。  
步骤3：将模型嵌入约束预测，统计越界率。  
步骤4：若越界率接近门槛，先以建议模式运行并记录偏差，再决定是否闭环接管。

**结果讨论**：

该流程体现“先可验证，再可接管”的上线原则。ROM 的价值不在于绝对最优拟合，而在于可持续维护与可审计部署。

### 降阶模型上线检查清单

- [ ] 是否完成“频域拟合+时域回放”双校核；
- [ ] 是否显式绑定 ODD 标签与模型版本号；
- [ ] 是否验证 \(\mathcal{X}_{safe}\subseteq\mathcal{X}_{ODD}\) 约束预测一致性；
- [ ] 是否定义模型失配时的退化策略（切回机理ROM/人工接管）；
- [ ] 是否完成最不利工况抽样复核。

## 4.7 本章小结

本章围绕“可算、可控、可审计”三目标建立了降阶建模框架：以 Muskingum-Cunge 与 IDZ 为机理主线，以频率域辨识为参数获取手段，以数据驱动 ROM 为补充能力，并以上线检查清单约束落地风险。下一章将进入经典控制方法，讨论在给定 ROM 条件下如何进行 PID/前馈-反馈与频域整形设计。

## 习题

### 基础题

1. 说明为何 ROM 不等于“随意简化模型”。  
2. 写出 IDZ 模型表达，并解释 \(K\) 与 \(\tau\) 的工程意义。  
3. Muskingum-Cunge 系数满足什么约束？其意义是什么？

### 应用题

4. 给定两组 IDZ 参数，比较其在“响应速度—稳态偏差—时滞补偿”上的差异，并给出上线建议。  
5. 为某渠段设计一个最小可执行的频率域辨识试验方案（输入设计、采样频率、校核指标）。

### 思考题

6. 当数据驱动 ROM 拟合精度高于机理 ROM，但可解释性较差时，你会如何制定双轨上线策略？

## 拓展阅读

1. Litrico, X., & Fromion, V. *Modeling and Control of Hydrosystems*.  
2. Van Overloop, P.J. *Model Predictive Control on Open Water Systems*.  
3. ASCE (2014). *MOP 131: Canal Automation for Irrigation Systems*.  
4. Lei et al. (2025a). 理论背景与研究范式。  
5. Lei et al. (forthcoming). 水系统降阶建模与工程部署方法。
