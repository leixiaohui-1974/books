<!-- 变更日志
v1 2026-02-16: 初稿
-->

# ch01 绪论：为什么需要HydroOS

## 1.1 学习目标

完成本章后，读者应能够：

1. 说明水网从“SCADA可视化监控”走向“自主运行”时的软件系统鸿沟；
2. 理解水网操作系统（Water Network Operating System, HydroOS）的定位、边界与核心能力；
3. 区分设备控制、调度优化、认知决策三类能力在系统中的职责分层；
4. 给出HydroOS在运行设计域（Operational Design Domain, ODD）与安全包络（Safety Envelope）约束下的价值主张；
5. 建立本书后续章节的阅读地图。

> 本书承接《水网预测控制》：M2解决“如何控制”，M7重点回答“如何把控制能力组织为可部署、可扩展、可运维的操作系统”。

## 1.2 从应用堆叠到系统平台

传统工程信息化常以“项目制功能叠加”推进：调度模块、告警模块、报表模块分散建设，导致接口异构、版本碎片化与责任边界不清。

[物理直觉] 水网运行是连续过程，不可能按“一个模块一个时钟”独立运行；软件系统也必须像水力系统一样保持时序与约束一致。

HydroOS的核心转变是：从“工具集合”升级为“统一运行时平台”，使控制、优化、告警、审计在同一时空语义下协同。

[工程解释] 平台化并非追求“大而全”，而是通过统一接口、统一模型注册、统一门禁机制，降低长期维护成本和系统性风险。

## 1.3 HydroOS的定义与系统边界

本书采用如下定义：

**HydroOS 是面向水网运行工程的专用操作系统，提供设备抽象、任务编排、实时数据总线、控制执行、安全门禁与审计回放等基础能力，为上层应用提供可验证的运行环境。**

其边界包括：

- 向下：连接PLC/RTU/传感器/执行器与SCADA接口；
- 向上：支撑模型预测控制（Model Predictive Control, MPC）、多智能体系统（Multi-Agent System, MAS）、认知AI应用；
- 向侧：对接工单、资产、仿真、在环测试（In-the-Loop Testing）平台。

[图1-1: HydroOS系统边界与上下游接口]
{描述: 展示设备层、运行时层、应用层三层结构及与SCADA、MPC、MAS、工单系统的接口关系。}
{尺寸: 全页}
{颜色方案: 蓝色系}
{对应ARCH编号: ARCH-03}

## 1.4 三层能力：可控、可管、可演进

HydroOS可抽象为三类能力：

1. **可控（Controllable）**：保障控制链路时序确定、指令可执行、故障可回退；
2. **可管（Governable）**：保障权限、门禁、审计、责任追踪闭环；
3. **可演进（Evolvable）**：保障模型、策略、服务在不中断运行前提下迭代升级。

运行时约束可写为：

$$
\tau_{data}+\tau_{decision}+\tau_{act}\le T_c
$$

其中 $\tau_{data}$ 为数据进入运行时的处理时延，$\tau_{decision}$ 为策略决策时延，$\tau_{act}$ 为执行落地时延。

[工程解释] 该式是HydroOS运行门禁底线。若超时，平台必须触发降级，而不是静默失败。

## 1.5 ODD与安全包络：操作系统的第一公民

在通用IT系统中，安全常被视为附加模块；在水网操作系统中，安全必须内生于调度与执行路径。

HydroOS将ODD与安全包络作为运行时第一类对象：

- ODD决定系统在何种工况下允许运行何种策略；
- 安全包络决定状态变量可达边界与联锁触发条件；
- 二者共同决定策略是否可发布、可执行、可持续。

[表1-1: HydroOS运行门禁对象清单]
{描述: 列包括对象类型、关键字段、校验时机、失败动作、责任角色。}
{尺寸: 半页}
{颜色方案: 灰度}

## 1.6 可复现实例：策略发布前门禁检查

【例1-1】某泵站群计划发布新MPC参数组，目标是降低峰时能耗。发布窗口为 22:00–23:00，要求不得触发红色告警。

**已知**：

- 平台设有“模型签名校验、ODD匹配检查、安全包络回放、超时门禁仿真”四道门禁；
- 任一门禁失败则禁止发布并自动回退旧版本；
- 发布后观察期为 30 min，若连续两次黄色告警则触发回滚。

**求解**：设计发布流程与判定条件。

**解题过程**：

1. 发布前执行离线回放，校验新参数在目标ODD下未触发红区；
2. 发布时采用灰度策略，仅对低风险子域生效；
3. 观察期内监测求解时延与告警级别，满足门禁后再全量生效；
4. 若触发黄色告警阈值，则自动回滚并生成审计工单。

**结果讨论**：
该流程将“经验性上线”转化为“可验证上线”，显著降低了策略变更引发的系统性风险。

## 1.7 本书结构导读

后续章节按“架构—核心机制—工程实现—案例验证”展开：

- ch02：HydroOS总体架构与组件划分；
- ch03：设备抽象层与驱动适配；
- ch04：实时数据总线与事件系统；
- ch05：任务编排与调度引擎；
- ch06：控制与优化服务托管；
- ch07：安全门禁与审计系统；
- ch08：在环测试与发布流水线；
- ch09：多站协同运行机制；
- ch10：工程部署与运维体系。

## 1.8 本章小结

本章明确了HydroOS的提出背景与核心定位：它不是单一应用，而是把控制、优化、安全、审计统一在同一运行时中的工程操作系统。通过定义系统边界、三层能力和运行门禁对象，本章给出了从“项目化堆叠”走向“平台化治理”的逻辑起点。下一章将进入HydroOS总体架构，详细说明各层组件与接口契约。

## 习题

### 基础题

1. 为什么水网运行软件不能长期依赖“项目制功能叠加”？
2. HydroOS与传统SCADA平台在系统定位上有何本质区别？
3. 解释 $\tau_{data}+\tau_{decision}+\tau_{act}\le T_c$ 的工程含义。

### 应用题

4. 设计一份“策略灰度发布门禁表”，至少包含检查项、阈值、失败动作与责任人。  
5. 给定一个“检修+高峰负荷”场景，说明如何利用ODD限制策略发布范围。

### 思考题

6. 当“快速上线新策略”与“严格门禁审批”冲突时，你如何平衡创新效率与运行安全？

### 基础题参考答案要点

1. 因接口异构、版本碎片与责任不清会放大运行风险。  
2. SCADA偏监控与采集，HydroOS强调运行时编排、门禁与可审计执行。  
3. 数据处理、决策、执行总时延必须不超过控制周期，否则应触发降级或回退。

## 拓展阅读

1. Tanenbaum, A.S. & Bos, H. (2014). *Modern Operating Systems*.  
2. Rawlings, J.B., Mayne, D.Q. & Diehl, M. (2017). *Model Predictive Control: Theory, Computation, and Design*.  
3. Litrico, X. & Fromion, V. (2009). *Modeling and Control of Hydrosystems*.  
4. Lei et al. (2025b). 自主智能水网架构。  
5. Lei et al. (2025c). 在环测试系统。

> **术语一致性声明**：本章统一采用“水网操作系统（Water Network Operating System, HydroOS）”“运行设计域（Operational Design Domain, ODD）”“安全包络（Safety Envelope）”“模型预测控制（Model Predictive Control, MPC）”“多智能体系统（Multi-Agent System, MAS）”“在环测试（In-the-Loop Testing）”等规范术语；数学符号采用 $Q,h,\tau,T_p,T_c,\mathbf{x},\mathbf{u},\mathbf{y},J$。

### 质量检查清单（执行结果）

- [x] 章首学习目标、章末小结/习题/拓展阅读完整；
- [x] 基础题3 + 应用题2 + 思考题1，含基础题答案要点；
- [x] 公式前有物理直觉，公式后有工程解释；
- [x] 含可复现实例（例1-1）；
- [x] 图表不少于2项（图1-1、表1-1）；
- [x] 章首承接M2，章末预告ch02。
