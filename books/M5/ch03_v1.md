<!-- 变更日志
v2 2026-02-18: 根据四角色评审修订——增加NER性能基线、SCADA同步方案、构建周期估算
v1 2026-02-18: 初稿
-->

# 第三章 水利知识表示与知识图谱

---

## 学习目标

完成本章后，读者应能够：

1. 设计水利领域本体的核心类层次结构和属性定义，覆盖设备、工况、规程和事件四大类；
2. 运用命名实体识别（NER）和关系抽取技术从调度规程文本中自动提取实体和关系；
3. 选择适合水利场景的图数据库方案，编写基本的知识图谱查询语句；
4. 设计知识图谱的质量保障流程，包括一致性检查、完整性评估和人工审核机制；
5. 说明知识图谱在水利认知智能系统中的三种主要应用模式。

> **章首衔接（承接ch02）**
> 上一章介绍了知识表示的形式化方法和自然语言处理技术基础。本章将这些理论工具应用于水利领域，回答一个核心问题：如何将散落在规程文档、设备台账和运行记录中的水利知识，系统化地组织为计算机可检索、可推理的知识图谱？

---

## 3.1 为什么水利领域需要知识图谱

### 3.1.1 从文件柜到知识网络

2023年，某省级调水管理局启动了一次调度规程全面修订工作。修订组在梳理现有文档时发现：同一座闸门在不同年份的规程文档中，其设计流量的描述存在3处不一致；某条联锁规则在正常工况规程中规定"水位超限时关闭闸门"，但在检修工况规程中未提及相应的替代方案；5年前更换的传感器型号在设备台账中已更新，但在应急处置手册中仍引用旧型号参数。

这类问题的根源在于：水利知识以文件为单位独立管理，文件之间缺乏结构化的关联。当某个事实发生变化时，所有引用该事实的文件都需要人工逐一更新——这在文档数量达到数千份时几乎不可能做到完美。

知识图谱提供了一种根本性不同的知识管理范式：将每个事实（如"3号闸门的设计流量为50m³/s"）作为图中的一个节点或边存储，当该事实变更时，只需更新一处，所有引用该事实的上下文自动获得一致信息。

### 3.1.2 知识图谱在水利认知智能中的三重角色

在本书定义的认知AI引擎架构中，知识图谱承担三重角色：

**角色一：结构化知识的持久存储**。将设备参数、拓扑关系、规程条款等事实性和规则性知识以三元组形式存储，支持精确查询和逻辑推理。

**角色二：RAG系统的语义增强**。为第五章的RAG系统提供结构化的上下文信息，弥补纯文本检索无法捕捉的实体关系。例如，当用户问"3号闸门上游有哪些泵站？"时，知识图谱可以通过拓扑关系直接回答，而纯文本检索可能需要在多篇文档中搜索才能拼凑出答案。

**角色三：推理与一致性检查的基础**。基于知识图谱的推理能力，可以自动检测知识库中的不一致和缺失。例如，检测"某闸门在规程A中的最大开度为3m，但在规程B中为2.5m"的冲突。

[表3-1: 知识图谱在水利认知智能中的三重角色]

| 角色 | 功能 | 对应章节 | 典型查询示例 |
|------|------|---------|------------|
| 结构化存储 | 事实存储与精确查询 | 本章 | "3号闸门的设计参数" |
| RAG语义增强 | 为文本检索提供结构化上下文 | ch05 | "与当前告警相关的规程条款" |
| 推理与一致性检查 | 检测知识冲突、推断隐含关系 | ch06 | "该工况下所有受影响的下游设备" |

---

## 3.2 水利领域本体设计

### 3.2.1 本体设计方法论

本体设计采用"自顶向下+自底向上"结合的方法（Noy & McGuinness, 2001）：

**自顶向下**：从水利领域的高层概念出发，定义核心类和关系。这一步需要领域专家参与，确保本体覆盖关键概念且层次结构合理。

**自底向上**：从实际的规程文本、设备台账和运行记录中抽取实体和关系，验证并补充自顶向下定义的本体结构。

两者结合的迭代过程可确保本体既有良好的理论结构，又能覆盖工程实践中的真实需求。

### 3.2.2 水利本体的核心类层次

基于对多个大型调水工程和水电站运行文档的分析，提出以下水利领域本体的核心类层次结构：

**一级类（Top-Level Classes）**：

```
HydroEntity (水利实体)
├── Infrastructure (水工基础设施)
│   ├── Channel (渠道)
│   │   ├── OpenChannel (明渠)
│   │   └── Pipeline (管道)
│   ├── Structure (水工建筑物)
│   │   ├── Gate (闸门)
│   │   │   ├── SlideGate (平板闸门)
│   │   │   └── RadialGate (弧形闸门)
│   │   ├── PumpStation (泵站)
│   │   ├── Reservoir (水库)
│   │   └── Weir (堰)
│   └── Network (水网)
│       ├── WaterTransferSystem (调水系统)
│       └── HydropowerCascade (梯级水电系统)
├── Equipment (设备)
│   ├── Sensor (传感器)
│   │   ├── WaterLevelSensor (水位传感器)
│   │   ├── FlowSensor (流量传感器)
│   │   └── GatePositionSensor (闸位传感器)
│   ├── Actuator (执行器)
│   └── CommunicationDevice (通信设备)
├── OperationalConcept (运行概念)
│   ├── OperatingCondition (工况)
│   │   ├── NormalCondition (正常工况)
│   │   ├── AbnormalCondition (异常工况)
│   │   └── EmergencyCondition (应急工况)
│   ├── SafetyEnvelope (安全包络)
│   ├── ODD (运行设计域)
│   └── WNAL_Level (水网自主等级)
├── Event (事件)
│   ├── Alarm (告警)
│   ├── Fault (故障)
│   ├── MaintenanceEvent (检修事件)
│   └── DispatchEvent (调度事件)
└── Document (文档)
    ├── Regulation (调度规程)
    ├── IncidentReport (事故通报)
    ├── MaintenanceManual (检修手册)
    └── MeetingMinutes (会议纪要)
```

### 3.2.3 核心属性定义

每个类需要定义其属性（Properties），分为数据属性（Data Properties）和对象属性（Object Properties）：

**数据属性示例（Gate类）**：

| 属性名 | 值域 | 单位 | 必填 | 示例 |
|--------|------|------|------|------|
| gateID | string | — | 是 | "JD-G-003" |
| gateName | string | — | 是 | "3号闸门" |
| gateType | enum{slide, radial, ...} | — | 是 | "slide" |
| maxOpening | float [0, 10] | m | 是 | 2.5 |
| designFlow | float [0, 500] | m³/s | 是 | 50.0 |
| installDate | date | — | 否 | "2015-06-15" |
| currentStatus | enum{normal, fault, maintenance} | — | 是 | "normal" |

**对象属性示例（表示实体间关系）**：

| 属性名 | 定义域 | 值域 | 基数 | 说明 |
|--------|--------|------|------|------|
| locatedIn | Equipment | Channel | 1 | 设备所在渠段 |
| upstreamOf | Channel | Channel | 0..* | 上游关系 |
| downstreamOf | Channel | Channel | 0..* | 下游关系 |
| monitoredBy | Structure | Sensor | 1..* | 监测关系 |
| controlledBy | Gate | Actuator | 1 | 控制关系 |
| triggeredBy | Alarm | OperatingCondition | 1..* | 触发关系 |
| requiresAction | Alarm | DispatchEvent | 1..* | 需要的响应 |
| governedBy | Structure | Regulation | 1..* | 受哪些规程约束 |
| conflictsWith | MaintenanceEvent | DispatchEvent | 0..* | 冲突关系 |

### 3.2.4 约束与公理

本体中的约束（Axioms）用于保证知识的逻辑一致性：

**类型约束**：
- 每个Gate必须locatedIn恰好一个Channel
- 每个Alarm必须triggeredBy至少一个OperatingCondition

**值域约束**：
- Gate.currentOpening ≤ Gate.maxOpening
- Sensor.lastReadingTime与当前时间的差值 ≤ Sensor.maxCommunicationInterval（否则触发通信故障告警）

**拓扑约束**：
- upstreamOf关系必须是非对称的：如果A upstreamOf B，则不能同时B upstreamOf A
- upstreamOf关系必须是传递的：如果A upstreamOf B且B upstreamOf C，则A upstreamOf C

[工程解释] 拓扑约束看似简单，但在实际工程中可能出现违反——例如，某些环形水网中水流方向可能随工况变化。本体设计需要识别这类特殊情况，通过引入"条件关系"（在特定工况下的上下游关系）来处理。

---

## 3.3 知识抽取：从文本到三元组

### 3.3.1 知识抽取的总体流程

将调度规程等非结构化文本转化为知识图谱中的三元组，需要经过以下流程：

```
原始文档 → 文档预处理 → 命名实体识别(NER) → 关系抽取(RE)
  → 三元组生成 → 质量审核 → 入库
```

### 3.3.2 文档预处理

水利领域文档的预处理面临若干特殊挑战：

**格式多样性**：规程文档可能是PDF（扫描版或电子版）、Word、甚至纸质扫描件。需要OCR、PDF解析等技术将其转化为可处理的文本。

**结构识别**：调度规程通常具有清晰的层次结构（章→节→条款→款项），但不同工程的格式规范不完全一致。需要利用文档结构识别技术，将扁平文本还原为层次化结构。

**表格与公式处理**：规程中常包含参数表（如闸门特性表、水位-流量关系表）和公式。这些结构化信息的提取需要专门的表格识别和公式解析模块。

[表3-2: 水利文档预处理的典型挑战与应对方案]

| 挑战 | 表现 | 应对方案 |
|------|------|---------|
| 扫描版PDF | 文字不可选中，含噪声 | OCR + 后处理校正 |
| 格式不统一 | 不同年份规程模板不同 | 模板自适应解析器 |
| 专业表格 | 闸门参数表、水位流量表 | 专用表格提取模块 |
| 公式与符号 | LaTeX或图片形式的公式 | 公式OCR（如Mathpix） |
| 图纸引用 | 规程中引用工程布置图 | 图文交叉索引 |

### 3.3.3 水利领域命名实体识别

命名实体识别（NER）的目标是从文本中识别出预定义类型的实体。水利领域NER需要识别的实体类型包括：

| 实体类型 | 标签 | 示例 |
|---------|------|------|
| 设施名称 | FAC | "引黄济青渠段""3号闸门""东平泵站" |
| 位置桩号 | LOC | "K32+500""进水口" |
| 数值参数 | VAL | "50m³/s""2.5m""0.0001" |
| 时间表达 | TIME | "暴雨预警后6小时""每年11月至次年3月" |
| 工况标签 | COND | "正常输水工况""冰期工况""应急泄洪" |
| 操作动作 | ACT | "开启闸门""降低水位""启动泵站" |
| 规程编号 | REG | "第3.2.1条""附录B" |

**NER技术选择**：

对于水利领域NER，推荐采用"预训练模型+领域微调"策略：

1. 基础模型选择中文预训练模型（如BERT-wwm-ext或RoBERTa-large）；
2. 在人工标注的水利领域NER数据集上微调；
3. 对于极低频实体（如新建设施名称），结合词典匹配方法补充。

**标注数据准备**：

水利领域NER标注数据的获取是一个冷启动难题。建议采用以下策略：

- **种子标注**：由领域专家标注50-100篇规程文档（约2-5万句），覆盖主要实体类型；
- **主动学习**：使用初始模型预测未标注文档，选择模型最不确定的样本请专家标注，逐步扩大标注集；
- **远程监督**：利用已有的设备台账（如闸门名称列表）自动生成弱标注数据，用于预训练。

**预期性能基线**：根据类似工业领域（电力、石化）的NER研究经验，在50-100篇标注文档（约3万句）的训练数据条件下，基于BERT的NER模型在水利领域的预期性能为：设施名称（FAC）Entity-level F1 ≈ 85-90%；数值参数（VAL）F1 ≈ 90-95%；操作动作（ACT）F1 ≈ 75-85%。操作动作的F1较低是因为动作表述多样性大（"开启""打开""提升开度"均表示同一动作）。增大标注数据量至200篇以上，各类型F1可提升3-5个百分点。

### 3.3.4 水利领域关系抽取

关系抽取（Relation Extraction, RE）的目标是识别文本中实体对之间的语义关系。水利领域的核心关系类型包括：

| 关系类型 | 示例句 | 抽取结果 |
|---------|--------|---------|
| 位置关系 | "3号闸门位于K32+500处" | (3号闸门, locatedAt, K32+500) |
| 参数关系 | "设计流量为50m³/s" | (3号闸门, designFlow, 50m³/s) |
| 上下游关系 | "上游来水经1号渠段汇入2号渠段" | (1号渠段, upstreamOf, 2号渠段) |
| 条件-动作关系 | "当水位超过28.5m时，应开启泄洪闸" | (水位>28.5m, triggers, 开启泄洪闸) |
| 设备-传感器关系 | "该闸门水位由WL-003号传感器监测" | (闸门, monitoredBy, WL-003) |
| 规程约束关系 | "根据《防洪调度方案》第4.2条" | (操作, governedBy, 防洪调度方案§4.2) |

**条件-动作关系的特殊处理**：

调度规程中最核心的知识形式是"条件-动作"规则，如：

> "当上游水位超过设计水位0.3m且持续时间超过30分钟时，应立即通知下游管理所并启动预泄方案。"

这类规则的抽取比简单的二元关系更复杂，需要处理：
- 复合条件（多个条件的"且""或"关系）；
- 时间约束（"持续时间超过30分钟"）；
- 多动作序列（"通知"和"启动"是两个有序动作）。

建议采用"LLM辅助+规则校验"的混合方法：

1. 使用LLM从规程文本中抽取条件-动作规则的结构化表示；
2. 用规则引擎校验抽取结果的逻辑一致性（如检查数值范围是否合理）；
3. 由领域专家审核高风险条款的抽取结果。

【例3-1】从调度规程条款中抽取知识三元组

[已知] 调度规程原文如下：

> "第3.2.1条 正常输水工况下，引黄济青干渠K32+500处3号闸门控制流量不超过50m³/s。当上游来水流量超过设计值的120%时，应在15分钟内将3号闸门开度调减至1.5m以下，同时通知下游东平管理所。"

[求解] 从该条款中抽取以下三元组和规则：

实体识别结果：
- (FAC) 引黄济青干渠、3号闸门、东平管理所
- (LOC) K32+500
- (VAL) 50m³/s、120%、15分钟、1.5m
- (COND) 正常输水工况
- (REG) 第3.2.1条

三元组抽取结果：
- (3号闸门, locatedAt, K32+500)
- (3号闸门, belongsTo, 引黄济青干渠)
- (3号闸门, maxFlow_normal, 50m³/s)
- (3号闸门, governedBy, 第3.2.1条)

条件-动作规则抽取：
```
RULE 3.2.1-1:
  CONDITION:
    工况 == "正常输水" AND
    上游来水流量 > 设计值 × 1.2
  ACTION:
    1. 在15分钟内: 3号闸门.开度 < 1.5m
    2. 通知: 东平管理所
  REFERENCE: 第3.2.1条
```

[结果讨论] 该条款共产生4个事实三元组和1条包含时间约束的条件-动作规则。实际规程中类似条款可能有数百条，自动抽取+人工审核的流程可以大幅提升知识图谱的构建效率。

---

## 3.4 知识图谱存储与查询

### 3.4.1 图数据库选型

知识图谱的存储后端通常采用图数据库（Graph Database）。以下对比水利认知智能系统中常用的方案：

| 数据库 | 数据模型 | 查询语言 | 适用规模 | 优势 | 适用场景 |
|--------|---------|---------|---------|------|---------|
| Neo4j | 属性图 | Cypher | 千万-亿级节点 | 成熟稳定、社区活跃 | 生产部署首选 |
| Apache Jena | RDF三元组 | SPARQL | 亿级三元组 | OWL推理支持 | 需要本体推理 |
| TigerGraph | 属性图 | GSQL | 十亿级以上 | 分布式、高性能 | 超大规模水网 |
| NebulaGraph | 属性图 | nGQL | 亿级以上 | 开源、分布式 | 大规模、成本敏感 |

对于典型的调水工程或水电站项目，推荐从Neo4j起步：其属性图模型直观易懂，Cypher查询语言表达力强，社区支持好。当知识图谱规模超过亿级节点时，可考虑迁移到TigerGraph或NebulaGraph。

### 3.4.2 Cypher查询示例

以下展示几个水利知识图谱的典型Cypher查询：

**查询一：获取某闸门的基本信息和上下游关系**

```cypher
MATCH (g:Gate {gateID: "JD-G-003"})
OPTIONAL MATCH (g)-[:locatedIn]->(ch:Channel)
OPTIONAL MATCH (ch_up:Channel)-[:upstreamOf]->(ch)
RETURN g.gateName, g.designFlow, g.maxOpening,
       ch.channelName, collect(ch_up.channelName) AS upstreamChannels
```

**查询二：查找与当前告警相关的规程条款**

```cypher
MATCH (a:Alarm {alarmID: $currentAlarmID})
MATCH (a)-[:triggeredBy]->(cond:OperatingCondition)
MATCH (cond)<-[:appliesTo]-(reg:Regulation)
RETURN reg.regTitle, reg.clauseNumber, reg.clauseText
ORDER BY reg.priority DESC
```

**查询三：检测闸门参数在不同规程中的不一致**

```cypher
MATCH (g:Gate)-[r1:hasParameter]->(p1:Parameter),
      (g)-[r2:hasParameter]->(p2:Parameter)
WHERE r1.source <> r2.source
  AND p1.paramName = p2.paramName
  AND p1.paramValue <> p2.paramValue
RETURN g.gateName, p1.paramName,
       p1.paramValue AS value_doc1, r1.source AS doc1,
       p2.paramValue AS value_doc2, r2.source AS doc2
```

[工程解释] 查询三是知识图谱"一致性检查"功能的典型实现。在传统文件管理模式下，发现参数不一致需要人工逐份比对文档。在知识图谱中，一条查询语句即可自动发现所有不一致。

### 3.4.3 知识图谱的动态更新

水利知识图谱不是一次构建后静态使用的——工程改建、设备更换、规程修订都要求知识图谱及时更新。

**更新触发源**：
- 设备台账变更：设备更换、参数调整
- 规程修订：条款新增、修改、废止
- 运行事件：新增事故案例、处置经验
- SCADA实时数据：设备状态变化

**更新流程**：

```
变更事件 → 变更影响分析 → 三元组增删改 → 一致性检查 → 版本记录
```

关键原则：
1. **变更可追溯**：每次三元组的增删改都记录操作时间、操作人、变更原因和关联文档；
2. **影响分析**：修改一个实体的属性时，自动检查是否影响相关的条件-动作规则；
3. **版本管理**：保留知识图谱的历史版本，支持"当时的知识状态"查询（用于事后追溯）。

**与SCADA数据的自动同步**：

设备实时状态（如闸门当前开度、传感器在线/离线状态）的更新频率远高于规程修订。建议采用"双层同步"架构：

- **静态层**：存储设备参数、拓扑关系、规程条款等低频变更知识，通过人工审核后入库，更新周期为天-月级别；
- **动态层**：通过SCADA数据适配器实时读取设备状态并映射为知识图谱中实体的currentStatus、lastReading等属性，更新周期为秒-分钟级别。

动态层数据不直接写入图数据库的持久化存储（避免高频写入的性能问题），而是维护在内存缓存（如Redis）中，查询时与静态层合并返回。这一设计在保证实时性的同时，不影响知识图谱核心数据的稳定性。

---

## 3.5 知识图谱质量保障

### 3.5.1 质量维度

知识图谱的质量直接影响认知AI引擎的可靠性。质量评估覆盖以下维度：

| 质量维度 | 定义 | 评估方法 | 目标 |
|---------|------|---------|------|
| 准确性 | 三元组是否与事实一致 | 抽样人工核查 | ≥ 95% |
| 完整性 | 是否覆盖所有重要实体和关系 | 与设备台账/规程目录对比 | ≥ 90% |
| 一致性 | 不同来源的同一事实是否一致 | 自动冲突检测查询 | 冲突率 < 1% |
| 时效性 | 知识是否反映当前状态 | 与最新文档版本对比 | 滞后 < 30天 |
| 可追溯性 | 每个三元组是否有来源标注 | 来源覆盖率检查 | 100% |

### 3.5.2 自动质量检查

利用知识图谱自身的推理能力，可以实现多种自动质量检查：

**类型约束检查**：验证每个实体的属性值是否在定义域范围内。例如：闸门开度不能为负数，水位值应在合理区间。

**拓扑完整性检查**：验证水网拓扑的完整性。例如：每个渠段应有上游连接或是水源点，每个渠段应有下游连接或是终点。

**规则冲突检查**：检测不同条件-动作规则之间的潜在冲突。例如：规则A要求"水位高时开闸"，规则B要求"检修期间闸门不动"——当水位高且处于检修期间时，两规则冲突。

**覆盖度检查**：对照设备台账和规程目录，检查是否有设备或规程条款未被知识图谱覆盖。

### 3.5.3 人工审核机制

自动检查无法覆盖所有质量问题（如语义错误、上下文曲解），因此需要建立人工审核机制：

**分级审核**：
- 安全相关三元组（涉及安全包络、联锁规则）：必须经领域专家逐条审核；
- 参数类三元组（设备参数、数值阈值）：与设备台账逐条核对；
- 一般关系三元组（位置、归属）：可采用抽样审核（抽样率≥10%）。

**持续审核**：知识图谱上线后，调度人员在使用过程中发现的错误应及时反馈并修正。建议在认知AI引擎的用户界面中提供"反馈"按钮，允许用户标记可疑的知识点。

---

## 3.6 水利知识图谱的应用模式

### 3.6.1 模式一：精确知识查询

最基本的应用模式是将知识图谱作为结构化知识库，支持精确查询。

典型场景：
- "3号闸门的设计流量是多少？"→ 直接查询Gate实体的designFlow属性
- "K30-K40渠段之间有哪些闸门？"→ 查询locatedIn关系，筛选桩号范围
- "3号闸门受哪些规程条款约束？"→ 查询governedBy关系

这类查询的特点是答案确定、可精确匹配。知识图谱在此场景中的价值是替代人工翻阅文档，将查询时间从分钟级缩短到秒级。

### 3.6.2 模式二：关联推理与影响分析

更高级的应用是利用知识图谱的图结构进行多跳推理和影响分析。

典型场景：
- "如果3号闸门故障关闭，下游哪些设施会受影响？"→ 沿downstreamOf关系进行多跳遍历，找到所有受影响的渠段和设施
- "当前有哪些检修计划可能与防汛调度冲突？"→ 查询conflictsWith关系
- "某传感器故障后，哪些控制回路失去可观性？"→ 查询monitoredBy反向关系，分析控制回路的传感器依赖

[工程解释] 影响分析在水利工程运行中的价值极高。传统做法是凭经验"想一想"可能受影响的范围，容易遗漏。知识图谱可以系统化、无遗漏地完成影响分析——前提是拓扑关系和依赖关系已完整建模。

### 3.6.3 模式三：知识增强的RAG

知识图谱与RAG系统的结合是水利认知智能的核心架构模式（详见第五章）。

基本思路：当用户提问时，不仅通过向量检索从文档库中找到相关段落，还通过知识图谱补充结构化的上下文信息。例如：

用户问："当前工况下，3号闸门应该怎么操作？"

**纯RAG**：从规程文档中检索包含"3号闸门"和"操作"关键词的段落，可能返回多个不同工况下的操作说明，需要LLM自行判断哪个适用。

**知识增强RAG**：
1. 从知识图谱获取3号闸门的当前状态（正常/故障/检修）；
2. 从知识图谱获取当前工况标签（正常/异常/应急）；
3. 从知识图谱获取适用的规程条款编号；
4. 仅检索对应工况和条款的规程段落；
5. 将知识图谱的结构化信息作为LLM的上下文，生成更精确的建议。

[表3-3: 纯RAG与知识增强RAG的对比]

| 维度 | 纯RAG | 知识增强RAG |
|------|-------|-----------|
| 检索范围 | 全文档库 | 知识图谱引导的精准范围 |
| 上下文质量 | 可能包含不相关段落 | 结构化上下文+相关段落 |
| 回答精度 | 依赖LLM判断能力 | 知识图谱约束+LLM生成 |
| 可追溯性 | 引用文档段落 | 引用文档段落+知识图谱实体 |
| 构建成本 | 低（仅需文档向量化） | 高（需构建知识图谱） |

---

## 3.7 案例：胶东调水工程知识图谱设计

以胶东调水工程为例，展示知识图谱的设计和应用。

### 3.7.1 工程概况与知识范围

胶东调水工程干线全长483km，沿线包含泵站、闸门、渡槽、倒虹吸等各类水工建筑物数百座（参见《水利工程自主运行实践》M8 ch02）。其知识图谱需要覆盖：

- 工程拓扑：干渠分段、节制闸、分水闸、退水闸的位置和连接关系
- 设备台账：所有闸门、泵站、传感器的参数和状态
- 调度规程：正常输水、冰期输水、应急泄水等工况的操作要求
- 历史事件：过去十年的重要调度事件和故障处置记录

### 3.7.2 知识图谱规模估算

| 实体类型 | 估计数量 | 属性数/实体 |
|---------|---------|-----------|
| 渠段 | ~100 | 8-12 |
| 闸门 | ~80 | 10-15 |
| 泵站 | ~15 | 12-18 |
| 传感器 | ~300 | 6-10 |
| 规程条款 | ~500 | 5-8 |
| 历史事件 | ~1000 | 8-12 |
| **合计实体** | **~2000** | |
| **合计三元组（含关系）** | **~30000-50000** | |

**构建周期估算**：基于上述规模，采用"LLM辅助抽取+人工审核"的方式，预计构建周期为：核心本体设计约2周（需领域专家参与），NER/RE模型训练约3-4周（含标注数据准备），知识抽取与入库约4-6周，质量审核约2-3周。总计约3-4个月可完成初始版本。后续的动态维护需安排1-2名专职人员。

[工程解释] 约3-5万三元组的规模对于单个工程项目来说是典型的。这个规模完全在Neo4j社区版的处理能力范围内，甚至可以在内存中完整加载，查询延迟在毫秒级。

### 3.7.3 典型应用场景

**场景一：冰期工况规程查询**

调度员在11月初需要查阅冰期输水的操作要求。通过知识图谱：
1. 查询当前日期对应的工况标签 → "冰期过渡期"
2. 查询该工况下的适用规程条款 → 返回5条相关条款
3. 查询冰期工况下各闸门的限制条件 → 返回受影响的闸门列表及其限制参数
4. 将以上结构化信息传递给RAG系统，生成完整的冰期操作指南

**场景二：设备故障影响分析**

K120处水位传感器WL-045故障：
1. 查询WL-045的监测对象 → 7号闸门
2. 查询7号闸门的控制回路依赖 → HDC控制回路需要该水位信号
3. 查询7号闸门下游的受影响设施 → 8号、9号闸门及东平泵站
4. 查询备用监测方案 → 邻近的WL-044和WL-046可提供替代测量
5. 生成故障影响评估报告和建议处置方案

---

## 本章小结

本章系统论述了水利领域知识图谱的设计、构建和应用方法，主要内容包括：

1. **知识图谱在水利认知智能中的定位**：知识图谱承担结构化知识存储、RAG语义增强和推理与一致性检查三重角色，是认知AI引擎的基础设施层。

2. **水利本体设计**：提出了包含Infrastructure、Equipment、OperationalConcept、Event和Document五大顶层类的水利领域本体结构，定义了核心属性和约束公理。本体设计采用"自顶向下+自底向上"的迭代方法。

3. **知识抽取技术**：从文档预处理、命名实体识别到关系抽取，构建了完整的知识抽取流程。特别讨论了水利领域最重要的"条件-动作规则"的抽取方法，推荐采用"LLM辅助+规则校验"的混合方案。

4. **存储与查询**：对比了主流图数据库方案，推荐Neo4j作为起步选择。通过Cypher查询示例展示了知识图谱的精确查询、关联推理和一致性检查能力。

5. **质量保障**：从准确性、完整性、一致性、时效性和可追溯性五个维度定义了知识图谱质量标准，建立了自动检查+分级人工审核的质量保障流程。

6. **应用模式**：精确知识查询、关联推理与影响分析、知识增强RAG三种应用模式，由简到复杂，逐步发挥知识图谱的价值。其中，知识增强RAG是与第五章衔接的核心桥梁。

---

## 习题

### 基础题

**3-1.** 请列出水利领域本体的五大顶层类，并为每个顶层类给出至少两个子类示例。

**3-2.** 解释知识图谱中"数据属性"和"对象属性"的区别，并各举两个水利领域的示例。

**3-3.** 简述从调度规程文本中抽取知识三元组的总体流程（至少包含5个步骤）。

### 应用题

**3-4.** 给定以下调度规程条款，完成实体识别和三元组抽取：

> "第4.1.3条 应急泄洪工况下，黄河来水量超过300m³/s时，东平泵站应在20分钟内启动3号机组和4号机组，同时关闭分水闸至开度0.5m以下。操作完成后应立即报告省调度中心。"

**3-5.** 设计一个Cypher查询，查找某调水工程中所有"当前处于检修状态且其上游1-3跳范围内有水位告警"的闸门。

### 思考题

**3-6.** 知识图谱的构建需要大量人工标注和审核工作。对于一个拥有2000余份文档的调水工程，你如何估算知识图谱构建的人力投入？如何设计"最小可用知识图谱"的范围，使得投入最小化的同时覆盖最高价值的知识？

---

## 拓展阅读

1. **Hogan, A. et al. (2021).** "Knowledge Graphs." *ACM Computing Surveys*, 54(4), 1-37. — 知识图谱技术的系统综述，覆盖创建、管理、推理和应用。

2. **Noy, N.F. & McGuinness, D.L. (2001).** "Ontology Development 101: A Guide to Creating Your First Ontology." *Stanford Knowledge Systems Laboratory Technical Report*. — 本体开发的经典入门指南。

3. **Ji, S. et al. (2022).** "A Survey on Knowledge Graphs: Representation, Acquisition, and Applications." *IEEE TNNLS*, 33(2), 494-514. — 知识图谱表示学习和应用的前沿综述。

4. **Pan, J.Z. et al. (2024).** "Unifying Large Language Models and Knowledge Graphs: A Roadmap." *IEEE TKDE*. — LLM与知识图谱融合的路线图论文。

5. **Lei, X. et al. (2025b).** "Architecture of Autonomous Intelligent Water Networks." *南水北调与水利科技*, DOI: 10.13476/j.cnki.nsbdqk.2025.0079. — 自主智能水网架构中知识管理层的设计。

---

> **下一章预告**：第四章将深入讨论面向水利领域的大语言模型架构选择、领域适配训练（包括继续预训练和指令微调）和评估方法，回答"如何让通用LLM变成水利领域的专家"这一关键问题。
