# 工作流程参考 (Workflow Reference)

## 1. 总体工作流

```
┌─────────────────────────────────────────────────────────────┐
│                     用户指令入口                              │
│  "开始SCI-P1a" / "开始专利PF2-3" / "做个PPT" / "写篇公众号" / "写个标准" / "继续" │
└─────────────────┬───────────────────────────────────────────┘
                  ↓
┌─────────────────┴───────────────────┐
│          指令解析器                   │
│  识别类型(SCI/CN/PAT/BK/RPT/STD-CN/STD-INT/WX/PPT)  │
│  + 编号 + 当前进度                   │
└─────────────────┬───────────────────┘
                  ↓
┌─────────────────┴───────────────────┐
│          规格加载器                   │
│  读取文档提纲、字数、格式要求         │
│  读取前序版本/章节（如有）            │
└─────────────────┬───────────────────┘
                  ↓
┌─────────────────┴───────────────────┐
│          背景检索                     │
│  web_search: 文献/专利/标准查新      │
│  确认创新性/新颖性                   │
└─────────────────┬───────────────────┘
                  ↓
┌─────────────────┴───────────────────┐
│          写作引擎                     │
│  按文体模板撰写初稿                   │
│  应用术语表 + 符号表                  │
│  应用引用管理规则                     │
└─────────────────┬───────────────────┘
                  ↓
         ┌────────┴────────┐
         ↓                 ↓
┌────────┴──────┐  ┌───────┴───────┐
│ 多角色评审     │  │ 质量检查清单   │
│ (§2按文体配置) │  │ (§7通用清单)   │
└────────┬──────┘  └───────┬───────┘
         └────────┬────────┘
                  ↓
         ┌────────┴────────┐
         │  达标？          │
         │  (§1.2标准)      │
         └───┬─────────┬───┘
           是│         │否
             ↓         ↓
      ┌──────┴──┐  ┌──┴──────────┐
      │保存终稿  │  │逐条修改     │
      │更新进度  │  │生成新版本   │
      │提示继续  │  │回到评审     │
      └─────────┘  └─────────────┘
```

> **WX文体附加步骤**: 在"多角色评审"之前和每轮"修改"之后，必须运行 `scripts/check_article.py`。🔴项必须清零后方可进入达标判定。编辑角色评审以脚本检查报告为基础。

> **STD文体附加步骤**: 初稿完成后须对全文条文用语进行校验——国内标准检查「应/宜/可/不应/不宜」用语一致性，国际标准检查「shall/should/may」用语一致性。规范性引用文件须逐一 web_search 确认现行有效。条文合规率须100%方可进入达标判定。

> **PPT文体附加步骤**: 初稿生成后须用 LibreOffice 转 PDF 进行视觉QA，逐页确认配色/字体/排版与风格指南(`references/ppt_style_guide.md`)一致。设计审查角色以视觉QA结果为基础。

## 2. 各文体评审角色速查

| 文体 | 角色数 | 角色 | 达标条件 |
|------|--------|------|---------|
| SCI | 3 | Reviewer A(理论) + B(方法) + C(工程) | 连续2轮全Minor/Accept |
| CN | 3 | 审稿人A(学科) + B(工程) + C(编辑) | 连续2轮全小修/录用 |
| PAT | 3 | 审查员 + 代理人 + 技术专家 | 加权均分≥7.5 |
| BK | 4 | 教师 + 专家 + 工程师 + 国际读者 | 均分≥8.0且无🔴 |
| RPT | 2 | 技术审查人 + 管理审查人 | 加权均分≥7.0 |
| STD-CN | 3 | 标准化专家(GB/T 1.1) + 技术专家 + 实施方 | 均分≥8.0且合规100% |
| STD-INT | 3 | ISO标准化专家 + 国际水利专家 + 工业界代表 | 均分≥8.0且合规100% |
| WX | 3 | 读者代表 + 编辑 + 领域专家 | 加权均分≥7.5且无🔴+脚本通过 |
| PPT | 3 | 听众代表 + 设计审查 + 内容专家 | 加权均分≥7.5且无🔴+风格合规 |

## 3. 批量写作批次策略

```
Batch 1 (无依赖)
  ├── SCI理论线: P1a, P1b, P1c
  ├── PAT基础族: PF1-1~PF1-6
  └── BK种子层: T1-CN, T1-EN

Batch 2 (依赖Batch 1)
  ├── SCI方法线: P2A~P2E
  ├── PAT控制族: PF2-1~PF2-6
  └── BK骨架层: T2a, T2b

Batch 3 (依赖Batch 1+2)
  ├── SCI实验线+算法线
  ├── PAT安全/MAS/认知族: PF3~PF5
  └── BK血肉层: M1~M8

Batch 4 (依赖全部)
  ├── SCI工程线
  ├── PAT验证/平台族: PF6~PF7
  ├── BK生态层: M9, M10
  └── STD-CN/STD-INT全部
```

## 4. 进度文件示例

```json
{
  "project": "CHS学术产出体系",
  "updated_at": "2026-02-19T12:00:00Z",
  "summary": {
    "total": 77,
    "completed": 0,
    "in_progress": 0,
    "not_started": 77
  },
  "by_type": {
    "SCI": { "total": 21, "completed": 0 },
    "CN": { "total": 4, "completed": 4, "note": "Lei2025a-d已发表" },
    "PAT": { "total": 36, "completed": 0 },
    "BK": { "total": 16, "completed": 0 },
    "RPT": { "total": 0, "completed": 0 },
    "STD-CN": { "total": 0, "completed": 0 },
    "STD-INT": { "total": 0, "completed": 0 },
    "WX": { "total": 0, "completed": 0 },
    "PPT": { "total": 0, "completed": 0 }
  }
}
```
