<!-- 变更日志
v3 2026-02-16: 跨章一致性复检补充——强化与相邻章节接口及出版前核验提示
v2 2026-02-16: 针对上一版深度不足问题进行重写——补充控制对象形式化定义、多时间尺度控制链、可控可观工程判据、异常工况降级机制、案例化算例与章末术语清单
v1 2026-02-16: 初稿
-->

# 第二章 控制论视角下的水系统

---

> **引导案例：一次“看得见风险、来不及控制”的联调失效**
>
> 某北方调水干线在冬末春初切换工况：白天工业取水峰值上升、夜间农业预灌提前启动，上游来水又受融雪径流影响出现日内波动。调度中心实时画面“数据齐全”：水位曲线、闸门开度、泵组频率、报警记录一应俱全；但联调结果仍出现三类问题：
> 1) 上游超前放水后，下游断面滞后超调；
> 2) 为抑制超调而回调闸门，造成中游振荡；
> 3) 为稳水位频繁启停泵组，能耗显著上升。
>
> 复盘发现，问题不在“无人值守”，也不在“设备不够智能”，而在于系统缺乏统一控制语言：监测系统回答“发生了什么”，但控制系统没有稳定回答“为什么会发生、下一步应如何协同动作”。
>
> 本章的任务，就是把水系统从“设备集合”转化为“可分析、可综合、可验证、可治理”的控制对象。

---

## 2.1 从水工系统到控制对象：为什么现在必须重构认知

过去几十年，水利工程的主线是“建设优先、运行补齐”：先解决有没有，再解决好不好。随着系统规模和运行复杂度同步上升，这一路径出现明显瓶颈：

- **目标多元化**：供水、防洪、发电、生态目标并存，且常常冲突；
- **运行高频化**：由“班次调度”转向“分钟级滚动调度”；
- **风险耦合化**：极端天气、设备老化与人为误操作叠加；
- **责任显性化**：监管要求从“结果合规”走向“过程可审计”。

因此，水系统运行方法必须从经验驱动走向“模型—数据—规则”协同驱动。控制论并不是给水利“加一个算法层”，而是提供一整套运行组织方法：

1. 把复杂对象统一抽象；
2. 把不确定过程纳入闭环；
3. 把安全边界内嵌到控制决策。

## 2.2 水系统控制对象的形式化描述

### 2.2.1 状态—输入—输出—扰动四元组

将水网表示为离散时间系统：

\[
x_{k+1}=f(x_k,u_k,d_k,\theta_k),\quad y_k=g(x_k,u_k)+v_k
\]

其中：
- \(x_k\)：系统状态（库容、断面水位、流量、设备运行状态）；
- \(u_k\)：控制输入（闸门开度、泵频、阀位、调度指令）；
- \(d_k\)：外部扰动（降雨、来水、需求波动、突发事件）；
- \(\theta_k\)：慢变参数（糙率、设备效率、结构退化）；
- \(y_k\)：可测输出；\(v_k\)为测量噪声。

该表达的意义在于：**把“运行经验”映射为“可计算结构”**。经验不被否定，而是被形式化并进入可验证流程。

### 2.2.2 三类约束：物理约束、操作约束、治理约束

- **物理约束**：水位上下限、流速边界、库容边界、爬坡率限制；
- **操作约束**：最小启停间隔、开关次数限制、检修窗口；
- **治理约束**：生态下泄红线、供水服务协议、调度权限边界。

在工程实践中，前两类常被纳入优化器，第三类常停留在制度文本。CHS强调三类约束同构建模，避免“算法最优但制度不可执行”。

### 2.2.3 运行设计域（ODD）在水系统中的定义

参照第1章分级框架，水系统ODD可定义为五元组：

\[
\text{ODD}=\{\mathcal{H},\mathcal{I},\mathcal{E},\mathcal{R},\mathcal{C}\}
\]

- \(\mathcal{H}\)：水文气象范围（降雨、来水、气温区间）；
- \(\mathcal{I}\)：基础设施可用性（设备健康度、通信可达率）；
- \(\mathcal{E}\)：外部需求环境（城乡供水需求、负荷水平）；
- \(\mathcal{R}\)：风险边界（允许风险等级与应急响应等级）；
- \(\mathcal{C}\)：控制能力边界（可用模型、算力、人工值守等级）。

ODD不是“附件说明”，而是自主运行责任边界。超出ODD，系统必须降级或请求人工接管。

## 2.3 水系统的五个控制本质

### 2.3.1 大时滞：决策有效性与响应可见性不同步

在长距离明渠中，“动作已执行”不等于“效果已显现”。若忽略时滞，调度员容易形成“二次补偿过度”，引发振荡。工程策略包括：预测补偿、时滞辨识、分段前馈。

### 2.3.2 强耦合：局部最优常导致全局次优

闸门、泵站、阀组共同构成MIMO系统。一个节点的“稳定”可能转化为下游的不稳定。需要通过协调层优化处理跨节点耦合。

### 2.3.3 强约束：安全包络优先于性能最优

水系统控制第一目标是“不越界”，第二目标才是“更优”。因此，控制器必须显式处理安全包络（红/黄/绿三区），而不是事后报警。

### 2.3.4 强不确定：稳健性优先于单场景极值

来水、需求、设备可用性都在波动。控制性能评价应强调跨场景稳定达标，而非单次指标“最好看”。

### 2.3.5 人机共治：技术正确不等于治理有效

系统必须能够解释“为何建议此动作、风险在哪里、何时应接管”。这决定了CHS不仅是控制理论问题，也是运行治理问题。

## 2.4 经典控制框架在水系统中的工程映射

### 2.4.1 开环、闭环与监督闭环

- **开环**：适用于低波动、低风险、重复任务；
- **闭环**：应对一般扰动，保证跟踪与稳定；
- **监督闭环**：在闭环之外加入安全监视器与接管逻辑，保障可解释与可审计。

水系统的现实路径不是“开环→闭环”的一次升级，而是“闭环+监督”的体系化升级。

### 2.4.2 前馈—反馈—约束协同

前馈解决“提前量”，反馈解决“偏差纠正”，约束处理“不可逾越边界”。三者缺一不可：

- 仅反馈：被时滞拖累；
- 仅前馈：受预测误差放大；
- 无约束：性能看似好，安全不可托底。

### 2.4.3 多时间尺度分层控制链

可建立“四层控制链”：

1. **执行层（秒级）**：设备闭环、保护联锁；
2. **调节层（分钟级）**：局部断面稳定、局部约束管理；
3. **协调层（小时级）**：跨区流量分配、多目标平衡；
4. **规划层（日周级）**：水资源配置、检修与策略更新。

分层的核心价值是“把问题放到合适时间尺度求解”，避免一个控制器承载所有目标。

## 2.5 可控可观性的工程判据（面向实施）

理论上的可控可观，在工程里必须转化为“可布设、可维护、可负担”的方案。可采用三步判据：

### 2.5.1 可观性最低配置判据

关键断面与关键状态至少具备“双通道观测”之一：
- 直接测量（在线水位/流量/压力）；
- 模型估计（状态估计器）并有周期性校验。

若关键状态既不可测又不可估，系统不得进入高等级自主运行。

### 2.5.2 可控性有效作用判据

每个关键控制目标必须对应至少一个“有效执行器路径”，且执行器动作在可接受时延内可传导至关键状态。若控制路径存在单点失效，应配备冗余或降级策略。

### 2.5.3 可验证性闭环判据

任何控制策略上线前，至少完成：
- 模型在环（MIL）：逻辑正确性；
- 软件在环（SIL）：实现一致性；
- 硬件在环（HIL）：时序与接口可靠性。

该判据直接对接第三章原理五“在环验证”。

## 2.6 控制方法族：选型原则与边界

### 2.6.1 PID：执行层“稳态器”而非全局“总调度器”

PID对局部对象、单回路稳态控制仍有效，但不宜承担跨区域多目标调度。

### 2.6.2 状态空间与LQR/LQG：结构清晰、可解释性较好

适合中等规模耦合系统，可用于形成“控制器基线版本”，为后续高级策略提供对照。

### 2.6.3 MPC：多约束、多目标、多变量任务的主力工具

MPC适合调水干线、梯级水库协同等任务，优势在于显式约束处理与滚动优化。

### 2.6.4 数据驱动策略：用于补偿，不宜替代安全主回路

数据模型可用于预报、偏差修正、软测量；在高风险任务中，应采用“机理保底+数据增强”结构。

### 2.6.5 何时不应用复杂算法

满足以下条件时，优先采用简化方案：
- 目标单一且工况稳定；
- 运维队伍能力不足以长期维护复杂模型；
- 算法收益不足以覆盖维护成本与风险暴露。

工程最优不是“算法最先进”，而是“全寿命周期综合最优”。

## 2.7 异常工况与降级运行：从“自动化”走向“可信自主”

建议采用四态机：正常态→受限态→降级态→接管态。

- **正常态**：在ODD内运行，按最优策略滚动控制；
- **受限态**：预测可信度下降或通信质量变差，收缩可操作域；
- **降级态**：触发黄区/红区边界，转入保守策略（固定流量带、保底水位带）；
- **接管态**：人工接管关键动作，系统保留监测、告警和建议功能。

关键不在“能否降级”，而在“何时降级、谁批准、如何记录”。每次状态迁移都应自动产生日志，用于监管审计与责任复盘。

## 2.8 小型算例：单干线双断面协同控制的三种策略对比

设某干线有上游闸门 \(G_1\) 与中游泵站 \(P_1\)，控制目标：
1) 下游断面水位跟踪误差最小；
2) 不越安全包络；
3) 能耗最小。

### 策略A：纯反馈（局部PID）
- 优点：部署快；
- 问题：时滞条件下易振荡，且能耗偏高。

### 策略B：前馈+反馈
- 优点：能提前响应来水变化；
- 问题：预测偏差大时仍可能出现短时越界。

### 策略C：约束MPC+安全监视器
- 优点：在多目标和硬约束下综合表现最好；
- 代价：模型维护和计算资源要求更高。

工程结论：若任务风险等级高，应优先选择“约束MPC+安全监视器”；若任务简单稳定，可采用“前馈+反馈”并保留人工接管能力。

## 2.9 控制绩效评价体系：从“精度”扩展到“治理”

| 维度 | 关键指标 | 解释 |
|---|---|---|
| 安全 | 越界次数、最小安全裕度、红区停留时长 | 是否守住底线 |
| 稳定 | 超调量、恢复时间、振荡次数 | 是否稳态可控 |
| 经济 | 单位输水能耗、启停频次、维护工时 | 是否可持续运行 |
| 服务 | 供水达标率、生态下泄达标率 | 是否满足公共目标 |
| 治理 | 告警有效率、接管响应时长、审计完整性 | 是否可监管可追责 |

该体系应与WNAL等级绑定，形成“等级—能力—指标—责任”闭环。

## 2.10 本章小结与第三章衔接

本章完成了三件事：

1. 把水系统形式化为可计算控制对象，明确ODD与三类约束；
2. 给出多时间尺度分层控制链，澄清方法选型边界；
3. 建立异常工况四态机与多维绩效评价框架。

与第三章八原理的对应关系如下：

- 2.2 对应原理一“传递函数化”与原理二“可控可观性”；
- 2.4 与 2.7 对应原理三“分层分布式”与原理四“安全包络”；
- 2.5 对应原理五“在环验证”；
- 2.6 与 2.9 对应原理六“认知增强”、原理七“人机共融”与原理八“自主演进”。

下一章将逐条展开八原理，给出从理论主张到工程规则的可复用模板。

## 本章术语清单（与全书统一）

- WNAL：水网自主等级（L0-L5）
- ODD：运行设计域（Operational Design Domain）
- 安全包络：红/黄/绿三区的运行边界
- MIL/SIL/HIL：模型在环/软件在环/硬件在环验证链
- 物理AI：机理模型主导的智能控制能力
- 认知AI：语义理解、推理与解释能力


## 2.11 跨章一致性复检补充（v3）

为严格对齐全书主控规范，本章补充以下一致性声明：

- 术语统一：WNAL、运行设计域（ODD）、安全包络、MIL/SIL/HIL与第1、3、4章保持一致；
- 架构接口：本章“分层控制+四态机+多指标评价”作为第5章HydroOS运行时机制的输入约束；
- 升级逻辑：本章提出的可控可观与约束处理要求，是第4章WNAL等级跃迁的前置条件。

**出版前核验提示**：本章涉及的图2-1与跨章符号引用，在统一出图阶段按总图库编号复核。
