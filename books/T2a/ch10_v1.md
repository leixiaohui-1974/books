<!-- 变更日志
v1 2026-02-16: 初稿
-->

# 第十章 安全约束与安全包络

---

## 学习目标

完成本章后，你应能够：

1. 理解安全包络（Safety Envelope）在水系统控制中的作用；
2. 构建红/黄/绿三区间分级约束与联锁逻辑；
3. 解释运行设计域（Operational Design Domain, ODD）与安全包络关系；
4. 设计越界处置策略与最小风险状态转换路径；
5. 将安全约束与控制器、在环测试、运行审计形成闭环。

> **章首衔接（承接ch09）**  
> 上一章回答了“能否控、能否观”的结构门槛。本章进一步回答“怎么保安全”：即使可控可观，也必须在可验证边界内运行。

## 10.1 安全包络的概念与必要性

[物理直觉] 水系统不是“越快越好”，而是“在安全边界内稳定运行”。安全包络用于定义允许运行状态集合，超出边界即触发联锁或降级。

[公式]
\[
\mathcal{X}_{safe}\subseteq\mathcal{X}_{ODD}
\]

[工程解释] ODD 描述已验证可运行范围，\(\mathcal{X}_{safe}\) 描述其中更严格的安全运行子集。控制策略必须优先满足 \(\mathcal{X}_{safe}\) 约束。

## 10.2 红/黄/绿三区间建模

### 10.2.1 区间定义

- 绿色区：正常运行区，可执行优化控制；
- 黄色区：预警区，需收缩控制动作并准备降级；
- 红色区：禁运行区，触发联锁与人工接管。

[表10-1: 三色分区与控制动作映射]
| 区域 | 状态特征 | 控制策略 |
|---|---|---|
| 绿色 | 远离边界 | 常规优化控制 |
| 黄色 | 接近边界 | 约束收缩+保守控制 |
| 红色 | 越界/高风险 | 联锁停机或人工接管 |

### 10.2.2 联锁触发顺序

建议固定触发链：
1. 收缩可行域；
2. 切换保守控制器；
3. 进入最小风险状态；
4. 人工接管与审计记录。

## 10.3 安全约束形式化表达

[公式]
\[
\mathbf{x}_k\in\mathcal{X}_{safe},\quad
\mathbf{u}_k\in\mathcal{U}_{safe},\quad
\Delta\mathbf{u}_k\in\Delta\mathcal{U}_{safe}
\]

可进一步定义安全裕度函数：
\[
\sigma(\mathbf{x})=\min_i\;d_i(\mathbf{x},\partial\mathcal{X}_{safe})
\]

[工程解释] \(\sigma(\mathbf{x})\) 表示到最近安全边界的距离，适合用于在线监视与预警分级。

## 10.4 ODD定义与最小风险状态

ODD应覆盖可测边界、控制能力边界和外部环境边界。越界时需转入最小风险状态（Minimum Risk State, MRS），例如“维持最低供水+限制动作频率+等待人工确认”。

[图10-1: ODD边界与安全包络关系图]
{描述: 外层为ODD，内层为Safety Envelope，标注绿色/黄色/红色分区及越界迁移路径。}
{尺寸: 全页}
{颜色方案: 蓝色系}
{对应ARCH编号: ARCH-07}

## 10.5 安全联锁与在环验证

安全联锁必须通过在环测试验证：

1. 触发条件是否可重复；
2. 联锁动作是否在时限内执行；
3. 解除联锁是否满足复位条件；
4. 审计日志是否完整可追溯。

[图10-2: 安全联锁在环验证流程]
{描述: 包含“故障注入→阈值触发→联锁执行→恢复判定→审计归档”五阶段流程。}
{尺寸: 半页}
{颜色方案: 蓝色系}
{对应ARCH编号: ARCH-06（流程思想借鉴）}

## 10.6 例题：超上限水位的联锁处置设计

【例10-1】某关键断面水位进入黄色区并快速逼近红色阈值。请设计联锁处置流程。

**已知**：
- 上游来水突增；
- 执行器存在速率约束；
- 当前处于自主运行模式。

**解题过程**：

步骤1：立即收缩控制约束并提高安全权重。  
步骤2：若预测跨入红区，切换保守控制并执行限幅动作。  
步骤3：触发MRS，保持关键供水并限制大幅动作。  
步骤4：若持续越界，人工接管并记录处置链条。

**结果讨论**：

联锁流程应“可触发、可执行、可复位、可审计”，避免仅有阈值而无完整处置机制。

### 安全包络上线检查清单

- [ ] 是否完成红/黄/绿阈值校核与版本归档；
- [ ] 是否定义固定联锁触发顺序；
- [ ] 是否验证MRS可执行且可维持；
- [ ] 是否通过在环测试覆盖关键故障场景；
- [ ] 是否建立审计追踪字段与复盘机制。

## 10.7 本章小结

本章建立了水系统安全治理主线：以 Safety Envelope 为核心，以ODD为外层边界，以联锁与MRS保证越界可控。核心结论是：安全约束不是控制器附加项，而是系统级一等公民。下一章将进入状态估计与数据融合，为安全运行提供可信状态输入。

## 习题

### 基础题

1. 解释 ODD 与 Safety Envelope 的关系。  
2. 红/黄/绿三区间分别对应何种控制策略？  
3. 为什么最小风险状态必须预先定义？

### 应用题

4. 为某泵站系统设计一套三色阈值与联锁触发规则。  
5. 给出一个在环测试方案，用于验证安全联锁时效性与可复位性。

### 思考题

6. 当“供水连续性”与“安全边界严格性”冲突时，应如何设定优先级？

## 拓展阅读

1. IEC 61508 Functional Safety standards.  
2. Leveson, N. *Engineering a Safer World*.  
3. Rawlings, J.B. et al. *Model Predictive Control*.  
4. 钱学森. 《工程控制论》.  
5. Lei et al. (2025c). 在环测试系统。
