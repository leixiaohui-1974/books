<!-- 变更日志
v5.1 2026-02-20: 引导案例去指向性(虚构复合场景)+图编号修正(图3-2/3-3交换对齐出现顺序)+全章节间过渡句(9处)+6原理概念引入三步法直觉类比(P1三专业语言/P3城市治理/P4转速表/P5新药临床/P7手术机器人/P8调度员晋升)+图片提示词同步更新
v5 2026-02-20: 依据最新CHS写作skill四角色评审修订——补强原理六/七/八工程深度，新增5条参考文献达22条，修复格式缺陷，所有表格统一编号，补充概念引入三步法范例
v4 2026-02-20: 按照ch01标准全面重写——扩充至2万字，逐原理深度展开含工程案例、公式、对比表、参考文献；新增6幅图位及对应提示词
v3 2026-02-16: 跨章一致性复检补充
v2 2026-02-16: 根据四角色评审修订
v1 2026-02-16: 初稿
-->

# 第三章 水系统控制论八原理

---

> **引导案例（虚构复合场景）**
>
> 假设有这样一条长距离调水渠道：全线设有数十座闸门和若干座加压泵站，管理单位决定启动一次全面的"智能化升级"。升级方案由三个独立团队分头实施——控制团队为各闸门加装了自整定PID控制器，AI团队为泵站部署了基于深度学习的能耗优化模型，气象团队在调度中心上线了一套短临暴雨预报系统。单看每个子系统的验收报告，指标都令人满意——闸门水位控制精度从±20 cm提高到±8 cm，泵站综合能耗下降了11%，暴雨预报的6小时命中率达到了83%。然而，汛期的第一场区间暴雨便暴露了系统级的失败：上游闸门群按各自的PID参数"精确"动作，结果产生的水波在中游渠段叠加振荡，使某控制断面水位在40分钟内上下波动达60 cm；泵站能耗优化模型因训练数据中不含暴雨工况，在来水突增时反而延迟了泵站启动；预报系统准确地预测了降雨，但预测结果停留在气象语言中——"未来6小时累计降雨量40-60 mm"——调度员无法将其直接转化为闸门和泵站的具体操控指令。最终，值班调度员不得不切换回全手动模式，在暴雨中用电话逐一指挥现场。
>
> 这个场景并非凭空杜撰，而是笔者从国内外多个实际工程的运行教训中提炼的复合案例。复盘这类失败，根因不是任何一个子系统的技术缺陷，而是缺乏一个统一的方法论框架——一个能够回答"系统应该如何被描述、如何被组织、如何被验证、如何与人协同"的完整理论基座。水系统控制论（CHS）提出的八个基本原理，正是为解决这种"单点智能、系统失灵"的困局而建立的。

**本章目标**：帮助读者理解CHS八原理的完整内涵、层次关系和工程操作含义。每个原理都不仅停留在概念层面，而是给出"核心命题—理论依据—工程判据—典型案例—常见误区"的完整论述。读完本章，读者应能回答三个问题：八原理之间是什么关系？每个原理在工程中到底要求做什么？如果只能做三件事，应该先做哪三件？

---

## 3.1 八原理的体系定位与层次关系

### 3.1.1 为什么需要"原理"而不是"技术清单"

在水利工程智能化的实践中，一个反复出现的问题是：项目团队往往直接跳到"用什么技术"——MPC还是PID？数字孪生还是SCADA升级？大模型还是专家系统？——而跳过了更根本的问题：系统应该遵循哪些不可违反的设计准则？

技术是手段，原理是约束。技术会随时代迭代——今天的MPC可能被明天更好的算法替代——但原理具有跨技术的持久性。正如结构工程中的"承载力极限状态"原理不会因为混凝土配方的变化而失效，CHS的八原理也不会因为具体控制算法的更新换代而过时。它们定义的是水系统自主运行必须满足的一组不变量（invariants），而非某种具体的技术实现方案。

这一理念并非CHS独创。在航空航天领域，美国联邦航空局（FAA）通过DO-178C标准 [3-1] 定义了机载软件开发的安全原则，这些原则在数十年间保持稳定，即使软件开发技术本身发生了翻天覆地的变化。在自动驾驶领域，ISO 21448（SOTIF，Safety of the Intended Functionality）[3-2] 也是先定义安全原则，再让具体的感知和决策技术在原则框架内演进。CHS的八原理遵循同样的逻辑：先确立水系统自主运行的"宪法"，再允许具体技术在"宪法"框架内自由创新。

### 3.1.2 八原理的层次结构

八个原理并非平行的八条规则，而是构成一个有层次、有依赖的体系（见图3-1）：

[图3-1: CHS八原理依赖导图]

**第一层：建模基础层（原理一、原理二）。** 任何控制系统的前提是对被控对象有足够的理解和描述能力。原理一（传递函数化）解决"如何用统一语言描述水系统"的问题；原理二（可控可观性）解决"在给定的传感器和执行器配置下，系统是否能被有效感知和操控"的问题。没有这两个原理作为地基，后续所有原理都失去了根基。

**第二层：架构组织层（原理三、原理四）。** 当系统的模型和可控可观性得到保证后，接下来的问题是"如何组织"。原理三（分层分布式）定义了大系统的组织架构——谁负责什么、如何协调；原理四（安全包络）定义了系统运行的安全边界——无论系统如何决策，都不能突破这些边界。这两个原理共同回答"怎么组织、边界在哪"。

**第三层：验证保障层（原理五）。** 原理五（在环验证）是从"设计"到"上线"的必经桥梁。一个控制策略无论在理论上多么完美，如果未经过模型在环（MIL）、软件在环（SIL）和硬件在环（HIL）的系统性验证，就不能部署到真实工程中。原理五实质上是一道"质量门禁"（quality gate）。

**第四层：协同智能层（原理六、原理七）。** 原理六（认知增强）为系统注入理解、推理和解释能力，使系统不仅能"算"，还能"懂"；原理七（人机共融）定义了人与机器在不同自主等级下的职责分配和接管机制。这两个原理使系统从"能控制"升级到"会思考、会协作"。

**第五层：演进能力层（原理八）。** 原理八（自主演进）确保系统能够从运行经验中持续学习和进步。但演进不是无约束的——原理四（安全包络）对原理八形成约束回边，确保"越学越好"而非"越学越偏"。

这五个层次之间是严格的依赖关系：上层原理依赖下层原理的保障，缺少任何一层都会导致系统性风险。以引导案例中的场景为例：那条渠道在原理六层面做了很好的工作（预报模型的认知能力），但在原理一层面（统一系统描述）和原理三层面（分层协调）存在致命缺陷，导致上层智能无法发挥实际作用。

表3-1 八原理五层依赖关系与缺失后果

| 层次 | 包含原理 | 核心问题 | 缺失后果 |
|------|---------|---------|---------|
| 建模基础层 | 原理一、二 | 对象如何被准确描述与可操作？ | 控制策略失去物理基础 |
| 架构组织层 | 原理三、四 | 系统如何组织并守住安全边界？ | 局部优秀、全局失稳 |
| 验证保障层 | 原理五 | 策略如何在上线前被证明可信？ | 仿真可行≠工程可行 |
| 协同智能层 | 原理六、七 | 系统如何获得认知能力并与人协同？ | 有数据无洞察，有能力无协作 |
| 演进能力层 | 原理八 | 系统如何在受控条件下持续进化？ | 系统能力停滞不前 |

### 3.1.3 八原理与工程实践的映射

八原理不是抽象的学术概念，每个原理都对应具体的工程行动。在后续各节中，每个原理都将给出"最小工程要求"——即在该原理框架下，一个水利工程至少应该做到什么。这些要求构成了第四章WNAL等级跃迁的技术基础：要从L1升级到L2，必须满足原理一至原理三的最小要求；要达到L3，必须满足原理一至原理五的全部要求；L4和L5则需要八原理的完整实施。

下面从建模基础层的第一个原理——传递函数化——开始逐一展开。

---

## 3.2 原理一：传递函数化——建立统一的系统语言

### 3.2.1 核心命题

**将复杂水系统的动态行为转化为数学上可分析、可综合的输入—输出映射，使不同层级、不同专业的工程人员能够在同一数学语言中协同工作。**

先打一个比方：假设一个工程团队中有水力学家、水文学家和自动化工程师三个人，他们需要合作设计一条渠道的自动控制系统。水力学家说"这段渠道的Froude数是0.3"，水文学家说"24小时内将有一场峰值120 m³/s的洪水过程"，自动化工程师说"这个PID控制器的比例增益是2.5"——三个人各说各的语言，却无法回答一个最基本的系统级问题："如果我现在把上游闸门开大10%，下游水位会在什么时候、以什么方式变化多少？"传递函数化的目的，正是为这三个专业提供一种共同的数学语言，使这个问题有一个所有人都能理解和使用的标准答案。

在传统水利工程中，不同专业之间缺乏统一的系统描述语言。水力学工程师用Saint-Venant方程描述渠道流态，水文学家用单位线或汇流模型描述来水过程，自动化工程师用PID参数描述闸门控制器。这些描述方式各自成体系，但难以在同一框架内进行系统级分析和综合设计。正如Åström和Murray [3-21] 在经典教材中所强调的，反馈系统的核心价值在于提供一种统一的建模与分析语言——传递函数正是这种语言在水利领域的具体表达。

传递函数化的核心思想是：无论水系统的内部动力学多么复杂，都可以在一定的工况条件下，建立从"输入"（闸门开度变化、泵站启停、来水扰动等）到"输出"（关键断面水位、流量、水质指标等）的动态映射模型，并将这些模型表达为控制理论可以直接使用的标准形式——传递函数、状态空间模型或其他适当的数学表示。

### 3.2.2 理论依据

传递函数化的理论根基是经典控制理论中的系统辨识和模型降阶方法。对于水利系统而言，核心的物理方程是Saint-Venant方程组——由连续性方程和动量方程组成的一阶双曲型偏微分方程组：

$$
\frac{\partial A}{\partial t} + \frac{\partial Q}{\partial x} = q_l
$$

$$
\frac{\partial Q}{\partial t} + \frac{\partial}{\partial x}\left(\frac{Q^2}{A}\right) + gA\frac{\partial h}{\partial x} + gAS_f = 0
$$

其中 $A$ 为过水断面面积，$Q$ 为流量，$h$ 为水位，$q_l$ 为侧向入流，$S_f$ 为摩阻坡降。

对于控制设计而言，直接使用这一分布参数模型既不必要也不实际。Litrico和Fromion [3-3] 的开创性工作证明，在恒定流附近的小扰动条件下，明渠渠池可以用有理传递函数来精确描述其输入—输出动态特性。特别是，他们提出的积分延迟零（Integrator Delay Zero, IDZ）模型为明渠控制设计提供了一个精简而有效的数学框架：

$$
G(s) = e^{-\tau_d s} \cdot \frac{1 + \alpha s}{s(1 + \beta s)}
$$

其中 $\tau_d$ 是主导延迟时间（对应水波从上游传播到下游的时间），$\alpha$ 和 $\beta$ 是与渠道几何和水力特性相关的参数。Schuurmans等 [3-4] 和Van Overloop [3-5] 进一步将这些传递函数模型用于MPC控制器的设计，取得了良好的效果。

对于非线性程度较强的系统（如水库—水电站系统），传递函数化可以通过分段线性化或非线性模型降阶方法实现。关键不在于模型的具体形式，而在于建立一个"可计算、可综合"的系统描述。

### 3.2.3 工程判据

在具体工程中，传递函数化原理要求做到以下几点：

**对明渠渠系**：建立从每个控制节点（闸门或泵站）到下游关键监测断面的动态响应模型。模型至少应能捕捉三个基本特征——传播时滞、稳态增益和主导动态模态（振荡频率和衰减率）。模型参数应能在不同工况（枯水期、丰水期、过渡期）下自适应更新。

**对梯级水库/水电站**：建立上游调度动作（如开度变化、出力变化）到下游关键约束指标（水位、流量、生态流量）的传播映射。由于水库系统的非线性和多时间尺度特性更为突出，通常需要在不同运行工况下分别建立线性化模型，或者采用非线性模型预测控制（NMPC）等方法直接处理非线性。

**对城市供排水管网**：建立从加压泵站或调蓄设施到末端用户节点的压力—流量响应模型。管网模型的特殊挑战在于拓扑复杂度高和用水量的随机波动性强。

**最小工程要求**：
1. 建立关键控制对象的统一模型台账，每个模型标明适用工况范围和参数更新周期；
2. 模型精度在设计工况下满足阶跃响应误差 ≤ 5%、稳态增益误差 ≤ 3%；
3. 在模型适用域（ODD）之外的工况，模型标明"不可信"并触发降级机制。

### 3.2.4 典型案例

以胶东调水工程为例 [3-6]。该工程干线全长约500千米，包含多级泵站和明渠交替的复杂拓扑。Kong等在对该工程的研究中，针对梯级泵站—明渠系统建立了基于IDZ的传递函数模型矩阵，将每个渠池的水力动态简化为"延迟+积分+一阶惯性"的标准形式。在此基础上，设计了基于模型预测控制的水位差控制方法，成功实现了多级泵站的协调自动控制。模型精度在正常运行工况下保持在±3 cm以内，为后续提升WNAL等级奠定了建模基础。

另一个值得关注的案例是荷兰Maeslantkering风暴潮防护闸的控制系统设计 [3-7]。该系统必须在极端风暴潮事件中可靠运行，因此其传递函数模型的建立过程特别强调了模型在极端工况下的适用性验证——不仅要在正常工况下精确，还要在超设计工况下"正确地保守"（fail-safe）。

### 3.2.5 常见误区

**误区一：传递函数化等于"必须线性化"。** 传递函数化的核心是建立可计算的输入—输出映射，不一定要求线性化。对于强非线性系统，可以使用非线性模型降阶、分段线性化、或基于物理信息的神经网络（PINN）等方法，只要最终模型能够用于控制设计和安全分析即可。

**误区二：追求模型精度的极致而忽视模型的工程可用性。** 一个拟合精度达到99%但参数物理含义不明、更新维护困难的"黑箱"模型，往往不如一个精度95%但参数可解释、可更新的"灰箱"模型更有工程价值。传递函数化强调的是"可分析、可综合、可维护"，不是"最高精度"。

**误区三：一次建模，永久使用。** 水利系统的物理参数会随时间变化——渠道糙率因淤积和植被生长而改变，泵站效率因磨损而下降，管网因腐蚀和结垢而阻力增大。传递函数化不是一次性工作，而是需要建立参数在线辨识或定期校核的持续机制。已有研究表明，单个灌溉季节内Manning糙率系数的变化幅度可达15%—30%，足以使基于固定参数模型的控制策略失效 [3-3]。

有了传递函数这套"统一语言"，紧接而来的问题是：系统的关键状态能否被感知、关键目标能否被调控？这正是建模基础层的第二个原理——可控可观性——要回答的问题。

---

## 3.3 原理二：可控可观性——可调可见才可管

### 3.3.1 核心命题

**在给定的传感器和执行器配置下，系统的关键状态必须可观测（或可估计），关键目标必须可控。若这两个前提不满足，任何高级控制算法都只是"技术幻觉"。**

先用一个直觉来理解这个原理：想象你蒙着眼睛开车——这就是"不可观"的状态，无论你驾驶技术多好，结果都是灾难。再想象你能看清路况，但方向盘脱落了——这就是"不可控"的状态，看得见也没用。可控可观性原理的工程含义是：在设计任何控制系统之前，先确认"眼睛"（传感器）和"手脚"（执行器）的配置是否足以完成控制任务。一个最简单的例子：如果一段30千米的渠道只在首末两端各有一个水位传感器，那么渠道中部的水位就是"不可直接观"的——不一定需要在中部加装传感器（也许可以用模型估计），但这个问题必须在设计阶段给出明确答案。

可控性（Controllability）和可观性（Observability）是经典控制理论中最基本的概念，由Kalman在1960年的奠基性论文中严格定义 [3-8]。对于线性时不变系统 $\dot{x} = Ax + Bu$，$y = Cx$，系统完全可控的充要条件是可控性矩阵 $[B, AB, A^2B, \ldots, A^{n-1}B]$ 满秩；完全可观的充要条件是可观性矩阵 $[C^T, A^TC^T, \ldots, (A^T)^{n-1}C^T]$ 满秩。Åström和Murray [3-21] 在反馈系统教材中将可控可观性称为"控制系统的两大先决条件"——缺一不可。

但在水利工程的实际语境中，可控可观性不仅是一个数学判据，更是一个工程决策问题：传感器装在哪里、装多少个？闸门和泵站够不够用、布局合不合理？这些问题直接决定了系统能否被有效感知和操控。

### 3.3.2 工程判据

将抽象的可控可观性概念转化为工程判据，需要回答三个具体问题：

**问题一：关键状态是否至少可测或可估？** 水利系统中并非所有状态都能直接测量。例如，渠道内部的流速分布通常无法直接测量，但可以通过已知的水位测量值加上水力模型推算得到。状态估计器（如Kalman滤波器或移动视界估计器）在此发挥关键作用。工程判据是：对于每个关键约束指标（如某断面水位），必须能够通过直接测量或间接估计获得其实时值，且估计误差在控制可接受范围内。

**问题二：关键目标是否至少存在一条可执行的控制路径？** 即使系统可观，如果执行器（闸门、泵站、阀门）的布置不当，某些控制目标可能无法实现。例如，一段100千米的输水渠道中间没有任何闸门，那么这段渠道内的水位就只能通过上游或下游的闸门间接调节，调节能力受到传播时滞和衰减的严重限制。

**问题三：控制作用的时延是否不超过任务容忍边界？** 可控性不仅是"能不能控"，还包括"能不能及时控"。水利系统特有的长延迟特性使得这个问题尤为关键。以南水北调中线为例，从陶岔渠首到北京团城湖的水力传播时间约15天 [3-9]，这意味着如果下游出现突发需水，上游至少需要提前15天做出响应。如果所需的响应时间小于系统的固有传播延迟，那么仅靠上游控制就无法满足需求——必须在中间增设调蓄设施或应急水源，以缩短有效控制时延。

### 3.3.3 可控可观性分析的工程流程

基于上述三个问题，可以建立一套系统化的工程流程：

**第一步：列出关键约束清单。** 确定系统运行中不可违反的约束指标，如关键断面的最高/最低水位、最小生态流量、泵站的最大启停频率等。

**第二步：可观性核验。** 对每个关键约束指标，验证是否有对应的直接测量点或可靠的状态估计路径。如果存在"盲区"——某个关键状态既无法直接测量也无法可靠估计——则需要补装传感器或改进估计算法。

**第三步：可控性核验。** 对每个关键控制目标，验证是否存在至少一条从执行器到目标的有效控制路径，且控制时延在任务容忍范围内。如果发现"死区"——某个控制目标无法在要求的时间内被有效调节——则需要增设执行器、调蓄设施或调整控制架构。

**第四步：冗余性评估。** 评估关键测量和关键控制路径是否有冗余备份。在水利这种攸关公共安全的领域，单点故障不可接受。

### 3.3.4 设计启示

可控可观性分析应前置于设备投资决策。传统做法常常是先确定设备选型（"需要几台泵"、"装什么传感器"），再考虑控制方案。CHS的思路恰恰相反：先做可控可观性分析——确定"该在哪里装"、"需要几个点"——再做设备选型。这种"先算再买"的策略能够显著避免两类浪费：一是传感器装了但对控制没有贡献（可观但不必要），二是关键位置缺少传感器导致系统存在不可观"盲区"。

Cantoni等 [3-10] 在其关于大规模灌溉网络控制的综述中指出，对于大型渠系，传感器和执行器的优化布置（optimal sensor/actuator placement）是一个重要的工程优化问题，其解直接影响系统的可控可观性。Lei等 [3-11] 在水系统控制论的理论框架中进一步强调，可控可观性分析应与运行设计域（ODD）的定义结合——在不同ODD条件下，系统的可控可观性可能发生质的变化。

建模基础层的两个原理解决了"系统怎么描述"和"系统能不能被感知和操控"的问题。接下来进入架构组织层——当系统规模大到一定程度时，如何组织这些模型和控制器，使它们能够协同工作而不是互相打架？

---

## 3.4 原理三：分层分布式——复杂系统的可治理组织形态

### 3.4.1 核心命题

**以分层分布式架构替代"单中心全知全能"的集中式架构，实现局部自治与全局协调的有机统一。**

想象一下管理一个大型城市：如果所有事务——从路灯维修到城市规划——都由市长一个人决定，这个城市一定运转不了。现实中，城市采用"市—区—街道"三级管理，每一级有明确的职责和权限：街道处理日常琐事，区级协调跨街道事务，市级统筹全局政策。水利系统的分层分布式控制遵循完全相同的逻辑：数百个闸门和泵站不可能都由一个中央计算机来"全知全能"地控制，必须按空间和功能合理分层，让每一层各司其职。

当水利系统规模增大到一定程度，纯集中式控制方案面临三个根本性困难：一是计算负担呈指数增长——南水北调中线全线有数百个控制节点，集中式MPC的状态维数和约束数量使得优化问题在可用时间内无法求解；二是通信依赖过强——所有信息都汇聚到一个中心，一旦通信中断，整个系统瘫痪；三是组织管理难以对齐——长距离调水工程往往跨越多个行政区域，每个区域有自己的管理机构和运行规程，纯技术上的集中控制与行政管理的分散特征之间存在结构性矛盾。

分层分布式架构是解决这一困境的经典方法。其核心思想来自系统工程中的"分而治之"（divide and conquer）原则，但增加了层间协调机制，确保局部决策的全局一致性。

### 3.4.2 推荐的四层架构

CHS推荐的分层分布式架构包含四个层级（见图3-2），与第二章介绍的多时间尺度控制链形成对应：

[图3-2: CHS四层分布式控制架构图]

**执行层（L0，秒级响应）：** 单个设备（闸门、泵站、阀门）的本地闭环控制和安全联锁保护。执行层的控制器直接嵌入在设备的PLC或RTU中，即使与上层完全失联，也能保证设备在安全范围内运行。执行层是系统的"最后一道防线"——无论上层发生什么故障，执行层的安全联锁必须始终有效。

**区域层（L1，分钟级响应）：** 管辖一个物理上相对独立的区段（如一段渠道、一个灌区、一组泵站群），负责区域内多个设备的协调控制和局部优化。区域控制器通常采用MPC或类MPC算法，在满足区域内约束的前提下，优化区域性能指标（如水位跟踪精度、能耗最小化）。

**全局层（L2，小时级响应）：** 负责跨区域的资源分配和冲突消解。当不同区域的优化目标相互矛盾时（例如上游区域想放水，下游区域因为满负荷运行不想接收更多水量），全局层进行协调。全局层的算法通常基于分布式优化或博弈论方法，通过有限次的信息交换达成全局近似最优。

**治理层（L3，日级/政策级）：** 负责策略审批、责任划分和审计闭环。治理层不直接参与实时控制，而是设定运行策略（如"本月优先保障生态流量"、"暴雨期间安全系数提高20%"），并对下层的决策进行事后审计。治理层是人类决策者与自动化系统的接口——人通过治理层设定目标和约束，系统在目标和约束框架内自主运行。

### 3.4.3 层间协调机制

分层架构的关键不在于"分"而在于"合"——层与层之间的协调机制决定了系统能否实现全局一致性。CHS推荐三种互补的协调机制：

**目标分解与约束传递：** 全局层将全系统的运行目标分解为各区域的子目标，并将跨区域的耦合约束以边界条件的形式传递给各区域控制器。例如，全局层可以告诉某区域控制器："你的出口流量应在 $[Q_{min}, Q_{max}]$ 范围内，且在未来6小时内应逐渐趋近 $Q_{target}$。"

**信息共享与一致性协议：** 相邻区域之间共享边界状态信息（如交接断面的水位和流量），通过一致性协议确保双方对边界状态的认知一致。这类似于自动驾驶中相邻车辆之间的V2V（Vehicle-to-Vehicle）通信。

**冲突裁决与优先级规则：** 当区域间目标冲突无法通过协商解决时，按照预定义的优先级规则裁决。CHS建议的优先级序列为：安全 > 供水保障 > 效率优化 > 生态目标（注：这一序列可根据具体工程的治理要求调整，但"安全第一"是不可改变的最高原则）。

### 3.4.4 典型案例与国际经验

分层分布式控制在国际灌区控制领域有成熟的应用经验。法国的Canal de Provence灌溉系统是最早采用分层控制的大型灌区之一 [3-12]，其控制架构分为"本地PID层—区段MPC层—中央调度层"三级，经过数十年的运行验证了这一架构的有效性和鲁棒性。美国的中央亚利桑那调水工程（Central Arizona Project, CAP）采用了类似的分层结构，并在其基础上引入了前馈补偿以应对可预测的需水变化 [3-13]。

在中国，南水北调中线工程的运行管理体制本身就是分层分布式的——水利部南水北调工程管理司负责全局调度决策，各省级管理部门负责辖区内的运行管理，各闸站管理单位负责现场操作。CHS的分层分布式架构与这种行政管理体制天然契合，技术上的分层与管理上的分层相互对应、相互支撑。

### 3.4.5 常见误区

**只分层不分责。** 技术架构上做了分层，但没有明确每一层的决策权限、操作规程和责任边界。结果是"层级多了、责任模糊了"——出了问题不知道该找谁。CHS要求每一层的职责和权限必须以文档化的形式明确定义，并与治理层的审计闭环对接。

**层间接口不稳定。** 各层使用不同的通信协议、不同的数据格式、不同的时间基准，导致信息在层间传递时失真或延迟。CHS要求层间接口必须标准化，并在原理五（在环验证）的框架下进行接口测试。

分层架构回答了"系统如何组织"的问题，但组织得再好，如果运行中发生了意料之外的事件，系统如何保证不出危险？这就需要架构组织层的另一个核心机制——安全包络。

---

## 3.5 原理四：安全包络——先安全，后最优

### 3.5.1 核心命题

**为系统的每一类关键运行变量定义红/黄/绿三区边界，将安全约束从事后"报警"前移为事前"控制系统内生边界"，确保系统在任何情况下都不突破不可接受的安全底线。**

开车的人都熟悉仪表盘上的转速表：绿色区域随便踩油门，黄色区域提醒你该换挡了，红线区域如果继续加速发动机就可能损坏——现代汽车的ECU会在接近红线时自动限制喷油量，根本不给你"踩爆"的机会。安全包络对水系统做的事情完全一样：不是等水位超限了再报警让调度员处理，而是在控制系统内部就设定好边界——接近黄区自动保守，触碰红区自动保护。

传统水利工程的安全管理主要依赖"报警—人工响应"模式：当某个监测指标超过阈值时，系统发出报警，调度员根据经验判断并采取措施。这种模式在系统规模小、变化慢的时代是有效的，但面对大规模、快变化的现代水网，"报了警但来不及处理"的问题越来越突出。

安全包络（Safety Envelope）的理念来源于航空航天领域的飞行包线（Flight Envelope）概念。飞行包线定义了飞机在速度、高度、过载等参数空间中的安全飞行区域——飞行控制系统在设计层面就保证飞机不会飞出包线，而不是等飞出了再报警。CHS将这一理念移植到水系统中，为水位、流量、压力、水质等关键变量定义"运行包线"。

### 3.5.2 红—黄—绿三区定义

安全包络采用三区机制（见图3-3）：

[图3-3: 安全包络红黄绿三区示意图]

**绿区（正常运行域）：** 所有关键变量都在正常运行范围内。系统按性能优先策略运行——在满足基本安全约束的前提下，追求效率最大化（如能耗最低、水量损失最小、响应速度最快）。绿区内，优化算法拥有最大的决策自由度。

**黄区（预警运行域）：** 至少一个关键变量接近其安全边界，但尚未突破。系统自动切换为保守策略——收缩控制域（减小允许的控制动作幅度）、降低控制目标（从"最优"降为"可接受"）、提高安全权重（在优化目标函数中增大安全项的权重）。同时，系统向人类调度员发送预警信息，但不要求人工干预——系统可以在黄区内自主处理。

**红区（强制保护域）：** 至少一个关键变量达到或超过安全硬限。系统立即触发强制保护动作——这些动作是预先定义的、确定性的、不经过优化计算的直接指令（如"关闭进水闸至最小开度"、"启动应急排水泵"）。红区保护不依赖模型、不依赖通信、不依赖上层决策——它直接由执行层的安全联锁逻辑实现。红区保护触发后，系统同时通知人类调度员进行接管评估。

### 3.5.3 安全包络的工程实现

安全包络的工程实现需要解决三个关键问题：

**阈值如何确定？** 红区阈值通常由工程设计规范确定（如渠道的最大允许水深、大坝的汛限水位），具有明确的物理依据。黄区阈值的确定则需要结合工程经验和控制分析——它应该留出足够的"制动距离"，使系统在从黄区恢复到绿区的过程中不会滑入红区。具体而言，黄区阈值应至少保证：在最不利扰动条件下，系统从黄区边界启动保守策略后，有足够的时间和控制余量将状态拉回绿区，而不会突破红区。

**状态如何精确判定？** 实时判定当前处于哪个区域，需要依赖原理一（传递函数化）提供的模型和原理二（可控可观性）保证的状态估计能力。如果状态估计不准确，可能出现"实际已入黄区但系统仍以为在绿区"的危险误判。因此，安全包络的可靠性与状态估计的精度和鲁棒性直接挂钩。

**跨变量的综合判定。** 当多个变量同时处于不同区域时（例如水位在绿区但流速在黄区），系统如何综合判定？CHS建议采用"最保守原则"——以最严格的区域判定为准。如果任何一个关键变量处于红区，则系统整体进入红区保护模式。

### 3.5.4 管理价值

安全包络的价值不仅在于技术安全，更在于管理透明。它把"安全责任"从模糊的"注意安全"转化为可计算、可审计、可追责的工程对象：

1. **可计算**：任何时刻都能判定系统处于什么安全状态；
2. **可审计**：安全包络的阈值设定、触发记录、响应动作都有完整日志；
3. **可追责**：如果事故发生时系统已正确触发了红区保护但仍造成损失，说明问题出在阈值设定或保护动作设计上，责任清晰可追溯。

这种"安全的形式化"对于水利这种攸关公共安全的领域尤为重要。ISO 21448（SOTIF）[3-2] 在自动驾驶领域倡导的"已知安全—已知不安全—未知安全—未知不安全"四象限分析法，与CHS的安全包络理念异曲同工。

至此，建模基础层和架构组织层共四个原理已经搭建起系统的"骨架"。但纸上设计再完美，如何保证部署到真实工程中仍然可靠？这正是验证保障层的使命。

---

## 3.6 原理五：在环验证——可信上线的最低门槛

### 3.6.1 核心命题

**任何准备部署到真实水利工程中的控制策略、算法或软件，都必须经过模型在环（MIL）→软件在环（SIL）→硬件在环（HIL）的逐级验证，不得跳级上线。**

新药上市前要经过动物实验→临床一期→临床二期→临床三期的逐级验证，每一步都在更接近真实使用场景的条件下检验药效和安全性。在环验证对控制系统做的事情完全相同：先在纯数学仿真中检验逻辑（MIL），再在工程代码中检验实现（SIL），最后在真实硬件上检验时序和接口（HIL）——每一步都让算法离"现场"更近一步，每一步都可能暴露上一步无法发现的问题。

"仿真可行"不等于"工程可行"——这是水利工程智能化实践中最昂贵的教训之一。一个在理想化仿真环境中表现完美的控制算法，在面对真实工程中的通信延迟、测量噪声、设备非线性、参数漂移等因素时，可能表现截然不同。在环验证的目的正是在算法从"纸上"走向"现场"的过程中，逐步引入真实世界的复杂性，在每一步都验证算法的可靠性。

### 3.6.2 三层验证的目标与内涵

**MIL（Model-in-the-Loop，模型在环）：** 在纯软件仿真环境中测试控制逻辑。水力系统由数值模型模拟，控制算法也在同一计算平台上运行。MIL的目标是验证控制逻辑的正确性和工况覆盖度——包括正常工况下的性能、边界工况下的鲁棒性、以及异常工况下的安全响应。MIL测试应覆盖至少以下场景类别：（a）设计工况下的稳态和瞬态性能；（b）单一扰动（如来水突增、需水突减）下的响应；（c）组合扰动（如暴雨叠加设备故障）下的安全性；（d）极端工况（如超设计标准洪水）下的降级行为。

**SIL（Software-in-the-Loop，软件在环）：** 将控制算法编译为可部署的工程代码（通常是C/C++或PLC梯形图/ST语言），在与工程环境一致的软件平台上运行，但仍使用仿真模型替代真实物理过程。SIL的目标是验证代码实现的正确性——包括数值稳定性（浮点精度问题）、执行效率（是否满足实时性要求）、接口规范（与SCADA系统的数据交互）等。MIL和SIL的关键差异在于：MIL验证的是"算法对不对"，SIL验证的是"代码行不行"。

**HIL（Hardware-in-the-Loop，硬件在环）：** 将编译好的控制代码部署到真实的控制硬件（PLC、RTU或工控机）上，通过硬件接口与仿真模型实时交互。HIL的目标是验证真实硬件环境下的系统行为——包括接口时序（通信延迟和时钟同步）、信号精度（D/A和A/D转换误差）、故障响应（通信中断、传感器故障、执行器卡滞等）。HIL是上线前的最后一道关卡，也是最接近真实运行环境的验证手段。

### 3.6.3 在环验证与WNAL等级的关系

在环验证的深度和广度与目标WNAL等级直接挂钩（见图3-4）：

[图3-4: 在环验证深度与WNAL等级对应图]

表3-2 在环验证要求与WNAL等级对应关系

| WNAL等级 | MIL要求 | SIL要求 | HIL要求 |
|---------|---------|---------|---------|
| L0-L1 | 不要求 | 不要求 | 不要求 |
| L2 | 基本工况覆盖 | 推荐 | 不要求 |
| L3 | 全工况+异常场景 | 必须 | 必须（关键回路） |
| L4 | 全工况+极端+对抗 | 必须 | 必须（全部回路） |
| L5 | 全工况+生成式测试 | 必须+形式化验证 | 必须+长期耐久测试 |

Lei等 [3-14] 在提出的在环测试体系中明确指出，从WNAL L2向L3的跃迁是一个关键门槛——在此门槛之上，系统开始承担实质性的自主决策权，因此在环验证的完整性从"推荐"变为"强制"。

### 3.6.4 常见误区

**"仿真过了就够了"。** MIL仿真通过只是第一步，它无法暴露代码实现中的数值问题和硬件交互中的时序问题。忽略SIL和HIL验证，相当于让一个只在模拟器中练过飞行的飞行员直接驾驶真机执行任务。

**"测几个典型工况就行了"。** 水利系统的运行工况空间极为庞大——不同来水量、不同需水分布、不同设备状态的组合呈指数级增长。仅测试几个"典型"工况远远不够。CHS建议采用基于ODD的系统化测试方法：首先定义完整的ODD（见第四章），然后对ODD中的每个维度进行边界值测试和组合测试，确保测试覆盖ODD的全部边界。

通过在环验证的系统经受住了从仿真到现场的逐级考验，可以放心上线运行。然而，一个只会"闷头算"却说不清"为什么这么算"的系统，调度员很难信任它。接下来进入协同智能层——首先看认知增强如何让系统从"能算"变成"会解释"。

---

## 3.7 原理六：认知增强——让系统从会算到会解释

### 3.7.1 核心命题

**引入大语言模型（LLM）、知识图谱和因果推理等认知AI技术，使系统具备语义理解、因果诊断、策略解释和知识调用能力，实现从"能算"到"能解释为什么这么算"的跨越。**

传统的控制系统是"沉默的"——它能够计算出最优控制策略，但无法解释这个策略为什么是好的、在什么条件下可能失效、如果执行这个策略会带来什么风险。调度员面对控制系统给出的指令，往往处于"信或不信"的二选一困境——缺乏足够的信息来评估和判断。

用一个直觉性的类比来理解这一原理：想象一位经验丰富的老调度员退休前带新人。老调度员不仅知道"该把3号闸开到45%"，还能解释"因为下午两点灌区取水高峰结束，上游来水在三小时后会到达这里，如果不提前减小开度，晚上水位会涨到警戒线"。认知增强的目标，就是让自动化系统也具备这种"说得出道理"的能力。

认知增强原理通过引入认知AI能力来解决这一问题。"认知AI"与"物理AI"（基于物理模型的控制算法）形成互补：物理AI负责"算准"，认知AI负责"说清"。二者结合，构成了CHS技术架构中"物理保底、认知增强"的核心工程哲学。

### 3.7.2 认知增强的三个维度

**维度一：异常事件诊断。** 当系统出现异常时（如某断面水位突变），认知AI能够综合多源信息（上游来水变化、闸门动作记录、天气预报、设备状态日志等），进行因果推理，生成可读的诊断报告："本次水位突变可能由三个因素共同导致：（1）上游A闸在13:05的突然开启导致入流增加约15%；（2）下游B泵站的2号机组因轴承温度过高已自动停机，出流减少约10%；（3）区间短时暴雨增加了侧向入流约8%。建议：立即将A闸开度回调至原位，同时启动B泵站3号备用机组。"这种因果链式的诊断远比"水位超限"的简单报警有用得多。

**维度二：调度辅助与策略解释。** 当物理AI引擎生成一组优化控制策略时，认知AI可以将其"翻译"为人类可理解的操作指令和风险说明。例："建议在未来2小时内将C闸开度从60%逐步调整至45%，预计D断面水位将从当前的52.3 m下降至51.8 m。这一调整的原因是：下游E灌区在14:00后结束灌溉周期，需水量将减少约30%。如不调整，D断面水位可能在16:00前上升至53.1 m，接近黄区阈值53.5 m。"

**维度三：培训与知识传承。** 认知AI可以基于历史运行数据和案例库，生成可交互的推演场景，帮助新进调度员快速积累"经验"。老一代调度员的隐性知识——例如"看到上游水色发浑就知道明天水位要涨"——可以通过认知AI的知识图谱进行显性化和结构化，转化为可计算、可传承的决策规则。据水利行业调研，一个资深调度员通常需要5-8年才能积累足够的"直觉"来应对复杂工况 [3-18]；认知增强系统有望将这一学习周期缩短至1-2年。

### 3.7.3 技术架构：双AI协同

认知增强在CHS技术架构中的位置可以用表3-3精确描述：

表3-3 物理AI与认知AI的职责划分

| 维度 | 物理AI（安全基座） | 认知AI（增强层） |
|------|------------------|-----------------|
| 核心技术 | 传递函数、MPC、状态估计 | LLM、知识图谱、因果推理 |
| 响应时间 | 秒级（硬实时） | 分钟级（软实时） |
| 可靠性要求 | 确定性、可证明 | 统计性、可接受 |
| 失效后果 | 不可接受（安全风险） | 可接受（回退人工判断） |
| 典型任务 | 闸门调节、水位控制、安全联锁 | 异常诊断、策略解释、知识推荐 |
| 与安全包络关系 | 直接执行安全包络约束 | 解释安全包络的触发原因 |

### 3.7.4 边界条件

认知增强有一个至关重要的边界条件：**认知AI不能替代物理AI承担安全关键的控制决策。**

大语言模型和知识图谱等认知AI技术目前仍存在"幻觉"（hallucination）和不可预测行为的风险。OpenAI和Google的研究表明，即使最先进的LLM在特定领域的事实准确率也仅在85%-95%之间 [3-19]——对于聊天机器人而言这已足够好，但对于控制一座水库的泄洪闸门来说，5%-15%的错误率是完全不可接受的。在水利这种攸关公共安全的领域，让不完全可靠的认知AI直接控制闸门和泵站是不可接受的。

CHS的架构设计中，认知AI定位为"监督增强层"和"决策解释层"——它辅助人和物理AI做出更好的决策，但不直接操控物理设备。物理AI引擎作为"安全基座"，始终是控制决策的最终执行者。

这一设计理念可以用一个比喻来说明：物理AI是飞机的自动驾驶系统，认知AI是副驾驶——副驾驶可以提醒、建议、协助，但在安全关键时刻，自动驾驶系统的决策优先级高于副驾驶的建议。

### 3.7.5 工程实践：瀚铎水网大模型

CHS认知增强理念的一个代表性实现是瀚铎水网大模型（HanDo Water Network LLM）[3-11]。该系统在南水北调中线工程的试验段部署中，实现了以下能力：（a）对历史2000余条调度指令进行语义解析，构建了调度知识图谱；（b）在异常事件发生后30秒内生成因果链诊断报告，诊断准确率达87%；（c）对MPC优化结果自动生成自然语言解释，调度员理解效率提升了40%。关键设计约束是：瀚铎大模型的所有输出均为"建议"而非"指令"，最终控制动作仍由物理AI引擎在安全包络框架内执行。

系统有了认知能力，随之而来的核心问题是：人和机器之间到底怎么分工？谁说了算？出了事谁负责？协同智能层的第二个原理正是处理这个关系。

---

## 3.8 原理七：人机共融——责任清晰的协同自治

### 3.8.1 核心命题

**按WNAL等级动态配置"机器控制权限—人类监督权限—紧急接管机制"，实现从"人在回路中"到"人在回路上"的渐进自治，而非"人被完全排斥在外"的激进替代。**

这个原理可以用医疗中的类比来理解：手术机器人已经能完成许多精密操作，但没有哪家医院敢让机器人独自做完整台手术——手术室里始终有主刀医生监督，必要时随时接管。关键不在于机器人"能不能做"，而在于"出了问题谁负责"以及"谁有权在关键时刻叫停"。水利系统的人机共融面临同样的问题：技术能力的提升不等于责任可以转移。

人机共融不是一个技术问题，更是一个组织和治理问题。在水利工程中，调度员不仅是技术操作者，还是法律责任的承担者。即使技术上完全可行，将调度决策权完全交给机器在当前的法律、伦理和社会接受度框架下是不现实的。因此，CHS不追求"去人化"，而是追求"人机各司其职、责任清晰可追溯"。

### 3.8.2 人机关系的三种模式

根据人在控制回路中的位置，CHS定义了三种人机关系模式（见图3-5），它们与WNAL等级对应：

[图3-5: 人机关系三种模式与WNAL等级对应图]

**人在回路中（Human-in-the-Loop，HitL）：** 对应WNAL L0-L1。人做所有决策，机器只执行。调度员是"驾驶员"，系统是"方向盘和油门"。这是当前大多数水利工程的运行模式。

**人在回路上（Human-on-the-Loop，HotL）：** 对应WNAL L2-L3。机器做大部分常规决策，人负责监督和异常介入。调度员是"机长"，系统是"自动驾驶仪"——自动驾驶仪处理日常飞行，机长在必要时接管。这是CHS在中期推动的目标模式。

**人在回路外（Human-out-of-the-Loop，HootL）：** 对应WNAL L4-L5。机器完全自主运行，人仅在系统级策略调整时参与。调度员是"航空管制员"，系统是"自主无人机编队"——管制员设定航线和空域规则，无人机自主完成飞行任务。这是CHS的长远愿景，但在可预见的未来（至少10-15年内），水利工程不太可能达到这个阶段。

表3-4 三种人机模式的工程特征对比

| 特征 | HitL (L0-L1) | HotL (L2-L3) | HootL (L4-L5) |
|------|-------------|-------------|---------------|
| 人类角色 | 执行者 | 监督者 | 治理者 |
| 机器角色 | 工具 | 自动驾驶 | 自主系统 |
| 决策延迟 | 人的反应时间（分钟级） | 机器计算时间（秒级） | 机器计算时间（秒级） |
| 值班人员需求 | 每班3-5人（典型中型工程） | 每班1-2人 | 远程巡检（非常驻） |
| 夜间能力 | 严重退化（疲劳效应） | 不退化 | 不退化 |
| 接管路径 | 不适用 | 人工一键接管 | 远程接管+现场应急 |
| 典型工程代表 | 当前大多数水利工程 | 荷兰Maeslantkering风暴潮屏障 [3-7] | 尚无完整实例 |

荷兰的Maeslantkering风暴潮屏障是HotL模式的经典工程实践。该屏障是世界上最大的自动化风暴潮防护设施之一，在风暴潮预报达到预设阈值时由计算机系统自动启动关闭程序，整个关闭过程约2小时，但人类操作员始终保持监控并拥有最终否决权。自1997年投入运行以来，该系统的"自动决策+人工监督"模式经受了多次极端天气事件的考验 [3-20]。

### 3.8.3 三条底线

无论处于哪种人机关系模式，CHS都要求满足三条不可违反的底线：

**底线一：关键动作可追踪到责任主体。** 每一个控制动作——无论是人发出的还是机器发出的——都必须在日志中记录"谁在什么时间基于什么信息做出了什么决策"。这不仅是技术要求（用于事后复盘），更是法律要求（用于责任追溯）。

**底线二：接管链路始终可用并可演练。** 人对机器的接管能力必须在技术上始终可用——不能出现"想接管但系统不允许接管"的情况。同时，接管操作应定期演练，确保调度员在需要时能够迅速、正确地接管系统。接管演练的频率建议不低于每季度一次，关键岗位不低于每月一次。

**底线三：人机冲突时执行预定义优先级规则。** 当人的指令与机器的建议相冲突时（例如调度员要求增加流量，但安全包络显示这将导致下游水位超限），系统应按照预定义的优先级规则处理。CHS建议的规则是：安全包络约束优先——即使人工指令要求突破安全边界，系统也应拒绝执行并告知原因。但系统应保留"紧急超控"（override）功能，允许有授权的人员在承担责任的前提下超越安全包络，以应对系统无法预见的极端情况。

### 3.8.4 人机协同SOP

CHS建议每个工程项目都建立一份"人机协同标准操作规程"（SOP），明确回答以下问题：

1. **谁在何条件下批准自主控制？** 例如："正常工况下，值班调度员批准系统进入自主控制模式；暴雨预警III级以上时，需调度主任批准。"
2. **谁在何条件下撤销自主控制？** 例如："任何值班调度员有权随时撤销自主控制，无需请示；撤销后系统自动切换到手动模式。"
3. **接管后如何恢复？** 例如："人工接管后，恢复自主控制需要重新评估系统状态，确认所有关键变量在绿区内，并由值班调度员和调度主任联合批准。"
4. **如何复盘？** 例如："每次人工接管事件都必须在24小时内完成复盘报告，分析接管原因、接管过程和改进建议。"

前七个原理构成了系统在某一时刻的能力基座。但水利系统的运行环境不是静态的——来水规律在变、用水需求在变、设备性能也在变。系统能否从每一次运行经验中变得更聪明？这就是演进能力层的主题。

---

## 3.9 原理八：自主演进——受控学习与能力升级

### 3.9.1 核心命题

**系统应具备从运行数据和运行经验中持续学习的能力，逐步提升自主等级；但学习过程本身必须被治理——学习不能失控，演进不能突破安全包络。**

用一个简单的类比：一个新入职的调度员，第一年只能做辅助工作，三五年后才能独立值班，十年后才可能成为调度主任。这个成长过程有两个关键特征——持续学习和受控晋升。调度员不是一夕之间从新手变成专家的，每一次能力提升都要经过考核验证；如果某次判断失误，还会被暂时降低授权。自主演进要求控制系统也遵循同样的逻辑：可以不断学习进步，但每一步进步都要验证、可以回滚、不能突破安全边界。

自主演进是CHS八原理中最具前瞻性的一个，也是区分第五代运行管理系统与前四代的关键标志。前四代系统的能力在交付时就基本固化——SCADA系统的功能在安装完成后不会自动提升，MPC控制器的参数需要人工手动调整。而第五代系统应该像人类调度员一样，能够从每一次运行经验中积累知识、改进策略。

然而，"学习"在工程系统中是一把双刃剑。一方面，持续学习能够使系统不断适应新的工况和环境变化；另一方面，不受约束的学习可能导致系统偏离安全运行域——例如，如果系统"学到"了一种在训练数据中表现良好但在极端工况下失效的策略，并将其固化为默认行为，那么这种学习就是有害的。这就是为什么原理四（安全包络）对原理八（自主演进）形成了约束回边——演进必须在安全包络的约束下进行。

### 3.9.2 三个闭环

自主演进通过三个互相嵌套的闭环实现（见图3-6）：

[图3-6: 自主演进三重闭环示意图]

**数据闭环：采集—清洗—标注—回灌。** 系统在运行过程中持续采集数据，对数据进行质量控制和清洗（去除传感器故障导致的异常值、填补通信中断导致的缺失值），对关键事件进行标注（如"本次水位波动的原因是上游突发放水"），并将处理后的数据回灌到训练数据库中。数据闭环的质量直接决定了学习的质量——"垃圾进、垃圾出"的原则在此完全适用。

**模型闭环：离线训练—灰度验证—在线监控。** 当积累了足够的新数据后，系统可以离线训练更新后的模型或策略。更新后的模型不直接上线，而是先在"灰度"（shadow mode）环境中运行——即新模型与旧模型并行运行，新模型的输出用于对比但不实际执行，只有在灰度验证证明新模型确实优于旧模型后，才正式上线替换。上线后，系统持续监控新模型的表现，如果发现性能退化，立即回滚到旧版本。

**策略闭环：版本管理—回滚机制—效果评估。** 所有上线的控制策略都实行严格的版本管理——每个版本都有唯一标识、上线时间、性能基线和回滚指令。策略的更新遵循"小步快跑"原则——每次只做小幅增量更新，而非大规模重构。每次更新后都进行效果评估，确保更新确实带来了预期的改进。

### 3.9.3 防漂移原则

为防止自主演进过程中的"模型漂移"（model drift）或"策略漂移"（policy drift），CHS提出三条防漂移原则：

**可回滚：** 任何自适应更新都必须支持一键回滚到上一个稳定版本。回滚操作应在30秒内完成，不中断系统运行。工程实践中，回滚机制的实现通常采用"热备份"模式——旧版本控制器始终以影子模式并行运行，回滚时只需切换活动实例，无需重新加载。

**可解释：** 每次更新的内容必须能够用人类可理解的语言解释——"为什么要更新"、"更新了什么"、"预期效果是什么"。"黑箱式"的自动更新不被允许。具体而言，每次模型更新应附带一份"变更说明书"，包含以下信息：触发更新的工况描述、新旧模型在关键指标上的对比、灰度测试的统计结果（至少包含均值、方差和尾部风险指标）。

**可审计：** 所有更新的完整历史——包括触发条件、训练数据、灰度测试结果、上线审批记录——都必须保存在审计日志中，至少保留5年。审计日志的格式应满足表3-5的要求。

表3-5 自主演进审计日志最低要求

| 记录项 | 内容 | 保留期限 |
|--------|------|---------|
| 更新触发事件 | 何时、因何数据/事件触发了模型重训练 | ≥5年 |
| 训练数据摘要 | 数据来源、时间跨度、样本量、异常值处理方式 | ≥5年 |
| 灰度测试报告 | 新旧模型并行对比结果、统计显著性检验 | ≥5年 |
| 上线审批链 | 谁在什么时间批准了上线、批准依据 | ≥5年 |
| 上线后监控 | 上线后7天/30天/90天的性能跟踪数据 | ≥5年 |
| 回滚记录 | 若发生回滚，记录原因、时间和影响评估 | ≥5年 |

### 3.9.4 演进治理与安全包络的约束回边

原理八与原理四之间存在一条关键的约束回边：安全包络限定了自主演进的"学习边界"。具体而言：

**约束一：学习目标不得与安全包络冲突。** 如果模型优化的目标函数只追求效率（如能耗最小化），而不包含安全约束，那么优化过程可能"学到"一种在正常工况下高效但在异常工况下危险的策略。CHS要求自主演进的学习目标函数中必须硬编码安全包络约束——安全不是待学习的目标，而是学习的前提。

**约束二：演进速度受限于验证能力。** 一个系统的自主演进速度不能超过其在环验证能力的覆盖速度。如果每次模型更新需要2周的灰度验证才能建立信心，那么更新频率不应高于每2周一次。"快速迭代"在软件产品中是优点，但在关键基础设施控制中可能是风险。

**约束三：跨WNAL等级的演进需要重新评估。** 如果自主演进使系统的能力事实上从L2提升到了L3水平（例如系统"学会了"自主处理某些原本需要人工干预的异常），这不等于系统已经可以按L3运行——L3运行需要重新通过原理五（在环验证）的完整验证流程，以及原理七（人机共融）的SOP更新。等级跃迁不能"悄悄发生"。

八个原理至此逐一展开完毕。读者可能会问：在一个真实的工程项目中，这八个原理到底怎么落地——先做什么、后做什么、哪些可以并行？最后一节给出实施路径。

---

## 3.10 八原理的联合实施

### 3.10.1 依赖顺序与优先级

在实际工程中，八原理不可能同时完美实现。CHS建议按照"1→2→3→4→5→6→7→8"的优先顺序逐步推进：

- **第一步（原理一、二）：** 建立关键控制对象的模型，完成可控可观性分析。这是一切的基础。Lei等 [3-22] 在水资源系统分析方法综述中指出，模型化是从"经验管理"向"科学管理"跨越的第一步。
- **第二步（原理三、四）：** 落地分层架构和安全包络。这是系统运行安全的保障。
- **第三步（原理五）：** 建立在环验证能力。这是从"设计"到"上线"的门禁。
- **第四步（原理六、七）：** 引入认知增强和人机协同机制。这是提升运行智能的杠杆。
- **第五步（原理八）：** 建立持续学习和演进机制。这是系统长期发展的动力。

需要特别强调的是：上述顺序是优先级序列，不是时间序列。在实际项目中，多个原理可以并行推进（例如原理一和原理二的工作可以同时开展），只要确保依赖关系被满足——不应在原理一（模型）和原理二（可控可观性）未完成的情况下就跳到原理三（架构设计），因为架构设计需要以模型分析结果为输入。

表3-6 八原理实施依赖矩阵

| 当前原理 | 前置依赖 | 并行可能 | 关键交付物 |
|---------|---------|---------|-----------|
| 原理一 | 无 | 与原理二并行 | 模型台账（含适用域、精度指标） |
| 原理二 | 原理一（部分） | 与原理一并行 | 可控可观性分析报告 |
| 原理三 | 原理一、二 | 与原理四并行 | 分层架构文档+责任矩阵 |
| 原理四 | 原理一、二 | 与原理三并行 | 安全包络参数表+触发逻辑 |
| 原理五 | 原理一至四 | 独立阶段 | MIL/SIL/HIL测试报告 |
| 原理六 | 原理一至五 | 与原理七并行 | 认知增强模块部署方案 |
| 原理七 | 原理三、四 | 与原理六并行 | 人机协同SOP |
| 原理八 | 原理一至七 | 持续进行 | 版本管理制度+审计日志 |

### 3.10.2 最小实施清单

对于一个准备启动CHS升级的水利工程项目，以下八项工作是最小的实施清单：

表3-7 八原理最小实施清单

| 序号 | 对应原理 | 最小工程动作 | 预期产出 |
|------|---------|------------|---------|
| 1 | 原理一 | 建立关键对象的统一模型台账，标明适用工况和精度 | 模型台账文档 |
| 2 | 原理二 | 完成关键状态可观性和关键目标可控性核验 | 可控可观性分析报告 |
| 3 | 原理三 | 落地分层控制架构，明确各层职责和层间接口 | 架构设计文档+责任矩阵 |
| 4 | 原理四 | 定义并上线关键变量的红/黄/绿安全包络阈值 | 安全包络参数表+触发动作清单 |
| 5 | 原理五 | 建立MIL验证环境，对核心控制算法完成基本工况验证 | MIL测试报告 |
| 6 | 原理六 | 配置认知增强模块用于异常诊断和策略解释（不接管主回路） | 认知增强系统部署方案 |
| 7 | 原理七 | 编写人机协同SOP，明确批准/撤销/接管/复盘流程 | 人机协同SOP文档 |
| 8 | 原理八 | 建立模型和策略的版本管理制度，配套回滚和审计机制 | 版本管理制度文档 |

这八项工作的投入是可控的——不需要颠覆性的系统重建，而是在现有系统基础上的增量升级。完成这八项工作后，系统将具备从WNAL L1向L2跃迁的基本能力。

---

## 本章小结

本章详细阐述了CHS的八个基本原理——这是水系统自主运行的理论基座。核心要点如下：

第一，八原理构成一个有层次、有依赖的体系，分为建模基础层（原理一、二）、架构组织层（原理三、四）、验证保障层（原理五）、协同智能层（原理六、七）和演进能力层（原理八）。层与层之间是严格的依赖关系（见表3-1和表3-6），缺少任何一层都会导致系统性风险。

第二，每个原理都有明确的工程指向。原理一要求建立统一的系统描述语言；原理二要求在设备投资前做可控可观性分析；原理三要求建立分层分布式架构并明确各层职责；原理四要求将安全约束内化为控制系统的设计要素而非事后报警；原理五要求逐级在环验证、不跳级上线（表3-2给出了各WNAL等级的验证要求）；原理六要求引入认知AI但不替代物理AI的安全角色（表3-3定义了双AI职责边界）；原理七要求人机职责清晰、接管链路始终可用（表3-4对比了三种人机模式）；原理八要求持续学习但学习过程必须被治理（表3-5规范了审计要求）。

第三，八原理之间存在关键的约束回边：原理四（安全包络）对原理八（自主演进）形成约束，确保"越学越好"而非"越学越偏"；原理五（在环验证）对等级跃迁形成门禁，确保能力提升经过充分验证后才能生效。

第四，八原理必须联合实施。单独实现某一个原理而忽略其他原理，不仅无法实现自主运行，反而可能增加系统风险——引导案例中的失败正是最好的例证。表3-7提供了一份最小实施清单，帮助工程团队从最高优先级开始逐步推进。

第四章将把八原理映射到WNAL L0-L5分级体系，明确每一级需要满足哪些原理的哪些要求，回答"不同自主等级到底差在哪里、如何安全地升级"。

---

## 本章练习与思考题

**L1 概念理解**

1. 用自己的语言解释"安全包络"与传统"报警阈值"的核心区别。为什么安全包络被定义为"控制系统的内生边界"而非"外部报警条件"？

2. 原理六（认知增强）的边界条件是什么？为什么CHS不允许认知AI直接承担安全关键的控制决策？试从技术可靠性和法律责任两个角度分析。

**L2 分析比较**

3. 以原理五（在环验证）为例，对比MIL、SIL和HIL三个阶段各自能发现什么类型的问题，以及各自不能发现什么问题。设计一个具体场景说明为什么三个阶段缺一不可。

4. 原理三（分层分布式）与原理七（人机共融）之间存在什么关系？试分析在WNAL L3等级下，分层架构中的哪些层级由机器主导、哪些层级需要人的参与。

**L3 综合应用**

5. 假设你负责一条200千米的调水渠道的智能化升级项目。当前系统有SCADA但无自动控制功能（WNAL L1）。请基于本章的"最小实施清单"（表3-7），为该项目编制一份"向L2升级"的实施方案大纲，包括：（a）每项工作的具体内容；（b）预计所需的人员和时间；（c）工作之间的依赖关系和推荐的实施顺序。

6. 引导案例中描述的"单点智能、系统失灵"现象，在你所了解的水利工程中是否存在类似情况？如果有，请用八原理框架分析其根本原因，并提出改进建议。

**L4 开放研究**

7. 原理八（自主演进）提出"灰度验证"机制——新模型在影子模式下与旧模型并行运行。请设计一个具体的灰度验证方案：（a）如何定义"新模型优于旧模型"的判据？（b）灰度验证需要运行多长时间才有统计意义？（c）如果新模型在99%的工况下优于旧模型但在1%的极端工况下表现更差，应该如何决策？

---

## 本章参考文献

> **核实说明**：标注 ✅ 为经搜索核实的文献；⚠️ 为基本信息可信但部分细节待确认；👉 为作者本人论文需自行补充完整信息。定稿前务必逐条核对，删除本说明段。

[3-1] RTCA. DO-178C: Software Considerations in Airborne Systems and Equipment Certification [S]. Washington: RTCA, 2011. ✅

[3-2] ISO. ISO 21448:2022 Road Vehicles — Safety of the Intended Functionality [S]. Geneva: ISO, 2022. ✅

[3-3] Litrico X, Fromion V. Modeling and Control of Hydrosystems [M]. London: Springer, 2009. ✅

[3-4] Schuurmans J, Hof A, Clemens S, Brouwer R, Bosgra O H. Simple water level controller for irrigation and drainage canals [J]. Journal of Irrigation and Drainage Engineering, 1999, 125(4): 189-195. ✅

[3-5] Van Overloop P J. Model Predictive Control on Open Water Systems [D]. Delft: Delft University of Technology, 2006. ✅

[3-6] Kong L, Lei X, Wang H, et al. A model predictive water-level difference control method for automatic control of irrigation canals [J]. Water, 2019, 11(4): 762. DOI:10.3390/w11040762. ✅

[3-7] Rijkswaterstaat. Maeslantkering: Design and Operation of the Maeslant Storm Surge Barrier [R]. The Hague: Ministry of Infrastructure and Water Management, 2005. ⚠️ 待确认具体出版信息

[3-8] Kalman R E. On the general theory of control systems [C]//Proceedings of the First IFAC World Congress. Moscow: Butterworths, 1960: 481-492. ✅

[3-9] 王浩, 雷晓辉, 尚毅梓. 南水北调中线工程智能调控与应急调度关键技术 [J]. 南水北调与水利科技, 2017, 15(2): 1-8. ✅

[3-10] Cantoni M, Weyer E, Li Y, et al. Control of large-scale irrigation networks [J]. Proceedings of the IEEE, 2007, 95(1): 75-91. ✅

[3-11] 雷晓辉, 龙岩, 许慧敏, 等. 水系统控制论：提出背景、技术框架与研究范式 [J]. 南水北调与水利科技(中英文), 2025, 23(04): 761-769+904. DOI:10.13476/j.cnki.nsbdqk.2025.0077. ✅

[3-12] Malaterre P O. PILOTE: Linear quadratic optimal controller for irrigation canals [J]. Journal of Irrigation and Drainage Engineering, 1998, 124(4): 187-194. ✅

[3-13] Buyalski C P, Ehler D G, Falvey H T, Rogers D C, Serfozo E A. Canal Systems Automation Manual, Volume 1 [M]. Denver: U.S. Department of the Interior, Bureau of Reclamation, 1991. ✅

[3-14] 雷晓辉, 张峥, 苏承国, 等. 自主运行智能水网的在环测试体系 [J]. 南水北调与水利科技(中英文), 2025, 23(04): 787-793. DOI:10.13476/j.cnki.nsbdqk.2025.0080. ✅

[3-15] Wylie E B. Control of transient free-surface flow [J]. Journal of the Hydraulics Division, ASCE, 1969, 95(1): 347-361. ✅

[3-16] Malaterre P O, Rogers D C, Schuurmans J. Classification of canal control algorithms [J]. Journal of Irrigation and Drainage Engineering, 1998, 124(1): 3-10. ✅

[3-17] 雷晓辉, 苏承国, 龙岩, 等. 基于无人驾驶理念的下一代自主运行智慧水网架构与关键技术 [J]. 南水北调与水利科技(中英文), 2025, 23(04): 778-786. DOI:10.13476/j.cnki.nsbdqk.2025.0079. ✅

[3-18] 水利部人事司. 全国水利人才队伍建设"十四五"规划 [R]. 北京: 水利部, 2021. ⚠️ 待确认具体出版信息

[3-19] OpenAI. GPT-4 Technical Report [R]. arXiv:2303.08774, 2023. ✅

[3-20] Dircke P T M, Jongeling T H G, Jansen P L M. An overview and comparison of navigable storm surge barriers [R]//Proc. 6th Int. Conf. on Coastal and Port Engineering in Developing Countries (COPEDEC). Colombo, 2003. ⚠️ 待确认页码

[3-21] Åström K J, Murray R M. Feedback Systems: An Introduction for Scientists and Engineers [M]. 2nd ed. Princeton: Princeton University Press, 2021. ✅

[3-22] 雷晓辉, 孔令仲, 蒋云钟, 等. 水资源系统分析方法新进展与展望 [J]. 南水北调与水利科技(中英文), 2025, 23(04): 794-802. DOI:10.13476/j.cnki.nsbdqk.2025.0081. ✅
