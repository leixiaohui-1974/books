<!-- 变更日志
v1 2026-02-17: 初稿（基于“继续”命令续写）
-->

# ch02 安全包络的形式化表达与判定方法

## 学习目标

完成本章后，读者应能够：

1. 建立安全包络的集合化表达框架；
2. 理解边界可达性与可恢复性的差异；
3. 设计在线判定流程图并用于值守告警；
4. 构建运行判定字段与告警分级模板；
5. 将ch01概念框架转化为可执行判定逻辑。

> 承接 ch01：上一章提出 ODD—安全包络—MRS 三层结构，本章给出形式化描述与在线判定方法。

> **前章回顾**：上一章介绍了本领域的核心概念与方法。本章在此基础上进一步展开。


## 安全包络集合表达

设系统状态为 $\mathbf{x}$，控制输入为 $\mathbf{u}$，扰动为 $\mathbf{w}$。在给定 ODD 下，安全包络可表示为：

$$
\Omega_{safe}=\{(\mathbf{x},\mathbf{u})\mid g_i(\mathbf{x},\mathbf{u},\mathbf{w})\le 0,\ i=1,2,\dots,m\}
$$

其中 $g_i(\cdot)$ 为安全约束族，可包含水位、流量、闸位、坡降、联锁与协同时限约束。

[物理直觉] 安全包络不是一条线，而是一组条件共同定义的“可运行体积”。

[工程解释] 将约束统一为集合表达后，才能进行一致判定、门禁检查与自动告警。

## 边界可达性与可恢复性

边界可达性回答“是否可能进入边界附近状态”；可恢复性回答“进入后是否能在时限内回到安全区域”。

可定义简化可恢复性指标：

$$
R_{rec}=\frac{N_{rec}}{N_{event}}
$$

其中 $N_{rec}$ 为在规定时间窗内成功恢复到 $\Omega_{safe}$ 的事件数，$N_{event}$ 为边界事件总数。

[工程解释] 可达但不可恢复的边界状态，不应视为可接受运行区。

## 安全包络在线判定流程（补齐 ch01 跟踪项）

在线判定建议流程：

1. 采集实时状态与控制输入；
2. 执行约束族计算并判定所属区域；
3. 输出“安全区/预警区/越界区”标签；
4. 若为预警或越界，推送MRS候选动作；
5. 记录事件并触发值守协同。

[图2-1: 安全包络在线判定流程图（补齐 ch01 跟踪项）]
{描述: 展示“采集—判定—分级—动作推荐—留痕”闭环。}
{尺寸: 半页}
{颜色方案: 蓝色系}

## 集合表达与边界可达性示例（补齐 ch01 跟踪项）

示例：某渠段状态 $\mathbf{x}=[h,Q]^\top$，输入 $\mathbf{u}=[u_g]$，约束为：

- $h_{min}\le h\le h_{max}$；
- $Q_{min}\le Q\le Q_{max}$；
- 联动约束 $Q\le a h+b$；
- 闸门变化率约束 $|\Delta u_g|\le r_{max}$。

可达性分析步骤：

1. 在采样周期内预测下一时刻候选点；
2. 判断候选点是否仍在 $\Omega_{safe}$；
3. 若越界，计算最小调整量与恢复路径。

[表2-1: 安全包络集合表达与可达性判定示例表（补齐 ch01 跟踪项）]
{描述: 列包括时刻、状态向量、约束判定结果、区域标签、推荐动作、恢复时限。}
{尺寸: 全页}
{颜色方案: 灰度}

## 在线判定字段与值守告警模板（补齐 ch01 跟踪项）

建议最小字段集：

- 时间戳、站点ID、ODD场景ID；
- 状态向量、控制向量、约束裕度；
- 区域标签（绿/黄/红）；
- 推荐动作ID、执行人、执行时限；
- 恢复结果与复盘标记。

告警分级建议：

- L1（提示）：接近边界，建议预调；
- L2（预警）：进入黄区，需值守确认；
- L3（告警）：进入红区，触发MRS与协同升级。

[表2-2: 在线判定字段与值守告警模板（补齐 ch01 跟踪项）]
{描述: 列包括字段名、类型、含义、采样频率、告警阈值、责任角色。}
{尺寸: 全页}
{颜色方案: 灰度}

## 例题：三区域标签判定与动作推荐

【例2-1】给定某时刻状态与约束裕度，判定其所在区域并给出推荐动作。

[已知] 约束裕度向量 $\Delta=[\delta_h,\delta_Q,\delta_u]$。

[求解] 输出区域标签与动作优先级。

[解题过程]
1. 若任一 $\delta<0$，判定为红区并触发L3；
2. 若最小裕度低于预警阈值，判定为黄区并触发L2；
3. 否则判定为绿区并保持常规运行。

[结果讨论] 通过“裕度 + 阈值”比仅使用单点超限更稳健。

## 本章小结

本章完成安全包络形式化表达，给出了集合约束、边界可达性与可恢复性区分，并补齐在线判定流程图、可达性示例和告警字段模板，形成了可落地的判定—告警—恢复基础框架。下一章将进入风险源分类与安全裕度评估。

## 习题

### 基础题

**2-1.** 写出安全包络集合表达的一般形式。
**2-2.** 边界可达性与可恢复性的区别是什么？
**2-3.** 为什么在线判定需要记录约束裕度字段？

### 应用题

**2-4.** 设计一个含3个约束的判定流程并给出伪代码。
**2-5.** 构建L1/L2/L3告警阈值建议表并说明依据。

### 思考题

**2-6.** 在通信延迟显著波动时，在线判定流程应如何避免误告警与漏告警？

## 拓展阅读

1. **Lei et al. (2025c). 在环测试系统与运行门禁。**
2. **Blanchini (1999). Set invariance in control.**
3. **ISO 22320 (Emergency management).**
4. **IEC 61508 (Functional safety).**
5. **ASCE MOP 131.**
