<!-- 变更日志
v3 2026-02-16: 根据评审与行内意见补充二级例题、参数表与习题答案要点，增强“可教+可落地”闭环
v2 2026-02-16: 根据四角色评审修订——补充瞬态上线核对清单与术语一致性声明，强化ch03→ch04过渡
v1 2026-02-16: 初稿
-->

# 第三章 管网水力学基础

---

## 学习目标

完成本章后，你应能够：

1. 基于质量守恒与能量守恒写出典型供水管网的稳态方程组；
2. 解释水锤瞬变流的物理机制，并说明其对控制设计的约束意义；
3. 使用传递矩阵法描述串联系统中压力与流量扰动的传播关系；
4. 识别“稳态可行”与“瞬态安全”之间的差异，并提出联合校核思路；
5. 将管网模型与后续章节的模型预测控制（Model Predictive Control, MPC）与安全包络（Safety Envelope）接口对齐。

> **章首衔接（承接ch02）**  
> 上一章建立了统一控制对象表达：\(\mathbf{x},\mathbf{u},\mathbf{d},\mathbf{y}\) 及 \(\mathcal{X}_{safe}\subseteq\mathcal{X}_{ODD}\) 的约束关系。本章将该统一框架落到压力管网对象，回答“稳态怎么解、瞬态怎么防、控制怎么接”的三个问题。

> **前章回顾**：上一章介绍了本领域的核心概念与方法。本章在此基础上进一步展开。


## 管网建模的工程边界与变量定义

管网系统与明渠系统在控制视角上的关键差异是：压力波传播速度高、局部执行动作可能在短时间内放大为全网风险。因此，管网建模不能只看稳态工况，还必须把执行器快速动作、阀门误操作、泵组切换等瞬态场景纳入统一模型与约束。

本章采用如下变量定义：

- 节点水头 \(H_i\)（m）；
- 管段流量 \(Q_{ij}\)（m\(^3\)/s）；
- 阀门/泵控制输入 \(u_k\)（开度或转速指令）；
- 外部扰动 \(d\)（需水波动、源头压力波动、设备效率衰减）。

[表3-1: 管网建模变量与控制意义]
| 变量 | 物理含义 | 控制意义 | 常见约束 |
|---|---|---|---|
| \(H_i\) | 节点总水头 | 反映供压能力与安全余量 | 上下限、最小服务压力 |
| \(Q_{ij}\) | 管段过流 | 反映输配能力与能耗 | 流速上限、反向流限制 |
| \(u_k\) | 执行器动作 | 直接改变局部阻抗或扬程 | 幅值、变化率、最小停留时间 |
| \(d\) | 外部扰动 | 决定负荷不确定性 | 预测误差边界 |

## 管网稳态水力学基础

### 3.2.1 节点质量守恒

[物理直觉] 对任一节点，流入与流出差值必须等于节点取水（或注入）量，这是网络质量守恒的离散表达。

[公式]
\[
\sum_{j\in\mathcal{N}_i^{in}} Q_{ji}-\sum_{k\in\mathcal{N}_i^{out}}Q_{ik}=q_i
\]

[工程解释] \(q_i>0\) 表示节点取水需求，\(q_i<0\) 表示外部注入。该方程决定了网络可行流量分配的基础平衡关系。

### 3.2.2 管段能量方程与沿程损失

[物理直觉] 水流通过管段会因摩阻和局部构件产生能量损失，若不补偿，末端压力将下降。

[公式]
\[
H_i-H_j=h_f+h_l
\]

其中沿程损失可写为 Darcy-Weisbach 形式：
\[
h_f=f\frac{L}{D}\frac{v^2}{2g}
\]

[工程解释] 在配水管网优化中，\(h_f\) 与 \(Q\) 之间的非线性关系决定了“高峰小时压降显著增加”的现象，也是泵站能耗上升的主要来源。

### 3.2.3 泵与阀门特性嵌入

泵组可近似表示为扬程曲线 \(H_p(Q,\omega)\)，阀门可表示为局部阻力系数 \(\zeta(u)\) 的函数。控制本质是通过 \(u\) 改变网络拓扑中的“可调阻抗/可调扬程”，从而重构稳态分配。

[表3-2: 稳态求解与控制整定的参数建议（教学版）]
| 参数 | 建模阶段用途 | 控制阶段用途 | 风险提示 |
|---|---|---|---|
| 管径 \(D\)、长度 \(L\) | 决定阻抗与压降灵敏度 | 影响前馈补偿强度 | 图纸与实际不一致会导致偏差 |
| 摩阻系数 \(f\) | 决定沿程损失精度 | 影响能耗评估与约束边界 | 建议按季节或工况分段标定 |
| 泵曲线 \(H_p(Q,\omega)\) | 决定可达工作区 | 决定调速可控区与效率最优点 | 老化后需重标定 |
| 阀门特性 \(\zeta(u)\) | 决定局部损失与耦合强度 | 决定动作序列可行性 | 卡滞/回差会放大瞬态风险 |

## 水锤瞬变流：从物理机制到控制约束

### 3.3.1 水锤形成机理

[物理直觉] 当阀门快速关闭或泵组瞬间停机时，流体动量突变会激发压力波，沿管道往返传播并反射叠加，形成短时高压或低压冲击。

在一维近似下，Joukowsky 关系给出压力突增估计：
\[
\Delta H\approx \frac{c}{g}\Delta v
\]

其中 \(c\) 为压力波速，\(\Delta v\) 为流速变化。

[工程解释] 该式表明“动作越快，冲击越大”。因此执行器速率约束不是保守选项，而是保障管网结构安全的必要条件。

### 3.3.2 瞬态风险与运行设计域（ODD）

稳态可行并不意味着瞬态安全。一个稳态压力合格的工况，在阀门联动切换时仍可能越过安全阈值。故需把瞬态指标纳入运行设计域（Operational Design Domain, ODD）定义，例如：

- 最大允许压力波动幅值；
- 最小允许负压裕度；
- 连续动作最小间隔时间。

这类指标将在第十章安全包络中形成“红/黄/绿”三区间联锁规则。

## 传递矩阵法：管网动态传播的可计算表达

### 3.4.1 为什么需要传递矩阵法

对串联系统或可分解子网，传递矩阵法可将“段内传播+边界条件”统一为代数映射，便于频域分析与控制器整形。其价值在于：既保留波动传播特征，又避免直接求解全 PDE 带来的高计算负担。

### 3.4.2 基本形式

设某管段入口扰动向量为 \(\mathbf{z}_{in}\)，出口向量为 \(\mathbf{z}_{out}\)，可写为：
\[
\mathbf{z}_{out}(s)=\mathbf{T}(s)\mathbf{z}_{in}(s)
\]

多段串联时：
\[
\mathbf{z}_{out}(s)=\mathbf{T}_n(s)\cdots\mathbf{T}_2(s)\mathbf{T}_1(s)\mathbf{z}_{in}(s)
\]

[工程解释] 该结构天然适配“分区建模—分区校核—分区控制”的工程组织方式，可直接服务后续分层分布式控制（Hierarchical Distributed Control, HDC）设计。

### 3.4.3 与传递函数建模的关系

传递矩阵法与传递函数并不冲突：前者强调多端口耦合传播，后者强调输入输出映射。工程上可先用传递矩阵保留关键耦合，再在控制设计层提取主导通道传递函数，实现“建模保真”与“控制可算”的平衡。

### 3.4.4 与状态空间接口（面向ch06/ch07）

在控制实现中，常需把传递矩阵模型进一步转化为离散状态空间形式：
\[
\mathbf{x}_{k+1}=\mathbf{A}\mathbf{x}_k+\mathbf{B}\mathbf{u}_k+\mathbf{E}\mathbf{d}_k,\quad
\mathbf{y}_k=\mathbf{C}\mathbf{x}_k
\]

[工程解释] 该接口可直接接入后续线性MPC滚动优化。若某段高频动态对运行不敏感，可在保持安全约束不变的前提下进行降阶，降低在线计算负担。

[图3-1: 串联系统传递矩阵法建模流程图]
{描述: 左侧为管段离散与边界条件设置，中部为单段传递矩阵构建，右侧为串联矩阵组合与频域校核，底部标注与控制器设计接口。}
{尺寸: 全页}
{颜色方案: 蓝色系}
{对应ARCH编号: 无（本章自定义教学图）}

[图3-2: 稳态—瞬态联合校核与控制上线流程图]
{描述: 依次展示“稳态求解→瞬态初筛→安全包络核对→动作序列修正→上线监控”；右侧标注越界触发顺序“降速→解列→人工接管”。}
{尺寸: 半页}
{颜色方案: 蓝色系}
{对应ARCH编号: ARCH-07（约束表达借鉴）}

## 例题：双泵站—三节点管网的稳态与瞬态联合校核

【例3-1】某供水子网含两座并联泵站和三个关键用户节点。已知高峰期需求波动明显，拟通过阀门联动实现夜间降耗。请给出“稳态可行+瞬态安全”的联合校核流程。

**已知**：

- 节点 2、3 有最小服务压力要求；
- 两泵站允许切换，但存在最小停留时间；
- 阀门开度计划在 60 s 内完成一次调整。

**求解**：

1. 建立最小化模型并判定稳态可行性；
2. 评估动作计划是否触发水锤风险；
3. 给出可执行的动作修正建议。

**解题过程**：

步骤1（稳态方程）：列节点守恒和管段损失方程，求解 \(H_i,Q_{ij}\) 并检查最小服务压力。  
步骤2（瞬态初筛）：使用 \(\Delta H\approx(c/g)\Delta v\) 估算阀门动作引起的压力波动上界。  
步骤3（约束核对）：将估算结果与 \(\mathcal{X}_{safe}\) 边界比对，若超限则延长动作时间并分段切换泵组。  
步骤4（策略落地）：形成“先降速、后切换、再微调”的三段动作序列，并记录可审计触发条件。

**结果讨论**：

该流程显示：仅做稳态优化可能得到“账面最优”但上线高风险的方案；将瞬态约束前置后，策略虽略损失能耗最优，却显著提升可运行性与可治理性。

【例3-2】某阀门动作将流速变化 \(\Delta v\) 从 0.30 m/s 提高到 0.45 m/s，若压力波速 \(c\) 近似不变，估算压力冲击变化比例并给出控制建议。

**已知**：

- Joukowsky 估计式：\(\Delta H\approx(c/g)\Delta v\)；
- 其余工况参数不变。

**求解**：冲击变化比例与动作策略修正。

**解题过程**：

步骤1：冲击比值 \(\Delta H_2/\Delta H_1=\Delta v_2/\Delta v_1=0.45/0.30=1.5\)。  
步骤2：可判定压力冲击约增加 50%。  
步骤3：工程修正可选“延长动作时长、分段动作、先降泵速后切阀”。

**结果讨论**：

该简算用于上线前快速风险筛查，不替代高保真瞬态仿真；当评估值接近 Safety Envelope 边界时，应转入在环测试复核。

## 本章小结

本章构建了管网水力学建模的三层基础：稳态守恒方程、瞬态水锤机理、传递矩阵可计算表达。核心结论是：管网控制必须同时满足稳态供压与瞬态安全，执行器速率约束和动作序列设计是控制器落地的先决条件。下一章将进入降阶建模，回答如何在保留关键动态特性的前提下降低模型复杂度。

### 瞬态上线核对清单（工程实施）

- [ ] 是否已定义关键节点最大/最小瞬态压力阈值；
- [ ] 是否为阀门与泵组配置变化率与最小停留时间约束；
- [ ] 是否完成“最不利工况”下的压力波传播复核；
- [ ] 是否明确越界后的降级动作顺序（降速→解列→人工接管）；
- [ ] 是否记录可追溯审计字段（触发时刻、动作指令、恢复时长）。

## 习题

### 基础题

**3-1.** 写出节点质量守恒方程，并解释 \(q_i\) 的工程含义。  
**3-2.** 为什么“稳态可行”不等于“瞬态安全”？请用一段话说明。  
**3-3.** 解释传递矩阵法与单输入单输出传递函数的差别。

### 基础题参考答案要点

**3-4.** 质量守恒写作 \(\sum Q_{in}-\sum Q_{out}=q_i\)，\(q_i\) 表示节点外部取/注水。  
**3-5.** 稳态只检查平衡点可行，瞬态需检查动作过程是否越界（压力冲击、负压风险等）。  
**3-6.** 传递矩阵法描述多端口传播耦合；传递函数更适合提炼单通道控制设计。

### 应用题

**3-7.** 某管段长度增加一倍、流速不变时，沿程损失如何变化？请给出推导过程并解释工程意义。  
**3-8.** 设阀门动作导致流速变化 \(\Delta v\) 提高 30%，根据 Joukowsky 关系估计压力冲击变化比例，并讨论控制策略应如何调整。

### 思考题

**3-9.** 在供水保障优先场景中，若“降低能耗”与“抑制水锤”冲突，你会如何设定多目标权重与联锁逻辑？请提出一套可执行原则。

## 拓展阅读

1. Wylie, E.B., & Streeter, V.L. *Fluid Transients in Systems*.
2. Litrico, X., & Fromion, V. *Modeling and Control of Hydrosystems*.
3. Van Overloop, P.J. *Model Predictive Control on Open Water Systems*.
4. ASCE (2014). *MOP 131: Canal Automation for Irrigation Systems*.
5. Lei et al. (2025a). 理论背景与研究范式。
