<!-- 变更日志
v1 2026-02-16: 初稿
-->

# 第三章 深度学习与水系统

---

## 学习目标

完成本章后，你应能够：

1. 解释 CNN、RNN/LSTM 与 Transformer 在水系统任务中的适用场景；
2. 构建面向时间序列预测与空间关联建模的深度学习流程；
3. 识别过拟合、分布漂移与数据偏差对工程部署的影响；
4. 设计迁移学习在跨流域/跨季节任务中的应用策略；
5. 将深度学习模型接入 ODD、Safety Envelope 与在环验证体系。

> **章首衔接（承接ch02）**  
> 上一章建立了机器学习基础与工程门禁。本章进一步进入深度学习，重点解决“高维时空数据下的表示学习与稳健泛化”问题。

## 3.1 深度学习在水系统中的角色

[物理直觉] 水系统数据具有多尺度时空相关：短时波动、日周期、季节周期与工况切换叠加。传统浅层模型难以同时捕捉这些层次。

[工程解释] 深度学习的价值在于自动提取分层特征，但其输出仍需服从 CHS 约束框架，不能绕开 ODD 与 Safety Envelope。

## 3.2 常见网络结构与任务匹配

[表3-1: 深度网络与任务匹配]
| 模型 | 结构特征 | 适合任务 | 风险点 |
|---|---|---|---|
| CNN | 局部感受野、参数共享 | 空间栅格降雨/遥感特征提取 | 对长程依赖表达有限 |
| RNN/LSTM | 序列记忆 | 流量/水位时序预测 | 长序列训练不稳定 |
| Transformer | 自注意力机制 | 长时序建模、多变量耦合预测 | 算力与数据需求高 |

## 3.3 时间序列预测流程

推荐流程：

1. 构建多时间尺度输入（小时/日/周特征）；
2. 采用滑动窗口形成监督样本；
3. 使用验证集做超参数搜索与早停；
4. 在极端工况子集评估鲁棒性；
5. 通过 SIL 回放验证对控制环节的影响。

[图3-1: 深度时序预测训练与验证流程]
{描述: 数据预处理→窗口构建→模型训练→验证早停→测试评估→在环验证→灰度上线。}
{尺寸: 全页}
{颜色方案: 蓝色系}
{对应ARCH编号: ARCH-06}

## 3.4 空间建模与迁移学习

### 3.4.1 空间建模

在多站点系统中，可把站点视作图或栅格结构，结合 CNN/注意力机制学习空间耦合关系。

### 3.4.2 迁移学习

[工程要点] 跨流域迁移时，需先校核输入分布差异与设备约束差异，再决定“冻结底层+微调高层”或“全量再训练”。

[TODO: 需补充跨流域迁移样本规模与性能增益统计数据]

## 3.5 深度模型工程门禁

深度模型上线前必须完成三类检查：

- **性能检查**：总体误差与极端工况误差双达标；
- **安全检查**：预测输出不引发越界控制动作；
- **治理检查**：模型版本、数据版本、训练配置可复现。

[公式前直觉] 仅靠平均误差无法反映极端工况风险，需引入分位数误差评估。

\[
E_{q}=\operatorname{Quantile}_{q}(|\hat{y}-y|),\quad q\in\{0.5,0.9,0.95\}
\]

[工程意义] 高分位误差直接关联保守约束配置，决定是否需要扩大安全裕度。

## 3.6 例题：LSTM与Transformer在入库流量预测中的比较

【例3-1】某水库需要预测未来24小时入库流量，候选模型为 LSTM 与 Transformer。

**已知**：
- 数据包含5年历史流量、降雨和温度；
- 洪峰样本占比较低；
- 调度要求对高风险时段优先保障安全。

**求解**：给出模型比较与上线建议。

**解题过程**：

步骤1：统一数据预处理与窗口长度，保证公平比较。  
步骤2：比较 MAE/RMSE 与 0.9/0.95 分位误差。  
步骤3：在洪峰子集评估召回能力与误差上限。  
步骤4：将预测输出接入 SIL，检查是否触发过多保守联锁。  
步骤5：选择在高分位误差更稳健且可解释方案，并灰度上线。

**结果讨论**：

工程选择应优先“极端工况稳健性 + 安全可控性”，而非只追求平均指标最优。

### 深度学习章节上线检查清单

- [ ] 是否完成训练/验证/测试与极端子集分层评估；
- [ ] 是否报告分位误差并与安全裕度联动；
- [ ] 是否完成跨场景迁移可行性评估；
- [ ] 是否通过 SIL/HIL 在环影响测试；
- [ ] 是否建立可复现训练配置与模型回退机制。

## 3.7 本章小结

本章构建了深度学习在水系统中的工程化路径：模型结构选择、时空建模流程、迁移学习策略与上线门禁。核心结论是：深度学习应以 CHS 约束体系为护栏，在确保安全与治理可控的前提下提升预测与决策能力。下一章将进入物理信息神经网络（PINN），讨论机理约束与数据学习融合。

## 习题

### 基础题

1. CNN、LSTM、Transformer 在水系统任务中的典型适用场景分别是什么？  
2. 为什么深度模型需要报告高分位误差而不仅是平均误差？  
3. 迁移学习在跨流域应用时最先应检查什么？

### 应用题

4. 设计一个用于多站点水位预测的深度学习数据管线。  
5. 给出“深度模型上线失败后的回退与复盘”流程。

### 思考题

6. 当 Transformer 精度更高但算力成本显著增加时，工程上线应如何权衡？

## 拓展阅读

1. Goodfellow, I., Bengio, Y., Courville, A. *Deep Learning*.  
2. Vaswani et al. (2017). *Attention Is All You Need*.  
3. Hochreiter, S. & Schmidhuber, J. (1997). Long Short-Term Memory.  
4. Lei et al. (2025b). 自主智能水网架构。  
5. Lei et al. (2025c). 在环测试系统。
