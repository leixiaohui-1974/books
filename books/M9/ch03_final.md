<!-- 变更日志
v1 2026-02-16: 初稿（基于“继续”命令自动续写）
-->

# ch03 运行过程建模与不确定性表达

## 3.1 学习目标

完成本章后，读者应能够：

1. 说明运行过程模型的对象、边界与时标；
2. 建立“机理—数据—规则”混合建模框架；
3. 使用统一术语描述不确定性来源与传播路径；
4. 给出预测误差超阈值时的工程处置流程；
5. 为 ch04 的运行决策与优化奠定建模接口。

> 承接 ch02：上一章解决“如何表示与度量”，本章解决“如何预测与解释变化”。

## 3.2 运行过程模型：从状态到演化

运行工程关注的是“状态如何随时间演化”。可采用离散时间表达：

$$
\mathbf{x}_{k+1}=f\left(\mathbf{x}_k,\mathbf{u}_k,\mathbf{d}_k\right)+\mathbf{w}_k,\quad
\mathbf{y}_k=g\left(\mathbf{x}_k\right)+\mathbf{v}_k
$$

其中 $\mathbf{x}$ 为系统状态，$\mathbf{u}$ 为控制动作，$\mathbf{d}$ 为外部扰动，$\mathbf{w},\mathbf{v}$ 分别表示过程噪声与观测噪声。

[物理直觉] 同一控制指令在不同来水与设备健康状态下，会导致不同的下一时刻状态，因此模型必须显式容纳扰动与噪声。

[图3-1: 运行过程状态演化图]
{描述: 展示状态、控制、扰动、观测之间的因果关系与时间推进关系，标注“预测—校正”闭环。}
{尺寸: 全页}
{颜色方案: 蓝色系}

## 3.3 混合建模框架：机理 + 数据 + 规则

面向本科教学与工程落地，推荐“三元混合模型”：

- **机理层**：守恒关系、设备约束、联锁逻辑；
- **数据层**：短时预测模型、状态估计模型、残差诊断模型；
- **规则层**：运行设计域（ODD）边界、门禁策略、人工接管条件。

[工程解释] 只靠机理模型，难以覆盖复杂工况；只靠数据模型，难以保证可解释性与安全边界。三元混合是“可用、可解释、可审计”的折中。

[表3-1: 三元混合建模框架及输入输出]
{描述: 列包括建模层、输入、输出、刷新周期、主要误差来源、责任角色。}
{尺寸: 半页}
{颜色方案: 灰度}

## 3.4 不确定性来源分类图（补齐 ch02 跟踪项）

运行工程中的不确定性可分为四类：

1. **外源不确定性**：来水、负荷、气象、上游调度变动；
2. **模型不确定性**：参数漂移、结构失配、工况外推；
3. **感知不确定性**：传感器偏差、丢包、时间戳错位；
4. **执行不确定性**：执行器迟滞、人工延迟、通信时延。

[图3-2: 不确定性来源分类与传播路径图]
{描述: 用四象限展示四类不确定性，并以箭头表示其向“预测误差—控制偏差—治理风险”传播路径。}
{尺寸: 全页}
{颜色方案: 蓝色系}

[工程解释] 分类不是为了“命名”，而是为了“分责”。只有把误差映射到来源，才可能找到正确整改部门。

## 3.5 不确定性传播的定量表达（补齐 ch02 跟踪项）

在小扰动近似下，可将模型线性化：

$$
\delta\mathbf{x}_{k+1}\approx A_k\,\delta\mathbf{x}_k + B_k\,\delta\mathbf{u}_k + E_k\,\delta\mathbf{d}_k
$$

相应协方差传播可写为：

$$
P_{k+1}=A_kP_kA_k^\top + Q_k
$$

预测输出不确定性为：

$$
S_k=C_kP_kC_k^\top+R_k
$$

其中 $P_k$ 表示状态估计不确定性，$Q_k$ 与 $R_k$ 分别表示过程与观测噪声协方差。

[物理直觉] 若系统对扰动敏感（$A_k$ 的放大效应显著），即便初始误差很小，也会在短时间内累积成可见运行偏差。

[表3-2: 传播矩阵与工程含义对照表]
{描述: 列包括符号、数学定义、工程含义、可获取数据来源、常见调参策略。}
{尺寸: 半页}
{颜色方案: 灰度}

## 3.6 预测误差超阈值处置模板（补齐 ch02 跟踪项）

建议定义分级阈值：

- 绿色区：$|e_k| \le \theta_1$，常规监视；
- 黄色区：$\theta_1 < |e_k| \le \theta_2$，触发模型重校验；
- 红色区：$|e_k| > \theta_2$，触发回退与人工复核。

其中 $e_k = y_k-\hat y_k$ 为实时残差。

[表3-3: 预测误差超阈值处置模板]
{描述: 列包括误差等级、触发条件、自动动作、人工动作、时限、留痕字段。}
{尺寸: 全页}
{颜色方案: 灰度}

标准处置流程（建议写入值班SOP）：

1. **检测**：连续 $N$ 个周期超阈值即触发事件；
2. **隔离**：区分传感器异常、模型失配、执行偏差；
3. **缓解**：降级到保守策略或最小风险状态（MRS）；
4. **恢复**：完成重估计/重标定后逐步恢复自动化等级；
5. **复盘**：在工单中记录误差区间、处置时长、责任环节。

[工程解释] “超阈值”本身不是事故，真正风险是超阈值后仍按原策略盲目运行。

## 3.7 可复现实例：泵站负荷突变下的误差处置

【例3-1】某泵站晚高峰出现负荷突变，15分钟内预测流量偏差持续放大。

已知：

- 阈值设定 $\theta_1=3\%$，$\theta_2=8\%$；
- 连续 5 个周期残差从 2.5% 升至 8.7%；
- 同时出现通信时延上升与一台传感器漂移告警。

**任务**：依据处置模板给出处置顺序。

**解题过程**：
1. 判断误差区间已进入红色区，触发回退策略；
2. 先校验传感器时间戳与漂移，再复核执行器反馈；
3. 启动保守调度曲线，限制控制动作总变差；
4. 完成状态重估计后，分阶段恢复自动化权限；
5. 形成复盘记录并更新模型可信度标签。

**结果讨论**：
该案例强调“分级阈值 + 标准流程”的价值：在高压场景下减少临场争议，提高团队协同效率。

## 3.8 本章小结

本章建立了运行过程建模的统一表达，提出机理—数据—规则三元混合建模框架，补齐了不确定性来源分类图、传播定量表达与预测误差超阈值处置模板。下一章将基于本章模型进入运行决策与优化方法。

## 习题

### 基础题

1. 为什么运行过程模型需要同时包含扰动项与噪声项？
2. 说明“三元混合模型”中规则层的作用。
3. 写出误差分级阈值用于运行门禁的基本逻辑。

### 应用题

4. 结合一个渠道或泵站场景，给出四类不确定性的实例并标注可能责任角色。  
5. 设计一个“连续超阈值触发”判据（给出 $N$ 与阈值建议）并说明理由。

### 思考题

6. 在“可解释但保守”和“高性能但黑箱”两类模型之间，运行团队应如何选择？请结合治理目标作答。

### 基础题参考答案要点

1. 扰动表示外界驱动变化，噪声表示不可避免的测量/过程随机误差，两者来源不同。  
2. 规则层把模型输出转化为可执行门禁条件，保证策略合法、可审计。  
3. 先按误差区间分级，再绑定自动与人工动作，保证响应一致性。

## 拓展阅读

1. Kalman, R.E. (1960). A New Approach to Linear Filtering and Prediction Problems.  
2. Ljung, L. (1999). *System Identification*.  
3. Lei et al. (2025b). 复杂水系统运行与自主控制架构。  
4. ISO 31000 (Risk Management Guidelines).  
5. Montgomery, D.C. (2019). *Introduction to Statistical Quality Control*.

> **术语一致性声明**：本章统一采用“运行设计域（Operational Design Domain, ODD）”“安全包络（Safety Envelope）”“最小风险状态（Minimal Risk State, MRS）”“水网操作系统（Water Network Operating System, HydroOS）”“在环测试（In-the-Loop Testing）”等规范术语；数学符号采用 $Q,h,\tau,T_p,T_c,\mathbf{x},\mathbf{u},\mathbf{y},J$。

### 质量检查清单（执行结果）

- [x] 章首学习目标、章末小结/习题/拓展阅读完整；
- [x] 基础题3 + 应用题2 + 思考题1，含基础题答案要点；
- [x] 公式前有物理直觉，公式后有工程解释；
- [x] 含可复现实例（例3-1）；
- [x] 图表不少于2项（图3-1、图3-2、表3-1、表3-2、表3-3）；
- [x] 章首回顾ch02，章末预告ch04；
- [x] 已补齐ch02评审提出的不确定性分类图、传播表达与超阈值处置模板。
