<!-- 变更日志
v1 2026-02-16: 初稿（基于“继续”命令自动续写）
-->

# ch04 实验三：在环联调与时延扰动验证

## 学习目标

1. 掌握本实验的基本原理和操作方法；
2. 理解实验数据的采集、处理和分析方法；
3. 培养水网智能控制系统的实践操作能力。


> **前章回顾**：上一章介绍了本领域的核心概念与方法。本章在此基础上进一步展开。


## 实验目的

完成本实验后，读者应能够：

1. 组织在环联调实验并明确角色分工；
2. 设计时延扰动工况并评估控制鲁棒性；
3. 识别联调失败模式并执行班组协同处置；
4. 形成联调报告并给出上线前改进建议；
5. 为后续综合实验提供验证基线。

> 承接 ch03：上一章完成策略对比与切换应急，本章进入多角色协同的在环联调验证。

## 实验原理

在环联调（In-the-Loop Testing）强调“控制策略—仿真对象—执行反馈”闭环一致性。相比离线对比，在环联调可暴露通信延迟、执行滞后与协同失配等问题。

可定义时延鲁棒性指标：

$$
DR = 1 - \frac{\Delta J_{delay}}{J_0}
$$

其中 $J_0$ 为无扰动代价，$\Delta J_{delay}$ 为时延扰动引起的代价增量。

[物理直觉] 时延会“拉开”感知与行动的时间差，闭环越依赖实时反馈，越容易受扰动影响。

[工程解释] 当 $DR$ 低于阈值时，说明策略对时延敏感，不宜直接上线。

## 在环联调分工表（补齐 ch03 跟踪项）

联调实验建议最少包含四类角色：

- 主操作员：执行联调步骤与策略下发；
- 安全监护员：监控安全包络与MRS触发条件；
- 数据记录员：记录关键字段与异常链路；
- 评估员：汇总指标并给出通过判定。

[表4-1: 在环联调分工表（补齐 ch03 跟踪项）]
{描述: 列包括角色、职责、关键操作、门禁权限、异常触发动作、签核要求。}
{尺寸: 全页}
{颜色方案: 灰度}

## 时延扰动工况字段（补齐 ch03 跟踪项）

建议至少设置三档时延工况：

- D1：轻度扰动（如 100ms）；
- D2：中度扰动（如 300ms）；
- D3：重度扰动（如 600ms）。

每档需记录：时延类型（固定/抖动）、持续时长、影响链路、恢复时间。

[表4-2: 时延扰动工况字段表（补齐 ch03 跟踪项）]
{描述: 列包括工况ID、时延幅值、扰动持续时间、作用对象、关键指标变化、风险等级、恢复判据。}
{尺寸: 全页}
{颜色方案: 灰度}

[工程解释] 统一字段可确保不同班组对“同一扰动”得到可比较结果。

## 联调失败后的班组协同清单（补齐 ch03 跟踪项）

当联调失败（指标越界或指令失配）时，按以下协同清单执行：

1. 安全监护员先触发 MRS 并冻结非必要操作；
2. 主操作员回滚至上一稳定策略；
3. 数据记录员锁定日志并标注失败链路；
4. 评估员组织快速复盘并判断是否重试；
5. 教师/助教签核后恢复实验。

[图4-1: 联调失败班组协同流程图]
{描述: 展示四角色协同处置路径与签核恢复节点。}
{尺寸: 半页}
{颜色方案: 蓝色系}

## 实验步骤

1. 按表4-1完成角色分配与权限确认；
2. 运行基准联调并记录 $J_0$；
3. 依次注入 D1-D3 时延扰动并记录 $DR$；
4. 若发生联调失败，按图4-1执行协同清单；
5. 输出“通过/有条件通过/不通过”结论。

## 数据记录表

| 批次 | 工况ID | 时延幅值 | 关键指标 | DR | 是否越界 | 联调结果 | 应急动作 | 恢复时间 | 备注 |
|---|---|---|---|---|---|---|---|---|---|
|  |  |  |  |  |  |  |  |  |  |

## 思考题

1. 在环联调与离线仿真相比，最大的验证价值是什么？
2. 为什么联调失败后必须先角色协同再技术重试？
3. 若D3工况频繁失败，应优先改策略还是改流程？

## 本章小结

本章完成了在环联调实验框架，补齐了分工表、时延扰动字段和联调失败协同清单，建立了“可分工、可扰动、可应急”的联调验证流程。下一章将进入多场景回归实验。

## 拓展阅读

1. HIL Testing Handbook (Industrial Control).  
2. IEC 61784 (Industrial Communication Networks).  
3. Lei et al. (2025c). 在环测试与运行验证体系。
