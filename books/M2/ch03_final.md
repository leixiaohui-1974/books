<!-- 变更日志
v1 2026-02-16: 初稿
-->

# ch03 线性MPC与明渠控制

## 学习目标

完成本章学习后，读者应能够：

1. 从明渠水动力模型构建线性化控制模型并用于MPC；
2. 理解采样周期、预测时域与控制时域在明渠场景下的配置逻辑；
3. 掌握约束建模（闸门、水位、动作率）与权重整定的工程方法；
4. 能够实现单渠段线性MPC并评估其跟踪与稳健性能；
5. 说明线性MPC在胶东调水场景中的适用边界与回退策略。

> 本章承接 ch02 理论基础：在保证递归可行性与稳定性的前提下，聚焦“如何将线性MPC落地到明渠控制”。

> **前章回顾**：上一章介绍了本领域的核心概念与方法。本章在此基础上进一步展开。


## 明渠控制对象的线性化建模

明渠系统本质上由 Saint-Venant 方程描述，工程中常通过工作点附近线性化与降阶处理获得可实时求解模型。设状态向量为 $\mathbf{x}$，输入为闸门开度 $\mathbf{u}$，输出为关键断面水位 $\mathbf{y}$，可写为：

$$
\mathbf{x}_{k+1}=\mathbf{A}\mathbf{x}_k+\mathbf{B}\mathbf{u}_k+\mathbf{E}\mathbf{d}_k,
\quad \mathbf{y}_k=\mathbf{C}\mathbf{x}_k
$$

其中 $\mathbf{d}_k$ 表示边界来水扰动。

[物理直觉] 对于扰动幅值有限且运行工况围绕设定点波动的场景，线性模型可较好捕捉“主导动态 + 时滞特征”。

## 预测模型与优化矩阵构造

将模型在预测窗口上展开，可得标准二次规划（QP）形式：

$$
\min_{\Delta\mathbf{U}} \frac{1}{2}\Delta\mathbf{U}^T\mathbf{H}\Delta\mathbf{U}+\mathbf{f}^T\Delta\mathbf{U}
$$

满足线性不等式约束：

$$
\mathbf{G}\Delta\mathbf{U}\le \mathbf{b}
$$

其中 $\Delta\mathbf{U}$ 为控制增量序列。矩阵 $\mathbf{H},\mathbf{f},\mathbf{G},\mathbf{b}$ 由系统矩阵、参考轨迹、约束上下界和权重系数共同构造。

[工程解释] 将问题转化为 QP 后，可直接调用工业求解器，实现毫秒到秒级在线优化。

[图3-1: 明渠线性MPC建模与QP求解流程]
{描述: 展示“线性化/辨识→预测矩阵构造→约束装配→QP求解→执行与反馈”流程。}
{尺寸: 全页}
{颜色方案: 蓝色系}

## 关键参数整定方法

### 3.4.1 时域参数

- 采样周期：与波传播时延与执行机构响应匹配；
- 预测时域 $T_p$：覆盖主要动态过程，通常大于主时滞；
- 控制时域 $T_c$：一般取 $T_c\le T_p$，平衡性能与计算量。

### 3.4.2 权重参数

- 跟踪权重 $Q_y$ 高：水位跟踪更紧，但动作更频繁；
- 控制增量权重 $R_u$ 高：动作更平滑，但响应可能变慢；
- 终端权重 $P$：改善收敛与稳态误差。

### 3.4.3 约束参数

- 水位上下限：来自安全包络（Safety Envelope）；
- 闸门开度与变化率：来自设备规范与运维要求；
- 异常回退触发阈值：来自上线门禁策略。

[表3-1: 线性MPC参数整定建议区间]
{描述: 列出采样周期、Tp/Tc、Qy/Ru、开度与动作率约束的建议范围与调参提示。}
{尺寸: 半页}
{颜色方案: 灰度}

## 可复现实例：单渠段水位跟踪控制

【例3-1】某明渠段长度 12 km，采样周期 5 min。线性模型已辨识完成，配置如下：

- 预测时域 $T_p=15$，控制时域 $T_c=5$；
- 水位约束 $h\in[2.70,3.20]$ m；
- 闸门动作率约束 $\Delta u\in[-1.5\%,1.5\%]$；
- 扰动为上游来水在 30 min 内增加 8%。

**求解**：给出参数整定思路并判断如何兼顾“快速抑制波动”与“动作平滑”。

**解题过程**：

1. 初始设置中等 $Q_y$ 与中等 $R_u$，确保可行且不过冲；
2. 若跟踪滞后明显，适度增大 $Q_y$ 或延长 $T_p$；
3. 若动作过于频繁，增大 $R_u$ 并收紧动作率约束；
4. 持续监测约束触发率，超过阈值时启用保守参数组。

**结果讨论**：
线性MPC可在保证约束满足的前提下显著改善水位波动。实际部署中推荐“性能参数组 + 保守参数组”双配置，并支持一键切换。

## 适用边界与失效模式

线性MPC在以下场景效果较好：

- 工况围绕标称点波动；
- 非线性程度中等且可由局部线性近似；
- 执行器与传感器状态稳定。

可能失效场景：

- 工况跨越多个运行区导致模型失配严重；
- 冰期/检修导致参数突变；
- 通信异常导致状态估计失真。

应对策略：

- 建立分工况模型集与参数切换逻辑；
- 引入软约束与回退 PI/MPC；
- 在 ch06 引入鲁棒MPC处理不确定性。

## 本章小结

本章完成了线性MPC在明渠控制中的工程化闭环：从线性化模型、QP构造到参数整定与上线策略，形成了可直接部署的实现路径。核心经验是：线性MPC的价值在于“约束可控 + 在线可解 + 运维可管”，而非盲目追求最复杂模型。下一章将扩展到非线性MPC与管网控制。

## 习题

### 基础题

**3-1.** 为什么线性化模型仍可用于明渠MPC的工程部署？
**3-2.** 解释 $T_p$、$T_c$、采样周期三者的协同关系。
**3-3.** $Q_y$ 与 $R_u$ 的调节分别会带来什么控制表现变化？

### 应用题

**3-4.** 给定一组明渠状态空间模型与约束，写出QP标准形式中的 $\mathbf{H},\mathbf{f},\mathbf{G},\mathbf{b}$ 组成思路。  
**3-5.** 设计“性能参数组/保守参数组”的切换规则，并给出触发阈值建议。

### 思考题

**3-6.** 在极端工况下，若线性MPC频繁触发回退，你会优先改进模型、约束、还是调度目标？请给出决策依据。

### 基础题参考答案要点

**3-7.** 因为在局部运行区间内线性近似可捕捉主导动态，且在线求解效率高。  
**3-8.** 采样周期决定控制刷新频率，$T_p$ 决定前瞻深度，$T_c$ 决定可调动作窗口。  
**3-9.** 增大 $Q_y$ 强化跟踪，增大 $R_u$ 强化平滑；两者需平衡。

## 拓展阅读

1. **Camacho, E.F. & Bordons, C. (2007). *Model Predictive Control*.**
2. **Rawlings, J.B., Mayne, D.Q. & Diehl, M. (2017). *Model Predictive Control: Theory, Computation, and Design*.**
3. **Van Overloop, P.J. (2006). *Model Predictive Control on Open Water Systems*.**
4. **Litrico, X. & Fromion, V. (2009). *Modeling and Control of Hydrosystems*.**
5. **Lei et al. (2025b). 自主智能水网架构。**
