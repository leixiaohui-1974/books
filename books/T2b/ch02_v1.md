<!-- 变更日志
v1 2026-02-16: 初稿
-->

# 第二章 机器学习基础

---

## 学习目标

完成本章后，你应能够：

1. 说明监督学习、无监督学习与半监督学习在水系统中的适用边界；
2. 掌握训练集/验证集/测试集划分与交叉验证流程；
3. 比较 SVM、随机森林（RF）与 GBDT 在典型水利任务中的优缺点；
4. 设计可落地的数据清洗、特征工程与模型评估管线；
5. 识别机器学习模型上线的风险并给出回退策略。

> **章首衔接（承接ch01）**  
> 上一章回答了“为什么要从控制走向智能”。本章进入可执行层面：先建立机器学习基础方法，再讨论如何把模型安全接入 CHS 运行体系。

## 2.1 机器学习任务类型与水系统场景

[物理直觉] 水系统数据常呈现时变、噪声和缺测特征，模型任务必须服务于工程目标，而不是脱离场景追求算法复杂度。

- **监督学习**：用于预测流量、水位、负荷、故障标签等；
- **无监督学习**：用于工况聚类、异常模式识别；
- **半监督学习**：用于标签稀缺场景（如故障样本少）。

[表2-1: 任务类型与工程应用]
| 任务类型 | 典型输入 | 典型输出 | 代表应用 |
|---|---|---|---|
| 监督学习 | 历史工况特征 | 连续值/类别标签 | 来水预测、故障分类 |
| 无监督学习 | 多变量运行数据 | 聚类标签/异常分数 | 工况分群、异常检测 |
| 半监督学习 | 少量标注+大量未标注 | 预测标签 | 低频故障识别 |

## 2.2 数据集划分与交叉验证

### 2.2.1 数据划分原则

- 训练集用于参数学习；
- 验证集用于超参数选择；
- 测试集用于最终泛化评估。

[工程要点] 水系统时间序列任务禁止随机打乱后切分，推荐按时间前后切分，防止“未来信息泄漏”。

### 2.2.2 交叉验证

K折交叉验证用于稳定估计模型性能，但在时序任务中应采用滚动窗口或时间块交叉验证。

[图2-1: 时序交叉验证示意]
{描述: 展示滚动窗口训练-验证过程，避免未来样本泄漏。}
{尺寸: 半页}
{颜色方案: 蓝色系}
{对应ARCH编号: ARCH-06}

## 2.3 常用模型：SVM、RF、GBDT

### 2.3.1 支持向量机（SVM）

优点：小样本条件下稳定；缺点：大规模样本训练耗时高。

### 2.3.2 随机森林（RF）

优点：鲁棒、抗噪；缺点：对时间依赖关系表达有限。

### 2.3.3 梯度提升树（GBDT）

优点：结构化特征表现强；缺点：参数敏感、过拟合风险需抑制。

[工程解释] 在水系统结构化特征任务中，RF/GBDT常作为基线模型，便于可解释分析与快速部署。

## 2.4 特征工程与评估指标

### 2.4.1 特征工程

- 缺测补全与异常值处理；
- 时间特征（时段、季节、节假日）；
- 水文特征（滞后项、移动统计量）；
- 工程特征（闸位、泵频、设备状态）。

### 2.4.2 评估指标

回归任务可采用 MAE、RMSE；分类任务可采用 Precision、Recall、F1。

[公式前直觉] 误差指标不仅反映预测精度，也影响控制器容错设计。

\[
\text{MAE}=\frac{1}{N}\sum_{i=1}^{N}|\hat{y}_i-y_i|,
\quad
\text{RMSE}=\sqrt{\frac{1}{N}\sum_{i=1}^{N}(\hat{y}_i-y_i)^2}
\]

[工程意义] 若 RMSE 显著高于 MAE，通常意味着存在少量大误差样本，应重点排查极端工况和传感异常。

## 2.5 机器学习模型的工程上线门禁

模型上线必须通过“精度门禁 + 安全门禁 + 治理门禁”：

1. 精度门禁：达到业务阈值并通过回归评估；
2. 安全门禁：输出不触发 ODD/Safety Envelope 冲突；
3. 治理门禁：具备版本可追溯、回滚与审计日志。

[图2-2: 机器学习模型上线门禁流程]
{描述: 数据准备→训练验证→离线评测→在环验证→灰度上线→运行监测与回退。}
{尺寸: 全页}
{颜色方案: 蓝色系}
{对应ARCH编号: ARCH-06}

## 2.6 例题：来水预测模型选型

【例2-1】某调水系统需预测未来6小时入渠流量，已准备两年数据。候选模型为 SVM、RF、GBDT。

**已知**：
- 数据存在季节性与节律性；
- 极端天气样本占比低；
- 业务要求“误差可控 + 模型可回退”。

**求解**：给出模型选型与验证流程。

**解题过程**：

步骤1：采用时间块切分训练/验证/测试集。  
步骤2：以 MAE、RMSE 评估三模型，并比较极端工况误差。  
步骤3：分析可解释性与部署复杂度，确定基线模型。  
步骤4：通过 SIL 回放验证预测误差对控制策略的影响。  
步骤5：上线采用灰度发布，异常时回退到规则基线。

**结果讨论**：

工程选型不应只看平均误差，还应关注极端工况稳定性与治理可控性。

### 机器学习章节上线检查清单

- [ ] 是否完成时间泄漏检查与数据质量审计；
- [ ] 是否明确训练/验证/测试划分口径；
- [ ] 是否完成回归/分类指标与阈值定义；
- [ ] 是否完成在环影响评估与灰度回退预案；
- [ ] 是否建立模型版本、数据版本与日志关联。

## 2.7 本章小结

本章建立了机器学习基础框架：任务定义、数据划分、模型选型、特征工程、评估指标与工程门禁。核心结论是：在水系统场景中，机器学习模型的价值取决于“泛化性能 + 安全约束 + 治理能力”的共同达标。下一章将进入深度学习与时空建模方法。

## 习题

### 基础题

1. 为什么时序任务不宜随机切分训练集与测试集？  
2. SVM、RF、GBDT 的典型优势分别是什么？  
3. 为什么模型上线必须同时满足精度门禁与治理门禁？

### 应用题

4. 设计一个用于水位预测的特征工程方案（至少包含5类特征）。  
5. 设计“模型误差升高时的降级与回退”运行流程。

### 思考题

6. 在模型精度略优但解释性明显更差时，工程上线应如何决策？

## 拓展阅读

1. Hastie, Tibshirani, Friedman. *The Elements of Statistical Learning*.  
2. Géron, A. *Hands-On Machine Learning*.  
3. Goodfellow, I., Bengio, Y., Courville, A. *Deep Learning*.  
4. Lei et al. (2025b). 自主智能水网架构。  
5. ASCE (2014). *MOP 131: Canal Automation for Irrigation Systems*.
