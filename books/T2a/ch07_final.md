<!-- 变更日志
v2 2026-02-16: 根据四角色评审修订——补充术语一致性声明与基础题答案要点，强化教学闭环
v1 2026-02-16: 初稿
-->

# 第七章 模型预测控制（MPC）

---

## 学习目标

完成本章后，你应能够：

1. 解释模型预测控制（Model Predictive Control, MPC）的滚动优化机理；
2. 构建含状态约束与输入约束的线性MPC基本问题；
3. 区分线性MPC、非线性MPC与分布式MPC的适用边界；
4. 理解预测时域 \(T_p\) 与控制时域 \(T_c\) 的工程含义及选取原则；
5. 将MPC与ODD/Safety Envelope联锁及在环测试流程对接。

> **章首衔接（承接ch06）**  
> 上一章给出现代控制框架与状态空间表达。本章进一步在显式约束下实现“预测—优化—执行”闭环，形成从状态反馈到滚动优化控制的关键跃迁。

> **前章回顾**：上一章介绍了本领域的核心概念与方法。本章在此基础上进一步展开。


## MPC的基本思想

[物理直觉] 水系统控制不应只看当前误差，还要看未来一段时间内约束是否会被触碰。MPC的核心是“先预测未来，再优化当前动作”。

每个采样时刻，MPC执行：
1. 用模型预测未来 \(T_p\) 时域状态轨迹；
2. 求解最优控制序列；
3. 只执行第一步控制量；
4. 下一时刻滚动重复。

## 线性MPC标准形式

### 7.2.1 预测模型

[公式]
\[
\mathbf{x}_{k+1}=\mathbf{A}\mathbf{x}_k+\mathbf{B}\mathbf{u}_k,
\quad \mathbf{y}_k=\mathbf{C}\mathbf{x}_k
\]

### 7.2.2 优化问题

[公式]
\[
\min_{\mathbf{u}_{k:k+T_c-1}} \sum_{i=1}^{T_p}\|\mathbf{y}_{k+i|k}-\mathbf{r}_{k+i}\|_{\mathbf{Q}}^2+
\sum_{i=0}^{T_c-1}\|\Delta \mathbf{u}_{k+i}\|_{\mathbf{R}}^2
\]

约束：
\[
\mathbf{x}_{k+i|k}\in\mathcal{X}_{safe}\subseteq\mathcal{X}_{ODD},
\quad \mathbf{u}_{k+i|k}\in\mathcal{U},
\quad \Delta\mathbf{u}_{k+i|k}\in\Delta\mathcal{U}
\]

[工程解释] 目标函数第一项强调跟踪性能，第二项抑制控制抖动；约束项确保方案“可执行且安全”。

[表7-1: MPC关键参数的工程含义]
| 参数 | 作用 | 取值过小风险 | 取值过大风险 |
|---|---|---|---|
| \(T_p\) | 预测未来窗口 | 远期风险看不见 | 计算负担增大 |
| \(T_c\) | 可优化控制步长 | 策略僵硬 | 自由度过高导致不稳 |
| \(\mathbf{Q}\) | 跟踪性能权重 | 偏差收敛慢 | 动作激进 |
| \(\mathbf{R}\) | 动作平滑权重 | 控制抖动 | 跟踪变慢 |

## 非线性MPC与分布式MPC

### 7.3.1 非线性MPC

当对象非线性显著（如闸门工况切换、强耦合非线性水力过程）时，非线性MPC可提升精度，但需平衡求解时间与实时性。

### 7.3.2 分布式MPC

跨区域水网可将全局问题分解为子问题并协调迭代，降低单点计算压力。工程关键在于协调机制和通信延迟鲁棒性。

[图7-1: 集中式与分布式MPC架构对比]
{描述: 左侧集中式单优化器，右侧多子区优化器+协调层，底部标注通信周期与一致性条件。}
{尺寸: 全页}
{颜色方案: 蓝色系}
{对应ARCH编号: ARCH-04（分层协同思想借鉴）}

## MPC与安全联锁

MPC并非替代安全联锁，而是受其约束。建议将安全包络越界处理与MPC解算状态联动：

- 求解失败或超时：切换保守控制；
- 预测越界：触发约束收缩与降级策略；
- 持续异常：人工接管并记录审计日志。

[图7-2: MPC求解状态与安全联锁状态机]
{描述: 展示“正常求解→约束收缩→保守模式→人工接管”状态迁移，标注触发条件。}
{尺寸: 半页}
{颜色方案: 蓝色系}
{对应ARCH编号: ARCH-07（安全分区思想借鉴）}

## 例题：调水渠段线性MPC配置

【例7-1】某调水渠段目标为“流量跟踪误差最小且闸门动作平滑”，已获得线性ROM。请给出MPC初始配置与上线判定流程。

**已知**：
- 已有离散状态空间模型；
- 闸门开度与变化率受限；
- 安全包络与ODD边界已定义。

**解题过程**：

步骤1：设定 \(T_p\) 覆盖主导时滞，\(T_c\) 取较短控制窗口保证实时性。  
步骤2：先取保守 \(\mathbf{R}\) 抑制动作，再逐步提高 \(\mathbf{Q}\) 改善跟踪。  
步骤3：在在环测试中检查越界率、求解时长与恢复时间。  
步骤4：定义解算超时回退策略并分阶段上线。

**结果讨论**：

MPC上线成败不只取决于预测精度，还取决于“约束建模完整性+回退机制可执行性”。

### MPC上线检查清单

- [ ] 是否验证求解器在目标采样周期内稳定收敛；
- [ ] 是否完成 \(\mathcal{X}_{safe}\subseteq\mathcal{X}_{ODD}\) 约束一致性校核；
- [ ] 是否定义求解失败/超时回退策略；
- [ ] 是否通过在环测试覆盖关键扰动场景；
- [ ] 是否完成分级上线与审计追踪。

## 本章小结

本章构建了MPC的工程应用主线：线性MPC标准问题、非线性与分布式扩展、安全联锁集成与上线门禁流程。核心结论是：MPC的价值在于“可预测+可约束+可回退”的综合能力。下一章将进入优化理论与方法，系统讨论求解器与算法选择。

## 习题

### 基础题

**7-1.** 说明 \(T_p\) 与 \(T_c\) 的区别及其工程意义。  
**7-2.** 为什么MPC每次只执行最优序列的第一步？  
**7-3.** 解释 \(\mathbf{Q}\) 与 \(\mathbf{R}\) 在目标函数中的作用。

### 基础题参考答案要点

**7-4.** \(T_p\) 是预测窗口，\(T_c\) 是优化控制窗口；前者偏向看得远，后者偏向算得动。  
**7-5.** 仅执行第一步可利用下一时刻新测量滚动纠偏，增强抗扰与鲁棒性。  
**7-6.** \(\mathbf{Q}\) 强调跟踪性能，\(\mathbf{R}\) 抑制控制动作幅度与抖动。

### 应用题

**7-7.** 为某双闸门渠段给出线性MPC最小化问题（含约束集合）并说明参数初值。  
**7-8.** 某场景中求解器偶发超时，请提出两类工程修正策略并比较优缺点。

### 思考题

**7-9.** 在“预测精度提升”和“求解实时性保障”冲突时，你会如何制定上线优先级？

## 拓展阅读

1. Rawlings, J.B., Mayne, D.Q., & Diehl, M. *Model Predictive Control: Theory, Computation, and Design*.
2. Van Overloop, P.J. *Model Predictive Control on Open Water Systems*.
3. Litrico, X., & Fromion, V. *Modeling and Control of Hydrosystems*.
4. ASCE (2014). *MOP 131: Canal Automation for Irrigation Systems*.
5. Lei et al. (2025a). 理论背景与研究范式。
