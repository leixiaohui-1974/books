---
name: academic-writer
description: 学术写作全流程技能——覆盖报告、书稿、SCI论文、中文核心期刊论文、发明专利、国内标准、国际标准、公众号文章、演示文稿九大文体，实现"写作→多角色评审→修改→迭代"闭环，持续优化直到达到发表/授权/颁布标准。支持批量写作、进度追踪、跨文档一致性检查。
---

# 学术写作全流程技能 (Academic Writer)

> 统一的"写—审—改—迭代"引擎，覆盖九大文体

---

## 0. 快速启动

### 用户指令

| 指令 | 示例 | 效果 |
|------|------|------|
| **开始[类型][编号]** | `开始SCI-P1a` `开始专利PF2-3` `开始书稿M1-ch03` | 启动指定文档的写作全流程 |
| **自然语言触发** | `写篇公众号` `做个PPT` `写个标准` `写国际标准` | 启动对应文体，进入讨论→提纲→写作流程 |
| **继续** | `继续` | 从中断处恢复，自动读取进度文件 |
| **状态** | `状态` `进度` | 查看当前所有文档的写作进度 |

### 支持的文档类型代号

| 代号 | 文体 | 说明 |
|------|------|------|
| `RPT` | 技术报告/研究报告 | 项目报告、可研报告、技术方案 |
| `BK` | 书稿/专著/教材 | 章节制，逐章写作评审 |
| `SCI` | SCI英文论文 | 针对WRR/Nature Water等国际顶刊 |
| `CN` | 中文核心期刊论文 | 针对水利学报/中国科学等 |
| `PAT` | 发明专利 | 中国发明专利申请文件 |
| `STD-CN` | 国内技术标准 | GB/T、SL/T、DB、T/ 行业标准/团体标准/企业标准 |
| `STD-INT` | 国际技术标准 | ISO、IEC、OGC、IWA、IAHR技术报告 |
| `WX` | 微信公众号文章 | 科普/行业分析/观点输出，手机阅读优化 |
| `PPT` | 演示文稿 | 学术汇报/项目答辩/产品发布/国际会议演讲 |

---

## 1. 核心架构：写—审—改闭环

```
用户指令 → 读取规格 → [写作] → [多角色评审] → 达标？
                                    ↑         ↓ 否
                                    └── [修改] ←┘
                                          ↓ 是
                                    保存终稿 → 更新进度 → 提示"继续"
```

### 1.1 通用迭代流程

**所有文体共享此流程，仅评审角色和质量标准因文体而异。**

1. **读取规格**：从项目配置或用户指令中获取文档的完整写作规格（提纲、字数、目标期刊/出版社、格式要求）
2. **背景检索**：用 web_search 检索相关文献/专利/标准，确认创新性/新颖性
3. **撰写初稿**：按文体模板完成全文初稿
4. **多角色评审**：Claude 依次扮演多个评审角色（因文体而异，见§2），参照 `references/scoring_rubrics.md` 锚点标准逐维度打分并给出修改意见
5. **汇总评分**：综合各角色评分，判定是否达标
6. **未达标→修改**：逐条回应评审意见，输出新版本，回到步骤4
7. **达标→终稿**：保存最终版本，更新进度追踪文件
8. **循环上限**：最多迭代 N 轮（SCI/CN: 20轮，PAT: 4轮，BK: 6轮，RPT: 3轮，STD-CN/STD-INT: 4轮，WX: 5轮，PPT: 4轮），超出则标记"建议人工审核"

### 1.2 达标标准

| 文体 | 达标条件 | 评分制 |
|------|---------|--------|
| SCI | 连续2轮所有评审角色给出"小修"或"接受" | Major/Minor/Accept |
| CN | 连续2轮所有评审角色给出"小修"或"接受" | Major/Minor/Accept |
| PAT | 综合评分 ≥ 7.5/10 | 1-10 数值打分 |
| BK | 综合评分 ≥ 8.0/10 且无🔴标记 | 🔴/🟡/🟢 三级 |
| RPT | 综合评分 ≥ 7.0/10 | 1-10 数值打分 |
| STD-CN | 综合评分 ≥ 8.0/10 且条文合规率100%（GB/T 1.1-2020） | 1-10 + 合规检查 |
| STD-INT | 综合评分 ≥ 8.0/10 且条文合规率100%（ISO/IEC Directives Part 2） | 1-10 + 合规检查 |
| WX | 综合评分 ≥ 7.5/10 且无🔴标记，自动检查脚本通过 | 1-10 + 脚本检查 |
| PPT | 综合评分 ≥ 7.5/10 且无🔴标记，风格指南合规 | 1-10 + 设计检查 |

---

## 2. 九大文体的评审角色配置

> **写作技法**: 撰写初稿时须参照 `references/writing_craft_guide.md` 中的文体技法和句型库。
> **金标准片段**: 撰写和评审时须参照 `references/gold_standard_fragments.md` 中的优秀范文片段。
> **评分锚点**: 评审打分时须参照 `references/scoring_rubrics.md` 中的量化锚点标准。9-10=卓越 / 7-8=良好 / 5-6=一般 / <5=不合格。

### 2.1 SCI英文论文 — 三角色评审

| 角色 | 身份 | 评审维度 |
|------|------|---------|
| **Reviewer A** | 该领域顶刊资深审稿人 | 创新性、理论深度、数学严谨性、文献完备性 |
| **Reviewer B** | 方法论专家 | 实验设计、可重复性、数据分析、统计显著性 |
| **Reviewer C** | 应用领域工程师 | 工程可行性、案例说服力、实际影响力 |

**评审输出格式**：
```
## Reviewer [A/B/C] 评审意见

**Decision**: [Major Revision / Minor Revision / Accept]

**Summary**: 一段话总结论文贡献和主要问题

**Specific Comments**:
1. [具体意见 + 修改建议]
2. ...（至少5条）

**Minor Issues**: 语法、格式、引用等细节问题

═══ SCI论文评审汇总 ═══
Reviewer A: [Major/Minor/Accept]  关键意见: [摘要]
Reviewer B: [Major/Minor/Accept]  关键意见: [摘要]
Reviewer C: [Major/Minor/Accept]  关键意见: [摘要]
综合判定: [达标(连续2轮全Minor/Accept) / 未达标]
```

**SCI专有规则**：
- 参考文献 ≥ 30篇，近5年占比 ≥ 50%，会议论文≤20%
- 自引率控制在 15-25%（含Lei 2025a-d系列）
- 引用格式须与目标期刊完全一致（投稿前web_search确认最新Author Guidelines）
- 每条参考文献必须真实可查——用web_search验证DOI/标题
- 所有公式必须编号，关键公式需推导过程
- 图表标题和正文对图表的引用必须完整
- 数据可用性声明（Data Availability Statement）必须包含

### 2.2 中文核心期刊论文 — 三角色评审

| 角色 | 身份 | 评审维度 |
|------|------|---------|
| **审稿人A** | 学科专家 | 理论创新性、学术规范、文献综述深度 |
| **审稿人B** | 工程应用专家 | 工程实用性、案例数据可信度、成果推广价值 |
| **审稿人C** | 期刊编辑视角 | 行文逻辑、中文学术写作规范、图表质量、参考文献格式 |

**中文论文专有规则**：
- 中英文摘要必须对应，英文摘要 200-300 words
- 关键词中英文各 3-8 个
- **参考文献**：格式严格遵循 GB/T 7714-2015（每条含[J]/[M]/[C]等类型标识）
- 参考文献 ≥ 20篇，近5年占比 ≥ 40%，自引率10-20%
- 每条文献必须真实可查，**绝不编造**
- 基金项目信息必须准确完整
- 量和单位符合 GB 3101/3102
- 工程案例数据须注明来源和时间范围

**评审输出格式**：
```
═══ 中文核心期刊论文评审汇总 ═══
文件: [标题]  |  目标期刊: [期刊名]

审稿人A（学科）: [大修/小修/录用]
  意见: 1. ... 2. ...（至少5条）

审稿人B（工程）: [大修/小修/录用]
  意见: 1. ... 2. ...（至少5条）

审稿人C（编辑）: [大修/小修/录用]
  意见: 1. ... 2. ...

综合判定: [达标(连续2轮全小修/录用) / 未达标]
```

### 2.3 发明专利 — 三角色评审

| 角色 | 身份 | 评审维度 |
|------|------|---------|
| **审查员** | 专利审查员 | 新颖性、创造性、充分公开、权利要求完整性、实用性 |
| **代理人** | 资深专利代理人 | 保护范围适当性、从属权利要求层次、与同族群专利区分度 |
| **技术专家** | 水利自动化技术专家 | 公式算法正确性、技术效果可信度、工程可实施性 |

**专利专有规则**：
- 七部分结构：技术领域、背景技术、发明内容、附图说明、具体实施方式、权利要求书（8-15项）、摘要
- 独立权利要求采用"前序+特征"两段式
- 从属权利要求逐层细化，覆盖关键技术特征
- 背景技术引用的现有技术必须用 web_search 验证真实性
- 权利要求书措辞必须和发明内容中技术方案严格一致
- 具体实施方式至少一个完整实施例含具体参数
- 摘要 150-300 字
- 初稿前先检索5篇最接近的已有专利确认新颖性

**评审权重**: 审查员40% + 代理人30% + 技术专家30%

**评审输出格式**：
```
═══ 发明专利评审汇总 ═══
文件: [专利名称]  |  权利要求数: X项

审查员 (40%): X/10
  新颖性: 通过/未通过  |  创造性: 通过/未通过
  意见: 1. ... 2. ...

代理人 (30%): X/10
  保护范围: 偏宽/适当/偏窄
  意见: 1. ... 2. ...

技术专家 (30%): X/10
  意见: 1. ... 2. ...

加权均分: X/10
达标判定: [达标(≥7.5) / 未达标]
```

### 2.4 书稿/教材/专著 — 四角色评审

| 角色 | 身份 | 评审维度 |
|------|------|---------|
| **教师** | 学科教师 | 教学可用性、知识递进逻辑、例题/思考题质量 |
| **专家** | 学科资深学者 | 学术准确性、理论深度、前沿覆盖度 |
| **工程师** | 行业工程师 | 工程实用性、案例真实性、操作指导价值 |
| **国际读者** | 英文版跨文化评审 | 术语准确性、表达可达性、国际读者理解障碍 |

**评审输出格式**：
```
## [角色名] 评审

**总评**: 🟢/🟡/🔴

**评分**:
- 内容准确性: X/10
- 教学效果: X/10
- 实用价值: X/10
- 写作质量: X/10
- 图表质量: X/10

**必须修改 (🔴)**: ...
**建议修改 (🟡)**: ...
**锦上添花 (🟢)**: ...

═══ 书稿评审汇总 ═══
教师: X/10  |  专家: X/10  |  工程师: X/10  |  国际读者: X/10
均分: X/10
达标判定: [达标(≥8.0且无🔴) / 未达标]
```

**书稿专有规则**：
- 逐章写作，每章完成一轮完整评审后再进入下一章
- 章与章之间需要衔接检查（前一章末尾500字 + 当前章开头500字）
- 术语首次出现必须给出定义，后续使用统一术语
- 每章末尾包含本章小结和思考题（教材类）
- 跨章一致性：核心概念、符号、图表编号全书统一
- **参考文献（强制要求，见 `references/citation_style_guide.md` §5）**：
  - 格式严格遵循 GB/T 7714-2015，每条含文献类型标识（[J]/[M]/[C]/[D]/[S]等）
  - 教材：每章末参考文献 ≥ 10篇，全书 ≥ 100篇
  - 专著：每章末参考文献 ≥ 15篇，全书 ≥ 200篇
  - 近5年文献占比：教材 ≥ 30%，专著 ≥ 40%
  - 英文文献占比：教材 ≥ 30%，专著 ≥ 50%
  - 必须包含该领域经典/奠基性文献（如Wylie 1969, Malaterre 1998, Litrico & Fromion 2009）
  - **每条文献必须真实可查，绝不编造**——这是学术出版的绝对底线
  - 全书参考文献编号体系一致（各章独立编号或全书统一编号，二选一，不可混用）
  - 每章可附"推荐阅读"（不计入正式文献列表）

### 2.5 技术报告 — 双角色评审

| 角色 | 身份 | 评审维度 |
|------|------|---------|
| **技术审查人** | 项目委托方技术负责人(60%) | 技术方案完整性、数据可靠性、结论合理性 |
| **管理审查人** | 项目管理者(40%) | 报告结构、执行摘要质量、建议可操作性、经费合理性 |

**报告专有规则**：
- 执行摘要（Executive Summary）必须独立可读
- 数据图表必须有明确来源和时间标注
- 结论和建议必须可追溯到报告正文
- 语言正式、避免主观表述
- **参考文献**：格式遵循 GB/T 7714-2015，≥ 10篇，每条必须真实可查
- 报告中引用的所有数据必须标注来源机构和时间（如"据水利部2024年统计"）

**评审输出格式**：
```
═══ 技术报告评审汇总 ═══
文件: [报告名称]  |  类型: [项目报告/可研报告/技术方案/验收报告]

技术审查人 (60%): X/10
  意见: 1. ... 2. ...（至少5条）

管理审查人 (40%): X/10
  执行摘要测试: 通过/未通过
  意见: 1. ... 2. ...（至少5条）

加权均分: X/10
达标判定: [达标(≥7.0) / 未达标]
```

### 2.6 国内技术标准(STD-CN) — 三角色评审

| 角色 | 身份 | 评审维度 |
|------|------|---------|
| **标准化专家** | 标准化技术委员会委员，精通GB/T 1.1-2020 | GB/T 1.1合规、前言要素、条文用语（应/宜/可/不应/不宜）、引用标准有效性、术语定义法、量和单位 |
| **技术专家** | 水利自动化领域教授级高工 | 技术指标取值依据、WSAL分级合理性、测试方法可行性、与CHS体系一致性、协议覆盖度 |
| **实施方代表** | 水利工程集成企业技术总监 | 可操作性、指标可达性、检测成本与周期、兼容现有SCADA升级、中小型工程可行性 |

**国内标准专有规则**：
- 严格遵循 GB/T 1.1-2020《标准化工作导则 第1部分》
- 结构：前言→引言→范围→规范性引用文件→术语和定义→正文各章→附录→参考文献
- 规范性引用文件必须用 web_search 逐一确认现行有效
- 条文用语：「应」=强制/「宜」=推荐/「可」=允许/「不应」=禁止/「不宜」=不推荐
- 技术指标必须有依据（实验数据、工程经验或理论计算）
- 规范性附录标注"(规范性)"、资料性附录标注"(资料性)"
- 量和单位符合 GB 3101/3102，ICS分类号正确
- 水利行标(SL/T)须符合水利部编写要求，与已有SL 75、SL 426协调

**评审权重**: 标准化专家40% + 技术专家35% + 实施方代表25%

**评审输出格式**：
```
═══ 国内标准评审汇总 ═══
文件: [SL/T XXXX] [标题]  |  标准层级: [GB/T / SL/T / DB / T/]

标准化专家 (40%): X/10  |  条文合规率: X%
  意见: 1. ... 2. ...

技术专家 (35%): X/10
  意见: 1. ... 2. ...

实施方代表 (25%): X/10
  意见: 1. ... 2. ...

加权均分: X/10
达标判定: [达标(≥8.0且合规率100%) / 未达标]
```

**参考范例**：`research-materials/reports/SLT_水网智能调控系统技术要求_V3_征求意见稿.docx`

> **注**：地方标准(DB)和团体标准(T/)在结构上与行标(SL/T)一致，但归口单位和审批流程不同，前言中须相应调整。

### 2.7 国际技术标准(STD-INT) — 三角色评审

| 角色 | 身份 | 评审维度 |
|------|------|---------|
| **ISO标准化专家** | ISO/TC资深专家，精通ISO/IEC Directives Part 2 | 结构合规、术语符合ISO 704、条文用语（shall/should/may）、英法双语标题、文件阶段标识、与SAE J3016/IEC 62443/ISO 21448对标 |
| **国际水利专家** | IAHR/IWA高级会员，非中国背景 | 国际普适性、术语国际通用性、中国案例适度引用、SI单位制、覆盖多国实践、与ISO 24591关系、英文表述规范 |
| **工业界代表** | 国际水利自动化企业CTO级别 | 技术壁垒/厂商偏向风险、FMI/DDS/OPC UA工业实现度、SIL/HIL成本-收益、IPR声明、过渡期安排 |

**国际标准专有规则**：
- 严格遵循 ISO/IEC Directives Part 2
- 结构：Foreword→Introduction→Scope→Normative references→Terms and definitions→正文→Annexes→Bibliography
- 条文用语：「shall」=强制/「should」=推荐/「may」=允许/「shall not」/「should not」
- 术语须引用ISO Online Browsing Platform (OBP)中已有术语
- 必须提供法文标题（ISO要求英法双语）
- 文件阶段标识须正确（WD/CD/DIS/FDIS/IS）
- Normative Annex与Informative Annex须正确标注
- 知识产权(IPR)声明须完整

**评审权重**: ISO标准化专家40% + 国际水利专家35% + 工业界代表25%

**评审输出格式**：
```
═══ 国际标准评审汇总 ═══
文件: [ISO/CD XXXXX] [标题]  |  阶段: [WD/CD/DIS/FDIS]

ISO标准化专家 (40%): X/10  |  条文合规率: X%
  意见: 1. ... 2. ...

国际水利专家 (35%): X/10
  意见: 1. ... 2. ...

工业界代表 (25%): X/10
  意见: 1. ... 2. ...

加权均分: X/10
达标判定: [达标(≥8.0且合规率100%) / 未达标]
```

**参考范例**：`research-materials/reports/ISO_CD_XXXXX_Water_Network_Intelligent_Control_Draft.docx`

### 2.8 微信公众号文章 — 三角色评审

| 角色 | 身份 | 评审维度 |
|------|------|---------|
| **读者代表** | 目标受众（工程师/决策者/泛科普） | 3秒吸引力、走神点、核心观点可提炼性、转发意愿 |
| **编辑** | 公众号运营编辑 | 手机排版、段落长度、禁用词、自动检查脚本通过率 |
| **领域专家** | CHS/智慧水利技术专家 | 数据准确性、百分比反算、因果链、术语准确性 |

**评审权重**: 读者代表40% + 编辑30% + 领域专家30%

**评审输出格式**：
```
═══ 公众号文章评审汇总 ═══
文件: [标题]  |  字数: XXXX字

读者代表 (40%): X/10
  3秒测试: 通过/未通过  |  走神点: [位置]
  意见: 1. ... 2. ...（至少5条）

编辑 (30%): X/10
  自动检查: 🔴X项 / 🟡X项 / ⚪X项
  意见: 1. ... 2. ...

领域专家 (30%): X/10
  数据验证: X处数据，Y处已验证，Z处存疑
  意见: 1. ... 2. ...

加权均分: X/10
达标判定: [达标(≥7.5且无🔴+脚本通过) / 未达标]
```

**公众号文章专有规则（手机阅读铁律）**：

**段落与句子**：
- 每段不超过150字（约3-4行手机屏幕），绝对禁止超过200字
- 单句不超过50字，复合句不超过70字
- 长短交替制造节奏，连续两段接近150字时插入短句调节

**排版与视觉**：
- 每3-4段插入一个加粗点睛句（独立成段）
- 节与节之间用 `---` 分隔线
- 每节加粗不超过3处，禁止整段加粗，禁止连续加粗段落
- 正文禁用bullet列表（公众号排版错位），用自然语言列举
- 只用一级和二级标题，禁止三级及以下
- 中文和英文/数字之间加半角空格，破折号用——

**开头与结尾**：
- 前3段必须有钩子（数字/反常识/问题/画面），禁止"随着…""近年来…"
- 禁止"综上所述""总而言之"，用新问题/回扣开头/有力判断收束
- 文末不写作者署名行

**语言风格**：
- "说人话"——专业概念翻译为读者能懂的语言
- 有态度——一篇文章只讲一个核心观点，有明确判断
- 每个抽象概念配日常经验类比（高速公路→水网，Android→HydroOS）
- 禁用词：赋能/抓手/闭环/打法/颗粒度/对齐/笔者认为/本文将

**数据规范**：
- 所有数据必须注明来源（文中自然带出，不用脚注）
- 百分比必须反算验证（分子÷分母）
- 禁止编造数据，不确定时用定性描述
- 对比数据口径一致，大数字用万/亿

**自动检查**：
- 初稿和每轮修改后必须运行 `scripts/check_article.py`
- 自动检查覆盖14项：段落长度、句子长度、标题长度、标题层级、错别字、标点、中英间距、加粗密度、禁用词、bullet列表、开头质量、结尾格式、词频、节分隔线
- 存在🔴项不得提交终稿

**输出格式**：
- Markdown (.md) 文件，便于导入135编辑器/秀米
- 一级标题全文唯一，节标题用中文数字编号（## 一、…）

**特殊场景**：
- 数据修正重发：开头加 `>` 引用块更正说明（≤3段）
- 系列文章：自然带出关联但每篇可独立阅读
- 长文(>5000字)：每1500字插入呼吸点，考虑拆分上下篇

### 2.9 演示文稿(PPT) — 三角色评审

| 角色 | 身份 | 评审维度 |
|------|------|---------|
| **听众代表** | 目标观众（评委/验收专家/领导/国际听众）(35%) | 开场吸引力、叙事逻辑链、信息密度、节奏感、记忆点、行动召唤 |
| **设计审查** | 资深PPT设计师(30%) | 配色规范（蓝红体系）、字体规范（微软雅黑）、排版规范（16:9）、视觉元素一致性 |
| **内容专家** | CHS/智慧水利领域专家(35%) | 技术准确性、数据来源、逻辑完整性、Speaker Notes覆盖率、时间控制、术语一致性 |

**PPT风格指南（强制遵循）**：

> 以下为关键约束的速查版。完整风格指南（含素材清单）见 `references/ppt_style_guide.md`，以该文件为权威来源。

**配色核心约束**：
- **主色**: 科技蓝 #002060 / #0F62AD / #2E75B5（标题、图表、背景）
- **强调色**: 中国红 #C00000 / #FF0000（章节标题、关键词、数据高亮）
- **正文**: 深邃黑 #000000 / 高级灰 #3F3F3F
- **背景**: 纯白 #FFFFFF（内容页）
- **辅助色**: 亮黄 #FFFF00、典雅紫 #7030A0（仅图表辅助，慎用）
- 禁止使用以上体系外的颜色

**字体核心约束**：
- **中文**: 微软雅黑（Bold用于标题，Regular用于正文）
- **英文/数字**: Times New Roman 或 Arial
- **字号**: 封面36-44pt → 章节32-40pt → 内容标题24-28pt → 正文16-20pt → 图表标签12-16pt

**排版规范**：
- 页面比例: 16:9（宽屏），不使用4:3
- 封面页: 项目名称 + 单位Logo + 汇报人 + 日期 + 高清实景/深蓝背景
- 过渡页: 红色或蓝色大号字体章节标题，起到节奏引导作用
- 内容页: 图文比例约1:1或4:6，避免纯文字墙
- 结尾页: "谢谢"或"汇报完毕"，与封面风格呼应
- 页脚/页码: 全文统一风格

**视觉元素**：
- 图表配色遵循蓝红体系，标注清晰
- 实景照片须高清、专业（水库、大坝、河道、测控设备航拍）
- 架构/流程图风格统一，用PPT或Visio绘制
- 禁止低分辨率网络图片

**内容规范**：
- 每页核心信息须在10秒内可抓住
- 连续5页以上高密度内容须插入呼吸页/过渡页
- 按每页1-2分钟估算时长，匹配汇报要求
- 每页必须有Speaker Notes（讲稿），含转场语
- 首页Notes包含开场白，末页Notes包含结束语

**技术实现**：
- 使用 pptxgenjs (Node.js) 生成 .pptx 文件
- 读取 /mnt/skills/public/pptx/SKILL.md 获取生成规范
- 素材优先复用 assets 目录中的高质量图片
- 生成后用 LibreOffice 转PDF进行视觉QA

**评审输出格式**：
```
═══ 演示文稿评审汇总 ═══
文件: [标题].pptx  |  页数: XX页  |  目标时长: XX分钟

听众代表 (35%): X/10
  开场测试: 通过/未通过  |  文字墙页面: [页码]
  记忆点: [能否提炼3个]
  意见: 1. ... 2. ...

设计审查 (30%): X/10
  配色合规: X/6  |  字体合规: X/6  |  排版合规: X/5  |  视觉合规: X/3
  意见: 1. ... 2. ...

内容专家 (35%): X/10
  讲稿覆盖率: X%  |  数据验证: X处
  意见: 1. ... 2. ...

加权均分: X/10
达标判定: [达标(≥7.5且无🔴+风格合规) / 未达标]
```

> **PPT文体附加步骤**: 初稿生成后须用LibreOffice转PDF进行视觉QA，确认配色/字体/排版与风格指南一致。详细风格规范见 `references/ppt_style_guide.md`。

---

## 3. 进度追踪系统

### 3.1 进度文件结构

每个项目维护一个 `progress.json`：

```json
{
  "project": "项目名称",
  "total": 25,
  "completed": 3,
  "documents": {
    "SCI-P1a": {
      "type": "SCI",
      "title": "论文标题",
      "target": "Water Resources Research",
      "status": "in_review_v9",
      "current_version": 9,
      "last_review_result": "minor_revision",
      "consecutive_passes": 1,
      "updated_at": "2026-02-19T10:00:00Z"
    }
  }
}
```

### 3.2 状态流转

```
not_started → drafting → in_review_v{N} → revising_v{N} → in_review_v{N+1} → ... → completed
                                                                                    → manual_review_needed
```

### 3.3 文件命名规范

```
docs/
├── SCI-P1a/
│   ├── draft_v01.md
│   ├── review_v01.md
│   ├── response_v01.md
│   ├── draft_v02.md
│   ├── draft_final.md
│   ├── references.bib
│   └── figures/
├── PAT-PF1-1/
│   ├── draft_v01.md
│   └── ...
├── BK-M1/
│   ├── ch01_v01.md
│   ├── ch01_review_v01.md
│   ├── ch01_final.md
│   └── ...
├── STD-CN-SLT-XXXX/
│   ├── draft_v01.docx
│   ├── review_v01.md
│   └── ...
├── WX-水网操作系统科普/
│   ├── draft_v01.md
│   ├── check_report_v01.txt
│   └── draft_final.md
├── PPT-理论与体系汇报/
│   ├── create_ppt.js
│   ├── slides_v01.pptx
│   ├── review_v01.md
│   └── slides_final.pptx
└── progress.json
```

---

## 4. 自动执行协议

### 4.1 收到"开始[类型][编号]"后的动作序列

```
步骤1: 识别文档类型和编号
步骤2: 读取 progress.json（如存在），确认该文档当前状态
步骤3: 读取该文档的写作规格（从 docs/project_config.yaml 或用户提供，格式见 references/project_config_template.md）
步骤4: 如有前序版本/前序章节，读取最近内容用于衔接
步骤5: 用 web_search 进行背景检索（按文体差异化）
        - SCI/CN: 检索近5年顶刊相关论文，确认创新性
        - PAT: 检索5篇最接近的已有专利，确认新颖性
        - BK: 检索同类教材/专著，确认定位差异
        - RPT: 检索相关项目报告和技术标准
        - STD-CN: web_search逐一确认规范性引用文件(GB/T, SL/T)现行有效
        - STD-INT: 确认Normative references为现行ISO/IEC/OGC标准
        - WX: 检索热点数据、竞品文章、最新行业动态
        - PPT: 检索最新数据/成果、确认引用图表来源
步骤6: 参照 `references/writing_craft_guide.md` 对应文体技法，按文体模板撰写初稿
        ⚠️ 参考文献铁律：每一条参考文献必须真实可查，格式必须规范，**绝不编造**。
        不确定的文献标注 `⚠️ 待核实`，提醒用户人工确认。
        格式规范见 `references/citation_style_guide.md`。

步骤6.5: 【参考文献验证关卡——不可跳过】
        本步骤为硬性关卡，🔴项未清零不得进入步骤7。
        a) 运行 `scripts/check_references.py <文件> --type [类型]`
        b) 用 web_search 逐一验证参考文献真实性：
           - SCI/CN: 抽查≥50%（≥15篇），验证DOI/标题/作者/期刊/卷期
           - BK(教材/专著): 抽查≥30%，验证书名/出版社/年份/ISBN
           - PAT: 验证100%对比文件的公开号真实存在
           - STD: 验证100%规范性引用标准现行有效
           - RPT: 抽查≥30%数据来源的真实性
        c) 核查格式规范：
           - CN/BK/RPT: GB/T 7714-2015（含[J]/[M]/[C]/[D]/[S]/[R]类型标识）
           - SCI: 与目标期刊Author Guidelines完全一致
           - PAT: 背景技术引用标注完整公开号
           - STD-CN: 规范性引用文件含标准导语
        d) 核查数量达标（见§7.3.4数量表）
        e) 🔴项清零 → 进入步骤7；🔴项未清零 → 修正后重新运行检查

步骤7: 进入多角色评审循环
步骤8: 达标后保存终稿，更新 progress.json
步骤9: 输出："✅ [文档编号] 已完成，输入'继续'进入下一个"
```

> **统一质量调度器**：`scripts/run_checks.py <文件> --type [类型]` 自动按顺序运行所有适用检查（通用质量→参考文献→文体专属），🔴=0方可进入评审。
> 
> **文体特殊步骤**：
> - **WX**: 步骤6后运行 `scripts/check_article.py`（14项检查），🔴项清零后方可评审。
> - **STD-CN**: 步骤6后运行 `scripts/check_standard.py --type cn`（条文用语+结构合规），合规率须100%。
> - **STD-INT**: 步骤6后运行 `scripts/check_standard.py --type int`（ISO合规+英法双语），合规率须100%。
> - **所有文体**: 步骤6.5为**强制关卡**——必须运行 `scripts/check_references.py` 并用web_search验证文献真实性，🔴项清零后方可进入评审。
> - **PPT**: 步骤6使用 pptxgenjs 生成 .pptx，步骤7前运行 `scripts/check_ppt.py [--duration 分钟]`。
> - **SCI/CN/PAT/BK/RPT**: 步骤7前运行 `scripts/check_quality.py --type [类型]`（公式/术语/一致性检查，参考文献已在6.5检查）。

### 4.2 收到"继续"后的动作序列

```
步骤1: 读取 progress.json
步骤2: 找到下一个未完成的文档（或当前文档的下一章）
步骤3: 从步骤3（§4.1）开始执行
```

### 4.3 中断恢复

如果对话中断后重新开始，发送"继续"即可。系统会：
1. 读取 progress.json 和各文档的 status.json
2. 找到最后一个处于 in_review 或 revising 状态的文档
3. 读取该文档最新版本
4. 从评审或修改步骤继续

---

## 5. 长文档防失败策略（BK/RPT文体必读）

> 当文档字数超过5万字时，一次性生成往往因上下文窗口溢出而失败。本节定义四级策略，根据字数规模选择合适的生成方式。

### 5.1 四级策略（L1-L4）

| 级别 | 文档规模 | 策略 | 适用场景 |
|:----:|:--------:|:-----|:---------|
| **L1** | < 3万字 | 单轮生成：直接生成完整MD→转docx | 单章节、短报告 |
| **L2** | 3-10万字 | 分模块生成：按章拆分→分别生成→组装→转docx | 一般专著单部分、技术报告 |
| **L3** | 10-30万字 | 模块化流水线：目录→模块拆分→批量生成→组装→统计验证→docx | 完整专著、大型技术报告 |
| **L4** | > 30万字 | 增量迭代：L3基础上+增量修改+版本标签+四角色评审循环 | 系列丛书、超大型专著 |

### 5.2 L3/L4操作规范（核心）

**模块拆分原则**：
1. 每个模块对应一个`.md`文件，放入`modules/`目录
2. 模块命名：`p{部分号}_s{节号}_{英文描述}.md`（如`p2_s4_canal_control.md`）
3. 每个模块独立可读，但通过交叉引用与其他模块关联
4. 辅助模块：`p0_front_matter.md`（前言/目录）、`p5_references.md`（参考文献）、`p6_glossary.md`（术语表）

**组装脚本**：将所有模块按顺序拼接为`report_full_assembled.md`，每次修改后重新组装并统计：
- 总字符数、各部分占比
- 参考文献数量、近5年占比、英文占比
- 图表数量（含概念辨析框、案例框）
- 思考题数量、章末小结数量
- 超长段落数量（>400字，目标=0）

**版本管理**：
- 每轮修改完成后`git commit`并标注版本号（如`v03`、`v04`）
- 重大版本使用`git tag`（如`git tag v04`）
- commit message包含：修改项清单 + 四角色评分 + 关键统计指标

### 5.3 可读性防线（v04经验总结）

基于BK专著v01→v04实战，以下可读性规则已验证有效：

| 规则 | 阈值 | 检测方法 |
|:-----|:-----|:---------|
| **段落长度上限** | ≤ 400字/段 | 统计空行间字符数 |
| **术语首次出现释义** | 跨学科术语100%标注 | 检查（英文，中文释义）格式 |
| **概念速览框** | 每个跨学科章节入口≥1个 | 检查"📖给水利工程师的速览"标记 |
| **章末小结格式** | `### §x.x 本节小结` + `---`分隔线 | 正则匹配 |
| **图表前后空行** | 图表引用块前后各1空行 | 检查`> **图/表`前后 |
| **思考题分隔** | `---`分隔线 + 四级难度（L1概念→L4综合） | 正则匹配 |

### 5.4 docx生成规范

| 元素 | 格式要求 |
|:-----|:---------|
| 正文 | 宋体12pt，段前段后6pt |
| 一级标题(#) | Heading 1 |
| 二级标题(##) | Heading 2 |
| 三级标题(###) | Heading 3 |
| 表格 | Light Grid Accent 1样式，9pt字体 |
| 代码块 | Courier New 8pt，左缩进1cm |
| 引用块(>) | 左缩进1cm，10.5pt |
| 图表标题 | 居中，加粗，11pt |


### 5.5 docx生成防失败协议（claude.ai环境专用）

> 以下规则针对claude.ai网页端用`create_file`+`bash_tool`生成.docx的场景。

**问题诊断**：当文档内容超过约8000字时，单个JS文件内嵌全部中文字符串字面量会导致：
- `create_file`传输超时或截断
- 字符串拼接过大导致node执行失败
- 反复重试只会反复失败

**强制分级生成策略**：

| 字数 | 方法 | 要点 |
|:----:|:----:|:-----|
| ≤5000字 | JS直接内嵌 | 常规docx库生成 |
| 5001-12000字 | **数据-引擎分离** | 内容→`content.json`(纯文本数据) + 通用`engine.js`(格式引擎) |
| 12001-25000字 | **分段组装** | 按节写入多个`.md`→合并→python-docx生成 |
| >25000字 | **多文件分册** | 拆为多个独立`.docx`，交付用户合并 |

**数据-引擎分离模式（L2核心）**：
```
步骤A: create_file → content.json (每段标注类型: h1/h2/h3/para/table/blockquote)
步骤B: create_file → engine.js (通用格式引擎，约200行，读取JSON生成docx)
步骤C: bash_tool → node engine.js → output.docx
```

**关键防失败规则**：
1. **先估字数再选策略** — 写初稿前必须估算目标字数
2. **数据文件不含代码** — JSON只存纯文本，无JS语法
3. **引擎文件不含内容** — JS只做格式化，无硬编码文本
4. **单文件上限8000字** — 任何单个create_file调用不超过8000字
5. **失败不重试同策略** — 一次失败立即升级到下一级别
6. **python-docx替代方案** — L3/L4优先用python-docx而非node docx库

**各文体典型级别**：

| 文体 | 典型字数 | 推荐级别 |
|:----:|:--------:|:--------:|
| WX公众号 | 3000-5000 | L1 |
| SCI论文 | 8000-15000 | L2 |
| CN论文 | 6000-10000 | L2 |
| 发明专利 | 5000-8000 | L1-L2 |
| 单章书稿 | 15000-30000 | L3 |
| 完整专著 | 100000-400000 | L4 |
| 技术报告 | 10000-50000 | L2-L3 |
| 技术标准 | 15000-30000 | L3 |


---

## 6. 统一术语与符号系统

### 6.1 CHS核心术语（中英对照）

| 中文 | English | 缩写 |
|------|---------|------|
| 水系统控制论 | Cybernetics of Hydro Systems | CHS |
| 水网操作系统 | Hydraulic Network Operating System | HydroOS |
| 水网自主运行等级 | Water-network Self-driving Autonomy Level | WSAL(L0-L5) |
| 运行设计域 | Operational Design Domain | ODD |
| 积分延迟零模型 | Integrator Delay Zero model | IDZ |
| 分布式模型预测控制 | Distributed Model Predictive Control | DMPC |
| 多智能体系统 | Multi-Agent System | MAS |
| 模型在环/软件在环/硬件在环 | Model/Software/Hardware-in-the-Loop | MIL/SIL/HIL |
| 安全包络 | Safety Envelope | SE |
| 认知智能 | Cognitive Intelligence | CI |
| 瀚铎水网大模型 | Hando Water Network Large Model | HWLM |

### 6.2 数学符号统一表

| 符号 | 含义 | 首次定义于 |
|------|------|-----------|
| G(s) | 渠池传递函数 | SCI-P1a |
| H(s) | 控制器传递函数 | SCI-P1a |
| A_s | 水面面积 | SCI-P1a |
| τ^d | 延迟时间 | SCI-P1a |
| α, β | IDZ模型参数 | SCI-P1a |
| Q | 流量 (m³/s) | 通用 |
| Z | 水位 (m) | 通用 |
| n | 糙率 (Manning系数) | 通用 |
| S_0 | 底坡 | 通用 |
| B | 渠道底宽 | 通用 |

### 6.3 公众号文章概念翻译表（WX文体专用）

写公众号时，专业概念必须翻译为读者能理解的语言：

| 专业概念 | 公众号表述 | 推荐类比 |
|---------|-----------|---------|
| 水系统控制论(CHS) | 一门研究"水网怎么运行"的学问 | 相当于电力系统的自动控制理论 |
| HydroOS | 水网的操作系统 | 相当于手机的Android/iOS |
| 自主运行水网 | 能"自己跑"的水网 | 从人工驾驶到自动驾驶 |
| Saint-Venant方程 | 描述水流运动的基本方程 | 牛顿运动定律之于力学 |
| 传递函数/IDZ模型 | 简化版的水流计算模型 | 用近似公式代替精确计算 |
| SCADA系统 | 水利工程的监控系统 | 工厂的中控室 |
| MPC(模型预测控制) | "看远一步再行动"的控制方法 | 下棋时多看几步 |
| ODD(运行设计域) | 系统能安全工作的条件范围 | 自动驾驶的适用场景 |
| SIL/HIL(在环测试) | 在虚拟/半实物环境中测试系统 | 飞行模拟器训练飞行员 |
| 数字孪生 | 水利工程的虚拟镜像 | 在电脑中复制一个真实世界 |
| DMPC | 各渠段"商量着来"的控制方法 | 高速公路各收费站协调限流 |
| MAS(多智能体) | 多个AI小助手分工协作 | 蜂群各司其职但协同工作 |
| WSAL(L0-L5) | 水网自动化的"段位" | 自动驾驶L0-L5等级 |

**常用背景数据（WX文体引用时必须注明来源）**：
- 全国水利建设投资：2024年13529亿元，连续三年破万亿（来源：水利部2025年工作会议）
- 南水北调中线：全长1432公里，60余座渠池
- 智慧水利市场规模（IDC口径）：2024年约102亿元
- 智慧水利市场规模（宽口径）：2023年约200-216亿元（来源：智研咨询）

---

## 7. 跨文档一致性检查

### 7.1 一致性约束

以下核心内容在多篇文档中出现时，必须保持一致：

| 编号 | 内容 | 涉及文档 |
|------|------|---------|
| CONS-01 | CHS八原理的表述 | 所有SCI/CN/BK |
| CONS-02 | WSAL(L0-L5)定义 | 所有SCI/CN/PAT/BK/STD-CN/STD-INT |
| CONS-03 | Saint-Venant方程的离散化表述 | SCI-P1a, BK-T2a, PAT-PF1系列 |
| CONS-04 | MPC控制原理描述 | SCI-P2系列, BK-M2, PAT-PF2系列 |
| CONS-05 | HydroOS五层架构 | SCI-P5c, BK-M7, PAT-PF7系列, STD-CN/STD-INT |
| CONS-06 | 胶东调水工程参数 | SCI工程线, BK-M8, PAT工程专利 |
| CONS-07 | 沙坪水电站工程参数 | SCI工程线, BK-M8, PAT工程专利 |
| CONS-08 | 南水北调中线工程参数 | 多篇SCI/CN/BK |
| CONS-09 | 安全包络ODD边界条件 | SCI-P2c, BK-M3, PAT-PF3系列, STD-CN/STD-INT |
| CONS-10 | §5.1术语表中英对照 | 所有文体（WX用§5.3翻译表，PPT遵循同一术语体系） |

### 7.2 一致性检查时机

- 每篇文档终稿完成时，检查与已完成文档的一致性
- 每个批次完成时，进行批次内全量交叉检查
- 全部文档完成时，进行全局一致性审计

> 自动检查脚本: `scripts/check_consistency.py <文档目录>`
> 
> 该脚本自动扫描已完成文档，逐条检查CONS-01~10，检测术语全称不一致、工程参数数值差异等问题。

---

## 8. 质量检查清单（通用）

每篇文档终稿前必须通过以下检查：

### 8.1 内容检查
- [ ] 核心创新点明确且与其他文档不重复
- [ ] 数学公式编号连续，无遗漏引用
- [ ] 图表编号连续，正文中有引用
- [ ] 缩略语首次出现时有全称
- [ ] 工程参数和数据有来源标注

### 8.2 格式检查
- [ ] 符合目标期刊/出版社/专利局格式要求
- [ ] 参考文献格式统一
- [ ] 中文标点/英文标点使用正确
- [ ] 量和单位规范

### 8.3 参考文献检查（所有含引用的文体必须逐条执行）

> **铁律**：参考文献必须真实、准确、格式规范。**绝不编造**不存在的文献。
> **格式规范**：完整格式要求见 `references/citation_style_guide.md`。
> **自动检查**：`scripts/check_references.py <文件> --type [类型]`

#### 8.3.1 真实性验证（最高优先级）
- [ ] **禁止编造**：每一条参考文献都是真实存在的（用web_search验证标题/DOI/作者）
- [ ] 不确定的文献标注 `⚠️ 待核实`，提醒用户人工确认
- [ ] 不使用错误的作者名、年份、期刊名、卷期页码
- [ ] 不编造DOI号
- [ ] 不引用已撤回(retracted)论文（除非明确标注已撤回）

#### 8.3.2 正文-文献表交叉一致性
- [ ] 正文中每个引用标注[N]在参考文献表中都有对应条目
- [ ] 参考文献表中每条文献在正文中都被引用（无"僵尸文献"）
- [ ] 编号连续，无跳号
- [ ] 多次引用同一文献使用相同编号

#### 8.3.3 格式规范
- [ ] **SCI**：格式与目标期刊一致（Author-Year或数字编号，投稿前web_search确认）
- [ ] **CN/BK/RPT**：严格遵循GB/T 7714-2015（每条含文献类型标识[J]/[M]/[C]/[D]/[S]/[R]/[P]/[EB/OL]）
- [ ] **BK**：每章末有独立参考文献列表，全书编号体系一致
- [ ] **STD-CN**：规范性引用文件章节含标准导语，引用标准均现行有效
- [ ] **STD-INT**：Normative references含ISO标准导语，标准均为current edition
- [ ] 中英文标点一致（中文文献用中文标点，英文文献用英文标点）
- [ ] 期刊名不随意缩写（除非期刊模板明确要求）

#### 8.3.4 数量与质量
- [ ] 参考文献数量达标（见下表）
- [ ] 近5年文献占比达标
- [ ] 自引率在合理范围
- [ ] 包含该领域经典/奠基性文献
- [ ] 英文文献占比合理（中文教材≥30%，专著≥50%）

| 文体 | 最低数量 | 近5年≥ | 自引率 | 特殊要求 |
|------|---------|--------|--------|---------|
| SCI | ≥30篇 | 50% | 15-25% | 会议论文≤20% |
| CN | ≥20篇 | 40% | 10-20% | 含国内外对比文献 |
| BK(教材) | 每章≥10，全书≥100 | 30% | ≤15% | 含推荐阅读 |
| BK(专著) | 每章≥15，全书≥200 | 40% | 15-25% | 覆盖所有重要流派 |
| RPT | ≥10篇 | 按需 | 按需 | 数据来源必须标注 |
| PAT | ≥3篇对比文件 | — | — | 背景技术引用公开号 |

#### 8.3.5 自引文献标准格式
撰写时引用雷晓辉自有文献，必须使用 `references/citation_style_guide.md` §9中的标准格式，确保全系统一致。

### 8.4 一致性检查
- [ ] 术语与§5术语表一致
- [ ] 符号与§5符号表一致
- [ ] 与已完成文档的CONS-01至CONS-10无冲突

### 8.5 公众号文章附加检查（WX文体专用）
- [ ] 运行 `scripts/check_article.py` 脚本，🔴项为零
- [ ] 标题15-22字以内
- [ ] 前3段有钩子（数字/反常识/问题/画面）
- [ ] 全文只有一个核心观点
- [ ] 所有数据注明来源且经反算验证
- [ ] 无段落超过150字（200字硬限）
- [ ] 无句子超过70字
- [ ] 每节有点睛句（加粗独立段），每节加粗≤3处
- [ ] 无三级标题
- [ ] 中英文之间有空格
- [ ] 标点统一中文，破折号用——
- [ ] 无禁用词（赋能/抓手/颗粒度/对齐/打法/笔者认为/本文将）
- [ ] 结尾有余味（非简单总结）
- [ ] 文末无署名行
- [ ] 节间有 `---` 分隔线
- [ ] 无bullet列表

### 8.6 技术标准附加检查（STD-CN/STD-INT文体专用）

> 自动检查脚本: `scripts/check_standard.py <文件> --type cn|int`
- [ ] 结构严格遵循 GB/T 1.1-2020(国内) 或 ISO/IEC Directives Part 2(国际)
- [ ] 条文用语全文校验：「应/宜/可/不应/不宜」(国内) 或「shall/should/may」(国际)无混用
- [ ] 规范性引用文件逐一 web_search 确认现行有效
- [ ] 术语定义采用"属概念+种差"方法，与已有国标/ISO术语无冲突
- [ ] 规范性附录与资料性附录标注正确
- [ ] 条文编号连续，交叉引用准确
- [ ] 量和单位符合 GB 3101/3102(国内) 或 SI(国际)
- [ ] 技术指标均有依据标注（实验/实测/理论/国际对标）
- [ ] ICS分类号正确(国内) / 法文标题完整(国际)
- [ ] 无"建议""希望"等非规范用语出现在条文正文中

### 8.7 演示文稿附加检查（PPT文体专用）

> 自动检查脚本: `scripts/check_ppt.py <文件> [--duration 分钟]`
- [ ] 配色遵循科技蓝(#002060)+中国红(#C00000)体系，无体系外颜色
- [ ] 字体统一为微软雅黑(中文)+Times New Roman/Arial(英文)
- [ ] 页面比例 16:9
- [ ] 封面包含：项目名称、单位Logo、汇报人、日期
- [ ] 每章节有过渡页分隔
- [ ] 无纯文字墙页面（每页图文比≥4:6）
- [ ] 连续5页以上高密度内容后有呼吸页
- [ ] 每页核心信息10秒内可抓住
- [ ] 全部页面均有Speaker Notes（含转场语）
- [ ] 总页数与汇报时长匹配（每页1-2分钟）
- [ ] 无低分辨率图片
- [ ] LibreOffice转PDF视觉QA通过

---

## 9. 文体模板快速参考

### 9.1 SCI论文结构

```
Title
Authors and Affiliations
Abstract (150-300 words)
Keywords (3-8)
1. Introduction
2. Literature Review / Background
3. Methodology / Theoretical Framework
4. Case Study / Numerical Experiments
5. Results and Discussion
6. Conclusions
Acknowledgments
Data Availability Statement
References
Appendix (if needed)
```

### 9.2 中文核心论文结构

```
题名
作者 单位
摘要 (200-300字)
关键词 (3-8个)
中图分类号 文献标志码
引言
1 方法/理论
2 模型/算法
3 案例验证
4 结果与讨论
5 结论
参考文献
英文标题、作者、摘要、关键词
```

### 9.3 发明专利结构

```
（一）技术领域 (50-100字，三级分类)
（二）背景技术 (500-800字，3-5个现有技术缺陷)
（三）发明内容
    - 所要解决的技术问题
    - 技术方案
    - 有益效果
（四）附图说明 (至少3幅图)
（五）具体实施方式 (2000-4000字，含完整实施例)
（六）权利要求书 (8-15项)
    - 独立权利要求：前序+特征两段式
    - 从属权利要求：逐层细化
（七）摘要 (150-300字)
```

### 9.4 书稿章节结构

```
# 第X部分　部分标题（中文）
Part X: Part Title (English)

[部分导言 500-1000字：场景切入→核心问题→各章路线图→与前后部分衔接]

## X.1 节标题（中文标题 English Title）

> ---
> 📖 给水利工程师的速览：[核心问题]？  （跨学科章节必须）
> [200字白话文回答"这对水利工程师意味着什么"]
> ---

[正文内容：段落≤400字，跨学科术语首次出现标注（英文，中文释义）]

> **概念辨析框：XXX vs YYY**  （关键概念边界澄清时使用）
> ...

> **图 X-Y　图标题**  （ASCII art或描述，前后各留1空行）
> *Fig. X-Y English caption*

| 表X-Y 表标题 |   |   |   |  （量化数据表格）

---

### §X.1 本节小结

[300-500字，概括核心结论，衔接下一节]

---

**思考与讨论**

1. （概念理解）L1题...
2. （计算练习/分析比较）L2-L3题...
3. （综合设计/批判思考）L3-L4题...

[参考文献放在全书末尾，统一编号]
```

**模块化文件规范**（>10万字时必须）：
- 每节一个文件：`modules/p{部分号}_s{节号}_{英文描述}.md`
- 辅助文件：`p0_front_matter.md`, `p5_references.md`, `p6_glossary.md`
- 组装后文件：`report_full_assembled.md`
- 每次修改后运行 `check_readability.py` 验证

### 9.5 技术报告结构

```
封面（项目名称、编号、编制单位、日期）
修订记录
执行摘要
目录
1 项目概况
2 技术方案
3 实施过程
4 成果分析
5 结论与建议
附录
参考文献
```

### 9.6 国内技术标准结构(STD-CN)

```
封面（标准编号、ICS分类号、中国标准文献分类号）
目次
前言（起草规则声明、归口单位、起草单位、起草人）
引言（编制背景与目的，可选）
1 范围（适用对象、适用边界、不适用范围）
2 规范性引用文件（逐一web_search确认现行有效）
3 术语和定义（"属概念+种差"定义法）
4 缩略语（可选）
5 总则/一般规定
6-N 技术要求各章（用语：应/宜/可/不应/不宜）
附录A (规范性) 测试方法
附录B (资料性) 示例/计算方法
参考文献 (资料性)
```

### 9.7 国际技术标准结构(STD-INT)

```
Cover page (ISO/CD XXXXX, TC/SC/WG info)
Contents
Foreword (TC/SC info, drafting basis, version notes)
Introduction (industry background, pain points, scope rationale)
1 Scope (applicable systems, exclusions)
2 Normative references (ISO/IEC/OGC only, all current)
3 Terms and definitions (ISO 704 compliant, reference OBP)
4 Abbreviated terms
5-N Technical requirements (wording: shall/should/may)
Annex A (normative) Test methods / protocol matrices
Annex B (informative) Examples / comparisons (e.g. SAE J3016 mapping)
Bibliography
```

### 9.8 微信公众号文章结构

```
# 标题（15字以内为佳，最多22字）

**引子第一段（加粗的核心判断或钩子）**

引子2-3段（150字内，制造好奇心或紧迫感）

---

## 一、第一节标题 — 现状/问题/背景

正文段落（每段≤150字）...

**点睛句独立成段。**

正文段落...

---

## 二、第二节标题 — 核心观点/分析

正文段落...

---

## 三~五、展开论述各节

...

---

## 六、收束节标题（不写"总结"/"结论"）

有余味的收束段落（回扣开头/新问题/有力判断）
```

**公众号文章字数与结构参考**：

| 类型 | 字数范围 | 节数 | 每节字数 | 阅读时间 |
|------|---------|------|---------|---------|
| 短文 | 1500-2500字 | 4-6节 | 300-500字 | 3-5分钟 |
| 中篇 | 2500-4000字 | 6-8节 | 400-600字 | 5-8分钟 |
| 长文 | 4000-6000字 | 7-9节 | 500-800字 | 8-12分钟 |

### 9.9 演示文稿结构(PPT)

```
Slide 1: 封面（项目名称 + 单位Logo + 汇报人 + 日期）
Slide 2: 目录/纲要（分章节，带编号）
Slide 3: 过渡页 — 第一章节标题
Slide 4-N: 内容页（图文1:1，每页一个核心信息）
Slide N+1: 过渡页 — 第二章节标题
...循环...
Slide M-1: 总结/展望页
Slide M: 结尾页（"谢谢" / "Thank You"）
```

**PPT页数与时长参考**：

| 场景 | 汇报时长 | 建议页数 | 每页时间 |
|------|---------|---------|---------|
| 项目答辩 | 15-20分钟 | 15-25页 | 1-1.5分钟 |
| 学术报告 | 30-40分钟 | 30-40页 | 1分钟 |
| 产品发布 | 45-60分钟 | 35-50页 | 1-1.5分钟 |
| 国际会议 | 15-20分钟 | 15-20页 | 1分钟 |
| 简短汇报 | 5-10分钟 | 8-12页 | 1分钟 |

**PPT页面类型配比建议**：
- 封面/结尾: 2页
- 过渡页: 每章节1页（通常4-6页）
- 内容页: 占总页数60-70%
- 数据/图表页: 占总页数15-20%
- 呼吸页/总结页: 占总页数5-10%

---

## 10. 引用与自引管理

### 10.1 自引率目标

| 文体 | 自引率范围 | 说明 |
|------|-----------|------|
| SCI | 15-25% | 体系内互引 + 已发表Lei2025a-d |
| CN | 10-20% | 合理引用前期成果 |
| PAT | 不适用 | 背景技术不刻意自引 |
| BK | 3-15% | 按章节性质灵活控制 |
| RPT | 无目标 | 按项目需求引用，无自引率要求 |
| STD-CN | 无目标 | 规范性引用须为现行有效国标/行标，非学术自引概念 |
| WX | 无目标 | 数据须注明来源，但不涉及学术引用管理 |
| STD-INT | 无目标 | 规范性引用须为现行ISO/IEC标准，非学术自引概念 |
| PPT | 无目标 | 数据页须标注来源，但不涉及学术引用管理 |

### 10.2 必引文献库

**经典文献**：Wiener 1948, Kalman 1960, Wylie 1969, Malaterre 1998, Buyalski 1991, VanOverloop 2006, Litrico & Fromion 2009

**Lei 代表作（已发表）**：Lei 2025a (水网自主调控), Lei 2025b (CHS基本理论), Lei 2025c (在环测试体系), Lei 2025d (水资源系统分析)

---

## 11. 图表与公式处理

### 11.1 图表规范

- 所有图表必须有编号和标题，必须在正文中被引用
- SCI论文：图表标题用英文，字号≥8pt
- 中文论文/书稿：图表标题中英双语
- 专利：附图说明中每个附图标记必须在说明书中有对应

### 11.2 公式规范

- 所有独立公式必须编号（右对齐）
- 正文中引用公式用"式(X)"或"Eq.(X)"
- 变量首次出现必须定义
- 矩阵用粗体大写，向量用粗体小写，标量用斜体
- 公式推导不跳步，关键中间步骤保留

### 11.3 AI图表生成提示词格式

```
[FIGURE-ID: fig_XX]
[TYPE: 系统架构图/流程图/数据曲线/对比柱状图/示意图]
[DESCRIPTION: 详细描述图表内容]
[KEY ELEMENTS: 列出必须包含的元素]
[STYLE: 学术论文风格/教材插图风格/专利附图风格]
```

---

## 12. 批量写作策略

### 12.1 批次规划

按依赖关系分批：
```
Batch 1: 基础理论文档（无依赖）
Batch 2: 方法论文档（依赖Batch 1）
Batch 3: 实验验证文档（依赖Batch 1+2）
Batch 4: 工程应用文档（依赖Batch 1+2+3）
```

### 12.2 依赖图示例（CHS论文矩阵）

以25篇论文的水系统控制论学术矩阵为例：

```
     Batch 1 (基础理论)          Batch 2 (方法论)         Batch 3 (验证)          Batch 4 (应用)
     ──────────────────     ──────────────────      ──────────────────     ──────────────────
     SCI-P1a: IDZ建模         SCI-P2a: DMPC框架       SCI-P3a: 中线验证      BK-ch05: 案例章节
         ↓                      ↓                      ↓                     ↓
     SCI-P1b: 参数辨识         SCI-P2b: MAS架构        SCI-P3b: 胶东验证      RPT-01: 项目报告
         ↓                      ↓                      ↓                     ↓
     CN-C1: 综述论文           PAT-PF2: 控制专利       SCI-P3c: 对比实验      STD-CN: 行业标准
```

**批次间规则**：
- Batch N+1的文档可引用Batch N的已完成文档
- 同批次内文档的创新点重叠度 ≤ 30%
- 跨批次的术语定义必须一致（运行 `check_consistency.py`）

### 12.3 批量预检协议

```bash
# 单文档检查
python3 scripts/run_checks.py paper.md --type sci

# 批次完成后跨文档检查
python3 scripts/check_consistency.py ./batch1_outputs/

# 全局审计（所有批次完成后）
for f in outputs/*.md; do python3 scripts/run_checks.py "$f"; done
python3 scripts/check_consistency.py ./outputs/
```

### 12.4 全局审计清单

每个批次完成后执行：
1. 跨文档一致性检查（§7 CONS-01~10）
2. 创新点重叠度检查（不同文档创新点不应超过30%重叠）
3. 引用网络完整性检查（A引用B → B必须已完成或标记为"待发表"）
4. 自引率汇总（全矩阵自引率应在合理范围内）
5. 术语一致性检查（§6 术语表全量匹配）

---

## 13. 错误处理

| 异常情况 | 处理方式 |
|---------|---------|
| web_search无法访问 | 基于已有知识继续，标注"待补充检索验证" |
| 评审分数始终无法达标 | 超出上限后输出当前最好版本 + 问题清单 |
| 用户规格不完整 | 询问缺失信息或基于同类文档合理推断 |
| 跨文档一致性冲突 | 以先完成的文档为准，提示用户确认 |
| 会话token接近上限 | 保存当前进度，提示开新会话 |
| pptxgenjs生成失败(PPT) | 检查Node.js环境和依赖，降级为手动排版指导 |
| 字体不可用(PPT) | 降级为系统默认无衬线字体，标注"字体待替换" |
| 引用标准已废止(STD) | web_search查找替代标准，标注"⚠️ 原引用已废止，建议替换为XXX" |
| LibreOffice不可用(PPT) | 跳过视觉QA步骤，标注"待人工视觉检查" |

---

## 14. 使用方式

### 14.1 Claude Code

将本SKILL.md放入工作目录即可：
```bash
cd ~/my-project
claude
> 开始SCI-P1a
```

### 14.2 claude.ai 网页

新对话中提供本文件核心内容 + 文档规格 + 进度状态即可。

### 14.3 最简操作

1. `开始[类型][编号]` — 启动写作
2. `继续` — 推进下一个
3. 不满意就说"重新评审"或"针对XX问题修改"

---

## 附录：评审评分汇总模板

```
═══════════════════════════════════════
文档: [编号] v[版本号]  |  类型: [SCI/CN/PAT/BK/RPT/STD-CN/STD-INT/WX/PPT]
评审轮次: 第[N]轮
═══════════════════════════════════════

[角色1] 决定/评分: [值]  关键意见: [摘要]
[角色2] 决定/评分: [值]  关键意见: [摘要]
[角色3] 决定/评分: [值]  关键意见: [摘要]
[角色4] 决定/评分: [值]  关键意见: [摘要]

综合判定: [达标/未达标]  |  综合评分: [值]
下一步: [进入修改v{N+1} / 保存终稿 / 标记人工审核]
═══════════════════════════════════════
```
