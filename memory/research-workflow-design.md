# 自动深度研究工作流设计

## 目标
实现类似Manus的自主研究能力，自动生成25万字学术报告

## 系统架构

```
用户输入主题
    ↓
[任务规划器] - 分解为子任务
    ↓
[并行研究模块] - 多个子任务同时执行
    ↓
[内容整合器] - 合并各章节内容
    ↓
[质量检查器] - 验证字数、引用、格式
    ↓
[输出生成器] - 生成Word/PDF/Markdown
    ↓
完成报告
```

## 核心模块设计

### 1. 任务规划器 (Task Planner)

输入：研究主题（如"水系统控制论最新进展"）
输出：子任务列表

```python
子任务示例：
1. 搜索基础理论文献（目标：5000字）
2. 搜索建模方法文献（目标：5000字）
3. 搜索控制算法文献（目标：5000字）
4. 搜索工程案例文献（目标：5000字）
5. 搜索未来趋势文献（目标：5000字）
...
共50个子任务 = 25万字
```

### 2. 并行研究模块 (Parallel Researcher)

每个子任务执行：
1. 使用kimi_search搜索相关文献（10-20篇）
2. 使用academic-writing技能生成学术标准内容
3. 添加引用和参考文献
4. 保存到临时文件

并行执行：使用sessions_spawn同时启动多个子任务

### 3. 内容整合器 (Content Integrator)

1. 收集所有子任务输出
2. 按章节顺序合并
3. 统一引用编号
4. 生成目录结构

### 4. 质量检查器 (Quality Checker)

检查项：
- [ ] 总字数 >= 25万字
- [ ] 引用数量 >= 500条
- [ ] 图表数量 >= 50个
- [ ] 格式统一性
- [ ] 逻辑连贯性

### 5. 输出生成器 (Output Generator)

使用word-docx技能生成：
- Word文档（.docx）
- 带目录的完整报告
- 格式化的参考文献

## 执行流程

### Phase 1: 规划（5分钟）
```bash
1. 分析主题，确定50个子任务
2. 为每个子任务分配字数目标（5000字）
3. 创建任务队列
```

### Phase 2: 并行研究（30-60分钟）
```bash
1. 同时启动10个子任务（sessions_spawn）
2. 每个子任务：
   - 搜索10篇文献
   - 生成5000字内容
   - 保存到memory/research/task_XX.md
3. 监控进度，完成后启动下一批
```

### Phase 3: 整合（10分钟）
```bash
1. 读取所有task_XX.md文件
2. 按顺序合并
3. 统一引用编号
4. 生成目录
```

### Phase 4: 输出（5分钟）
```bash
1. 转换为Word格式
2. 添加封面、目录、页眉页脚
3. 保存到reports/目录
```

## 技术实现

### 使用工具
- kimi_search - 文献搜索
- academic-writing - 内容生成
- word-docx - Word文档生成
- sessions_spawn - 并行执行
- cron - 定时任务（可选）
- memory文件 - 状态保存

### 字数控制策略
每个子任务5000字 × 50个子任务 = 25万字

内容扩展技巧：
1. 每个概念详细解释
2. 添加数学公式和推导
3. 插入案例分析
4. 对比不同方法
5. 添加图表说明
6. 详细引用讨论

## 示例：子任务执行

任务：搜索"模型预测控制在水系统中的应用"

步骤：
1. kimi_search搜索相关论文（10篇）
2. 提取关键信息：
   - 作者、年份、期刊
   - 核心方法
   - 实验结果
   - 创新点
3. 使用academic-writing生成：
   - 引言（500字）
   - 方法介绍（1500字）
   - 案例分析（1500字）
   - 讨论（1000字）
   - 小结（500字）
4. 添加引用[[1]]-[[10]]
5. 保存到文件

## 下一步

需要我实现这个工作流的第一个版本吗？可以从一个简化版开始：
- 5个子任务
- 目标2.5万字
- 测试整个流程

验证可行后再扩展到25万字。
